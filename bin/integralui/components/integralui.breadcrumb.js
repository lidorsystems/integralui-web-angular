/*
  filename: integralui.breadcrumb.js
  version : 1.0.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])};return function(b,a){function c(){this.constructor=b}f(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),IntegralUIBreadCrumb=function(f){function b(a,b,d,e){var c=f.call(this,d)||this;c.dataService=a;c.elemRef=b;c.commonService=d;c.cmpResolver=e;c.dataItems=[];c.currentList=[];c.isThereChildItems=!1;c.options={};c.activeObj=null;c.hoverItem=null;c.isListOpened=!1;c.prevActiveObj=
null;c.isPopupDelayed=!1;c.itemSize={width:0,height:0};c.listSize={width:100,height:200};c.updateTimeout=null;c.dropListRef=null;c.dropList=null;c.isExpandBoxTouched=!1;c.selectionChanged=new core_1.EventEmitter;c.updateOptions();return c}__extends(b,f);Object.defineProperty(b.prototype,"dataFields",{set:function(a){this.updateDataFields(a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dropDownWidth",{get:function(){return this.listSize.width},set:function(a){this.listSize.width!=
a&&(this.listSize.width=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"items",{get:function(){return this.dataItems},set:function(a){this.dataItems=a;this.updateData()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"selectedItem",{get:function(){return this.currentSelection},set:function(a){this.currentSelection!=a&&(this.currentSelection=a,this.updateLayout())},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.updateData();this.updateCurrentList();
this.generalClassName="iui-breadcrumb";this.itemClassName="iui-breadcrumb-item";this.itemContentClassName=this.itemClassName+"-content";this.expandBoxClassName=this.itemClassName+"-expand-box";this.initStyle()};b.prototype.initStyle=function(){this.defaultStyle={general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},item:{general:{disabled:this.itemClassName+
"-disabled",focused:this.itemClassName+"-focused",normal:this.itemClassName,hovered:this.itemClassName+"-hovered",selected:this.itemClassName+"-selected"},expandBox:{general:this.expandBoxClassName,load:this.expandBoxClassName+"-load",expanded:this.expandBoxClassName+"-close",collapsed:this.expandBoxClassName+"-open"},content:{disabled:this.itemContentClassName+"-disabled",focused:this.itemContentClassName+"-focused",normal:this.itemContentClassName,hovered:this.itemContentClassName+"-hovered",selected:this.itemContentClassName+
"-selected"}}};this.updateStyle(this.controlStyle);this.updateControlClass();this.refresh()};b.prototype.ngAfterViewInit=function(){this.addDropList()};b.prototype.ngOnDestroy=function(){this.resetLayoutTimer();this.removeDropList()};b.prototype.getItemObject=function(a,c){switch(c){case "text":return a[this.options.dataFields.text]}return null};b.prototype.updateCurrentList=function(){this.currentList.length=0;if(this.currentSelection){this.currentList.push({data:this.currentSelection,hasChildren:this.isThereVisibleChildren(this.currentSelection),
style:{}});for(var a=this.getItemParent(this.currentSelection);a;)this.currentList.splice(0,0,{data:a,hasChildren:!0,style:{}}),a=this.getItemParent(a);this.currentList.splice(0,0,{data:(c={},c[this.options.dataFields.items]=this.items,c),hasChildren:!0,isRoot:!0,style:{}})}var c};b.prototype.updateData=function(){this.dataService.init([{data:this.items}])};b.prototype.updateDataFields=function(a){this.options.dataFields=a?{allowFocus:a.allowFocus?a.allowFocus:"allowFocus",content:a.content?a.content:
"content",enabled:a.enabled?a.enabled:"enabled",hasChildren:a.hasChildren?a.hasChildren:"hasChildren",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",pid:a.pid?a.pid:"pid",selected:a.selected?a.selected:"selected",style:a.style?a.style:"style",text:a.text?a.text:"text",tooltip:a.tooltip?a.tooltip:"tooltip",value:a.value?a.value:"value",visible:a.visible?a.visible:"visible"}:{allowFocus:"allowFocus",content:"content",enabled:"enabled",hasChildren:"hasChildren",icon:"icon",
id:"id",items:"items",pid:"pid",selected:"selected",style:"style",text:"text",tooltip:"tooltip",value:"value",visible:"visible"};this.dataService&&this.dataService.updateDataFields(this.options.dataFields)};b.prototype.updateOptions=function(a){a?this.options={currentStyle:{},dataFields:null}:(this.options={currentStyle:{},dataFields:null},this.updateDataFields())};b.prototype.addDropList=function(){var a=this;if(a.appRef){a.removeDropList();var c=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUIListPopup);
c&&(a.dropListRef=a.appRef.createComponent(c),a.dropListRef._component?a.dropList=a.dropListRef._component:a.dropListRef._hostElement&&(a.dropList=a.dropListRef._hostElement.component),a.hideDropList(),a.dropList&&(a.dropList.closed.subscribe(function(c){a.hideDropList()}),a.dropList.selectionChanged.subscribe(function(c){a.hideDropList();a.selectedItem=c.item;a.selectionChanged.emit({item:c.item});a.isPopupDelayed=!0;setTimeout(function(){a.isPopupDelayed=!1},250)})))}};b.prototype.removeDropList=
function(){this.dropList&&(this.dropList.closed&&this.dropList.closed.unsubscribe(),this.dropList.selectionChanged&&this.dropList.selectionChanged.unsubscribe());this.dropListRef&&this.dropListRef.destroy();this.dropList=null};b.prototype.hideDropList=function(){this.dropList&&(this.dropList.display="none");this.updateActiveObj(null);this.activeObj=null;this.isListOpened=!1;this.refresh()};b.prototype.showPopup=function(a,c,b){a=this.commonService.getShiftPos();b=this.getButtonElemRect(b);var d=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild);
this.dropList&&(this.dropList.allowAnimation=!1,this.dropList.display="block",this.dropList.items=c.data[this.options.dataFields.items]?c.data[this.options.dataFields.items]:[],this.dropList.minWidth=this.listSize.width,this.dropList.position={x:b.left+a.x-1,y:d.bottom+a.y},this.dropList.size={width:Math.max(b.width,this.dropList.minWidth),height:0},this.dropList.refresh(),this.dropList.open(),this.dropList.focus(),this.isListOpened=!0);this.refresh()};b.prototype.getButtonElemRect=function(a){var c=
this.commonService.getPageRect(),b=this.getButtonElemList();b&&0<=a&&a<b.length&&(c=this.commonService.getPageRect(b[a].nativeElement));return c};b.prototype.expandBoxMouseDown=function(a,c,b){this.isEnabled&&(1!=a.buttons||this.isExpandBoxTouched||this.toggle(c),1!=a.which||this.isPopupDelayed||this.showPopup(a,c,b),this.isExpandBoxTouched=!1);a.stopPropagation()};b.prototype.expandBoxMouseUp=function(a){this.isExpandBoxTouched=!1;a.stopPropagation()};b.prototype.expandBoxTouchStart=function(a,c){this.isEnabled&&
(this.isExpandBoxTouched=!0,this.toggle(c));a.stopPropagation()};b.prototype.toggle=function(a,c){if(a&&(a.data[this.options.dataFields.hasChildren]||a.data[this.options.dataFields.items]&&0!=a.data[this.options.dataFields.items].length)&&!(c&&0!=a.data[this.options.dataFields.expanded]||!1===c&&0==a.data[this.options.dataFields.expanded])){var b=void 0!==c?c:!1!==a.data[this.options.dataFields.expanded]?!0:!1;b=void 0!=c?c:!b;b!=a.data[this.options.dataFields.expanded]&&(a.data[this.options.dataFields.expanded]=
b,this.updateActiveObj(a))}};b.prototype.itemMouseEnter=function(a,b,d){if(this.isEnabled){this.hoverItem=b.data;this.isListOpened&&this.updateActiveObj(b);if(this.dropList){var c=this.commonService.getShiftPos();d=this.getButtonElemRect(d);this.dropList.items=b.data[this.options.dataFields.items]?b.data[this.options.dataFields.items]:[];this.dropList.position.x=d.left+c.x-1;this.dropList.opacity=this.dropList.items&&0<this.dropList.items.length?1:0;this.dropList.updateLayout()}this.refresh()}a.stopPropagation()};
b.prototype.itemMouseLeave=function(a,b){this.isEnabled&&(this.hoverItem=null,this.refresh());a.stopPropagation()};b.prototype.itemMouseDown=function(a,b){this.isEnabled&&(this.selectedItem=b.data);a.stopPropagation()};b.prototype.itemMouseUp=function(a,b){};b.prototype.itemTouchStart=function(a,b){};b.prototype.itemTouchEnd=function(a,b){};b.prototype.getItemHeight=function(){return 0<this.itemSize.height?this.itemSize.height+"px":"auto"};b.prototype.getItemParent=function(a){return this.dataService.getParent(a)};
b.prototype.isItemAllowed=function(a){return 0==a[this.options.dataFields.visible]?!1:!0};b.prototype.isItemEnabled=function(a){return this.isEnabled&&a&&0!=a[this.options.dataFields.enabled]};b.prototype.isItemHovered=function(a){return a&&a==this.hoverItem?!0:!1};b.prototype.isItemLoading=function(a){return!1};b.prototype.isItemSelected=function(a){return a==this.activeObj};b.prototype.isThereVisibleChildren=function(a){var b=!1;if(a&&(a=a[this.options.dataFields.items]))for(var d=0;d<a.length;d++)if(this.isItemAllowed(a[d])){b=
!0;break}return b};b.prototype.updateActiveObj=function(a){this.prevActiveObj=this.activeObj;this.activeObj=a};b.prototype.getButtonElemList=function(){return this.buttonElems?this.buttonElems.toArray():null};b.prototype.getItemElemList=function(){return this.itemElems?this.itemElems.toArray():null};b.prototype.resetLayoutTimer=function(){this.updateTimeout&&clearTimeout(this.updateTimeout);this.updateTimeout=null};b.prototype.updateLayout=function(){var a=this;a.updateTimeout=setTimeout(function(){a.updateCurrentList();
for(var b=0;b<a.currentList.length;b++)a.updateItemStyle(a.currentList[b]);var d=a.getItemElemList();if(d){var e={width:0,height:0};for(b=0;b<d.length;b++)e={width:Math.max(e.width,d[b].nativeElement.offsetWidth),height:Math.max(e.height,d[b].nativeElement.offsetHeight)};a.itemSize=e}clearTimeout(a.updateTimeout)},100)};b.prototype.getControlStyle=function(){var a={};0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};b.prototype.getItemInlineStyle=
function(a){return a.data[this.options.dataFields.style]||{}};b.prototype.refresh=function(a){if(a)this.updateItemStyle(a);else for(a=0;a<this.currentList.length;a++)this.updateItemStyle(this.currentList[a])};b.prototype.updateItemStyle=function(a){a&&(a.style={general:[],expandBox:[],content:[]},a.inlineStyle=this.getItemInlineStyle(a),a.style.general.push(this.itemClassName),a.style.general.push(this.options.currentStyle.item.general.normal),a.style.content.push(this.itemContentClassName),a.style.content.push(this.options.currentStyle.item.content.normal),
this.isItemEnabled(a.data)?this.isItemSelected(a)?(a.style.general.push(this.options.currentStyle.item.general.selected),a.style.content.push(this.options.currentStyle.item.content.selected)):this.isItemHovered(a.data)&&(a.style.general.push(this.options.currentStyle.item.general.hovered),a.style.content.push(this.options.currentStyle.item.content.hovered)):(a.style.general.push(this.options.currentStyle.item.general.disabled),a.style.content.push(this.options.currentStyle.item.content.disabled)),
(this.isThereChildItems||a.hasChildren)&&a.style.expandBox.push(this.options.currentStyle.item.expandBox.general),(a.hasChildren||a.data[this.options.dataFields.hasChildren])&&(this.isThereVisibleChildren(a.data)||!a.data[this.options.dataFields.items]||a.data[this.options.dataFields.items]&&0==a.data[this.options.dataFields.items].length)||this.isThereVisibleChildren(a.data))&&(this.isItemLoading(a.data)?a.style.expandBox.push(this.options.currentStyle.item.expandBox.load):a==this.activeObj&&this.isListOpened?
(a.style.expandBox.push(this.options.currentStyle.item.expandBox.collapsed),a.style.expandBox.push(this.options.currentStyle.item.expandBox.collapsed+"-animate")):(a.style.expandBox.push(this.options.currentStyle.item.expandBox.expanded),a==this.prevActiveObj&&a.style.expandBox.push(this.options.currentStyle.item.expandBox.expanded+"-animate")))};b.prototype.getItemStyle=function(a){return a?{general:this.getItemGeneralStyle(a.general),expandBox:this.getItemExpandBoxStyle(a.expandBox),content:this.getItemContentStyle(a.content)}:
this.getDefaultItemStyle()};b.prototype.getItemExpandBoxStyle=function(a){return this.commonService.isString(a)?a:a?{general:this.commonService.isFieldAvailable(a.disabled,this.expandBoxClassName),load:this.commonService.isFieldAvailable(a.focused,this.expandBoxClassName+"-load"),expanded:this.commonService.isFieldAvailable(a.normal,this.expandBoxClassName+"-open"),collapsed:this.commonService.isFieldAvailable(a.hovered,this.expandBoxClassName+"-close")}:this.getDefaultItemExpandBoxStyle()};b.prototype.getItemGeneralStyle=
function(a){return this.commonService.isString(a)?a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,this.itemClassName+"-disabled"),focused:this.commonService.isFieldAvailable(a.focused,this.itemClassName+"-focused"),normal:this.commonService.isFieldAvailable(a.normal,this.itemClassName),hovered:this.commonService.isFieldAvailable(a.hovered,this.itemClassName+"-hovered"),selected:this.commonService.isFieldAvailable(a.selected,this.itemClassName+"-selected")}:this.getDefaultItemGeneralStyle()};
b.prototype.getItemContentStyle=function(a){return this.commonService.isString(a)?a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,this.itemContentClassName+"-disabled"),focused:this.commonService.isFieldAvailable(a.focused,this.itemContentClassName+"-focused"),normal:this.commonService.isFieldAvailable(a.normal,this.itemContentClassName),hovered:this.commonService.isFieldAvailable(a.hovered,this.itemContentClassName+"-hovered"),selected:this.commonService.isFieldAvailable(a.selected,
this.itemContentClassName+"-selected")}:this.getDefaultItemContentStyle()};b.prototype.getDefaultListStyle=function(){return{general:this.getDefaultGeneralStyle(),item:this.getDefaultItemStyle()}};b.prototype.getDefaultItemStyle=function(){return{general:this.getDefaultItemGeneralStyle(),expandBox:this.getDefaultItemExpandBoxStyle(),content:this.getDefaultItemContentStyle()}};b.prototype.getDefaultItemExpandBoxStyle=function(){return{general:this.defaultStyle.item.expandBox.general,load:this.defaultStyle.item.expandBox.load,
expanded:this.defaultStyle.item.expandBox.expanded,collapsed:this.defaultStyle.item.expandBox.collapsed}};b.prototype.getDefaultItemGeneralStyle=function(){return{disabled:this.defaultStyle.item.general.disabled,focused:this.defaultStyle.item.general.focused,normal:this.defaultStyle.item.general.normal,hovered:this.defaultStyle.item.general.hovered,selected:this.defaultStyle.item.general.selected}};b.prototype.getDefaultItemContentStyle=function(){return{disabled:this.defaultStyle.item.content.disabled,
focused:this.defaultStyle.item.content.focused,normal:this.defaultStyle.item.content.normal,hovered:this.defaultStyle.item.content.hovered,selected:this.defaultStyle.item.content.selected}};b.prototype.updateStyle=function(a){this.options.currentStyle=a?{general:this.getGeneralStyle(a.general),item:this.getItemStyle(a.item)}:this.getDefaultListStyle()};b.decorators=[{type:core_1.Component,args:[{selector:"iui-breadcrumb",template:'\n        <div [ngClass]="getControlClass()" [ngStyle]="getControlStyle()">\n            <ul class="iui-breadcrumb-block">\n                <li [ngClass]="obj.style.general" [ngStyle]="{ height: getItemHeight() }" *ngFor="let obj of currentList; let i = index" (mouseenter)="itemMouseEnter($event, obj, i)" (mouseleave)="itemMouseLeave($event, obj)" #itemElem>\n                    <div *ngIf="obj.hasChildren" class="iui-breadcrumb-item-button" [ngClass]="{ \'iui-breadcrumb-item-button-first\': obj.isRoot }" style="display:inline-block" (mousedown)="expandBoxMouseDown($event, obj, i)" (mouseup)="expandBoxMouseUp($event)" (touchstart)="expandBoxTouchStart($event, obj)" #buttonElem>\n                        <span [ngClass]="obj.style.expandBox"></span>\n                    </div>\n                    <div *ngIf="!obj.isRoot" [ngClass]="obj.style.content" (mousedown)="itemMouseDown($event, obj)" (mouseup)="itemMouseUp($event, obj)" (touchend)="itemTouchEnd($event, obj)">\n                        <span [iuiTemplateOutlet]="itemTemplate" [iuiTemplateOutletContext]="{$implicit: (obj.data)}"></span>\n                    </div>\n               </li>\n            </ul>\n        </div>\n    ',
inputs:"controlStyle data enabled name size state".split(" "),providers:[integralui_data_service_1.IntegralUIDataService]}]}];b.ctorParameters=function(){return[{type:integralui_data_service_1.IntegralUIDataService},{type:core_1.ElementRef},{type:integralui_common_service_1.IntegralUICommonService},{type:core_1.ComponentFactoryResolver}]};b.propDecorators={itemTemplate:[{type:core_1.ContentChild,args:[core_1.TemplateRef]}],itemElems:[{type:core_1.ViewChildren,args:["itemElem",{read:core_1.ElementRef}]}],
buttonElems:[{type:core_1.ViewChildren,args:["buttonElem",{read:core_1.ElementRef}]}],appRef:[{type:core_1.Input}],dataFields:[{type:core_1.Input}],dropDownWidth:[{type:core_1.Input}],items:[{type:core_1.Input}],selectedItem:[{type:core_1.Input}],selectionChanged:[{type:core_1.Output}]};return b}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIBreadCrumb=IntegralUIBreadCrumb;