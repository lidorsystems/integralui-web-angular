/*
  filename: integralui.base.list.js
  version : 1.4.0
  Copyright Â© 2016-2018 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(l,b){function a(){this.constructor=l}for(var c in b)b.hasOwnProperty(c)&&(l[c]=b[c]);l.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)},__decorate=this&&this.__decorate||function(l,b,a,c){var e=arguments.length,d=3>e?b:null===c?c=Object.getOwnPropertyDescriptor(b,a):c,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(l,b,a,c);else for(var f=l.length-1;0<=f;f--)if(h=l[f])d=(3>e?h(d):3<e?h(b,a,d):
h(b,a))||d;return 3<e&&d&&Object.defineProperty(b,a,d),d},__metadata=this&&this.__metadata||function(l,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(l,b)},core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_dragdrop_service_1=require("../services/integralui.dragdrop.service"),
integralui_filter_service_1=require("../services/integralui.filter.service"),IntegralUIBaseList=function(l){function b(a,c,e,b,h,f,g){var d=l.call(this,h)||this;d.dataService=a;d.dragDropService=c;d.elemRef=e;d.elemRenderer=b;d.commonService=h;d.filterService=f;d.cmpResolver=g;d.currentList=[];d.options={allowDrag:!1,allowDrop:!0,dataFields:null,selectedItem:null,sorting:integralui_core_1.IntegralUISortOrder.None};d.dataItems=[];d.scrollItemList=[];d.dropMarkElem=null;d.dragCmpRef=null;d.dragCmp=
null;d.cloneElem=null;d.cloneElemStartPos={x:0,y:0};d.isCtrlDragEntered=!1;d.filterParams=null;d.hoverItem=null;d.currentFocusItem=null;d.isKeyboardActive=!1;d.allowUpdate=!0;d.avgItemHeight=0;d.blockSize={width:0,height:0};d.clientRect={width:0,height:0};d.contentSize={width:0,height:0};d.currentIndex=0;d.prevIndex=0;d.virtualization=!1;d.visibleRange=1;d.updateTimer=null;d.currentScrollPos={x:0,y:0};d.maxScrollPos={x:0,y:0};d.accelerator=.5;d.isScrollActive=!1;d.isScrollTimerActive=!1;d.prevScrollPos=
{x:0,y:0};d.scrollBarSize={width:0,height:0};d.scrollCount=0;d.scrollLargeChange={x:0,y:0};d.scrollSize={width:0,height:0};d.scrollTimerID=null;d.horScrollOrientation=integralui_core_1.IntegralUIOrientation.Horizontal;d.currentSelectionMode=integralui_core_1.IntegralUISelectionMode.One;d.shiftFirstSelectedItem=null;d.removeIndex=-1;d.currentSelectedItems=[];d.sortComparer=null;d.refreshTimer=null;d.touchStartPos={x:0,y:0};d.touchEndPos={x:0,y:0};d.afterSelect=new core_1.EventEmitter;d.beforeEdit=
new core_1.EventEmitter;d.beforeSelect=new core_1.EventEmitter;d.change=new core_1.EventEmitter;d.clear=new core_1.EventEmitter;d.dragEnter=new core_1.EventEmitter;d.dragDrop=new core_1.EventEmitter;d.dragLeave=new core_1.EventEmitter;d.dragOver=new core_1.EventEmitter;d.itemAdding=new core_1.EventEmitter;d.itemAdded=new core_1.EventEmitter;d.itemRemoving=new core_1.EventEmitter;d.itemRemoved=new core_1.EventEmitter;d.keyDown=new core_1.EventEmitter;d.keyPress=new core_1.EventEmitter;d.keyUp=new core_1.EventEmitter;
d.loadComplete=new core_1.EventEmitter;d.scrollPosChanged=new core_1.EventEmitter;d.selectionChanged=new core_1.EventEmitter;d.updateComplete=new core_1.EventEmitter;d.updateOptions();return d}__extends(b,l);Object.defineProperty(b.prototype,"allowDrag",{set:function(a){this.options.allowDrag=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"allowDrop",{set:function(a){this.options.allowDrop=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"allowFilter",{set:function(a){this.options.allowFilter=
a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"allowFocus",{set:function(a){this.options.allowFocus=a;a||(this.currentFocusItem=null);this.refresh()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"focusedItem",{get:function(){return this.currentFocusItem},set:function(a){this.currentFocusItem!=a&&(this.currentFocusItem=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"items",{get:function(){return this.dataItems},set:function(a){this.dataItems=
a;this.updateData()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"showScroll",{get:function(){return this.options.showScroll},set:function(a){this.updateShowScroll(a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"selectedItem",{get:function(){return this.currentSelection},set:function(a){if(this.currentSelection!=a)var c=this,e=setTimeout(function(){c.processSelection(null,a);clearTimeout(e)},1)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"selectionMode",{get:function(){return this.currentSelectionMode},set:function(a){if(this.currentSelectionMode!=a){this.currentSelectionMode=a;this.clearPrevSelection(this.currentSelectionMode!=integralui_core_1.IntegralUISelectionMode.None?this.currentSelection:null);var c=this,e=setTimeout(function(){c.refresh();c.currentSelectionMode==integralui_core_1.IntegralUISelectionMode.None&&(c.currentSelection=null,c.selectionChanged.emit({item:null}));clearTimeout(e)},1)}},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"sorting",{set:function(a){this.options.sorting=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"virtualMode",{get:function(){return this.virtualization},set:function(a){this.virtualization=a;this.updateLayout()},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.dataService.init([{data:this.items}]);this.itemClassName="iui-list";this.itemContentClassName=this.itemClassName+"-content"};b.prototype.initStyle=function(){this.defaultStyle=
{general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},item:{general:{disabled:this.itemClassName+"-disabled",focused:this.itemClassName+"-focused",normal:this.itemClassName,hovered:this.itemClassName+"-hovered",selected:this.itemClassName+"-selected"},content:{disabled:this.itemContentClassName+"-disabled",focused:this.itemContentClassName+"-focused",
normal:this.itemContentClassName,hovered:this.itemContentClassName+"-hovered",selected:this.itemContentClassName+"-selected"}}};this.updateStyle(this.controlStyle);this.updateControlClass();this.refresh()};b.prototype.addItem=function(a,c){this.callEventAdd("add",a,-1,c)};b.prototype.clearItems=function(a){a||(this.currentSelectedItems.length=0,this.currentSelection=null);this.dataService.clear(a);this.clear.emit({parent:a});this.updateLayout()};b.prototype.insertItemAt=function(a,c,e){this.callEventAdd("at",
a,c,e)};b.prototype.insertItemBefore=function(a,c){this.callEventAdd("ref",a,-1,null,c)};b.prototype.insertItemAfter=function(a,c){this.callEventAdd("ref",a,-1,null,c,!0)};b.prototype.removeItem=function(a){return this.callEventRemove(a)};b.prototype.removeItemAt=function(a,c){return this.callEventRemove(null,a,c)};b.prototype.callEventAdd=function(a,c,e,d,b,f){var h={cancel:!1,item:c};this.itemAdding.emit(h);if(1!=h.cancel){switch(a){case "at":this.dataService.insert(c,e,d);break;case "ref":this.dataService.insertByRef(c,
b,f);break;default:this.dataService.insert(c,-1,d)}this.processItemAdd(c,d);this.updateItem(d);this.itemAdded.emit({item:c})}};b.prototype.callEventRemove=function(a,c,e){var d={cancel:!1,item:a};this.itemRemoving.emit(d);return 1!=d.cancel&&(this.removeIndex=this.items?this.items.indexOf(a):-1,c=this.dataService.removeAt(a,c,e),c.result)?(this.processItemRemoval(a,e),this.itemRemoved.emit({item:c.obj}),!0):!1};b.prototype.processItemAdd=function(a,c){};b.prototype.processItemRemoval=function(a,c){};
b.prototype.updateCurrentList=function(){};b.prototype.updateData=function(){};b.prototype.updateOptions=function(a){a?(this.options={allowDrag:this.commonService.isFieldAvailable(a.allowDrag,!1),allowDrop:this.commonService.isFieldAvailable(a.allowDrop,!0),allowFilter:this.commonService.isFieldAvailable(a.allowFilter,!1),allowFocus:this.commonService.isFieldAvailable(a.allowFocus,!1),dataFields:null,selectedItem:this.commonService.isFieldAvailable(a.selectedItem,this.options.selectedItem?this.options.selectedItem:
null)},this.updateShowScroll(a.showScroll)):(this.options={allowDrag:!1,allowDrop:!0,allowFilter:!1,allowFocus:!1,dataFields:null,selectedItem:null},this.updateDataFields(),this.updateShowScroll())};b.prototype.updateDataFields=function(a){this.options.dataFields=a?{allowDrag:a.allowDrag?a.allowDrag:"allowDrag",allowDrop:a.allowDrop?a.allowDrop:"allowDrop",allowEdit:a.allowEdit?a.allowEdit:"allowEdit",allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",
canSelect:a.canSelect?a.canSelect:"canSelect",checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:"checkBoxSettings",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",contextMenu:a.contextMenu?a.contextMenu:"contextMenu",enabled:a.enabled?a.enabled:"enabled",expanded:a.expanded?a.expanded:"expanded",hasChildren:a.hasChildren?a.hasChildren:"hasChildren",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",
pid:a.pid?a.pid:"pid",selected:a.selected?a.selected:"selected",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",style:a.style?a.style:"style",templateObj:a.templateObj?a.templateObj:"templateObj",text:a.text?a.text:"text",tooltip:a.tooltip?a.tooltip:"tooltip",value:a.value?a.value:"value",visible:a.visible?a.visible:"visible"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",canSelect:"canSelect",checkBoxSettings:"checkBoxSettings",
checked:"checked",checkState:"checkState",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",selected:"selected",statusIcon:"statusIcon",style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value",visible:"visible"};this.dataService&&this.dataService.updateDataFields(this.options.dataFields)};b.prototype.updateShowScroll=function(a){this.options.showScroll=a?{horizontal:this.commonService.isFieldAvailable(a.horizontal,
!0),vertical:this.commonService.isFieldAvailable(a.vertical,!0)}:{horizontal:!0,vertical:!0}};b.prototype.processLoadData=function(a,c,e,d){var b=this;b.clearItems(c);b.updateDataFields(e);var f=[];if(a)if(0!=d){var g=[];a.forEach(function(a,c){a[b.options.dataFields.items]=[];var e=a[b.options.dataFields.pid];g[e]?(g[e][b.options.dataFields.items]||(g[e][b.options.dataFields.items]=[]),g[a[b.options.dataFields.id]]=a,g[e][b.options.dataFields.items].push(a)):(g[a[b.options.dataFields.id]]=a,f.push(a))});
g.length=0}else f=a;if(c)for(c[b.options.dataFields.items]=f,a=0;a<c[b.options.dataFields.items].length;a++)c[b.options.dataFields.items][a][b.options.dataFields.pid]=c[b.options.dataFields.id];else if(b.items)for(a=b.items.length=0;a<f.length;a++)b.items.push(f[a]);b.updateItem(c);b.loadComplete.emit(null);this.updateLayout()};b.prototype.updateItem=function(a){};b.prototype.updateScrollItemList=function(){this.scrollItemList.length=0};b.prototype.addDropMark=function(a){this.appRef&&(this.removeDropMark(),
a=this.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUIDragWindow))&&(this.dragCmpRef=this.appRef.createComponent(a),this.dragCmpRef._component?this.dragCmp=this.dragCmpRef._component:this.dragCmpRef._hostElement&&(this.dragCmp=this.dragCmpRef._hostElement.component))};b.prototype.removeDropMark=function(){this.dragCmpRef&&this.dragCmpRef.destroy();this.dragCmp=null};b.prototype.callDragDropEvent=function(a,c,e){a={action:c.action,cancel:!1,dragItem:c.source,dropPos:c.dropPos,event:a,
isDropAllowed:c.allow,mousePos:this.commonService.getMousePos(a),sourceCtrl:c.sourceCtrl,targetCtrl:c.targetCtrl,targetItem:c.target};e?this.dragDrop.emit(a):this.dragOver.emit(a);return a.cancel};b.prototype.checkEmptySpace=function(a){var c=this.getContentSize(),e=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild);c=e.top+c.height;e=e.bottom;a=this.commonService.getMousePos(a);var b=this.commonService.getShiftPos();a.x-=b.x;a.y-=b.y;return a.y>=c&&a.y<=e};b.prototype.ctrlDragEnter=
function(a){this.isEnabled&&this.processDragEnter(a)};b.prototype.ctrlDragDrop=function(a){this.isEnabled&&this.processDragDrop(a);a.stopPropagation()};b.prototype.ctrlDragLeave=function(a){this.isEnabled&&this.processDragLeave(a)};b.prototype.ctrlDragOver=function(a){this.isEnabled&&this.processDragOver(a);a.stopPropagation()};b.prototype.dropMark=function(a,c){this.dragCmp||this.addDropMark({x:a.pageX,y:a.pageY});if(this.dragCmp){var e="none";this.options.allowDrop&&(e=c?"block":"none");this.dragCmp.display=
e}};b.prototype.updateDragComponent=function(a){this.dragCmp&&this.dragCmp.updatePos(a)};b.prototype.isDragAllowed=function(a){return this.options.allowDrag?a&&(a[this.options.dataFields.allowDrag]||void 0===a[this.options.dataFields.allowDrag])?!0:!1:!1};b.prototype.isDropAllowed=function(a,c,e){var b=this.options.allowDrop;if(b&&a&&c&&(b=c[this.options.dataFields.allowDrop]||void 0===c[this.options.dataFields.allowDrop]?!0:!1))if(Array.isArray(a))for(var h=0;h<a.length;h++){if(this.commonService.isEqual(a[h][this.options.dataFields.id],
c[this.options.dataFields.id])||0===e&&this.isParentOf(c,a[h])||this.isChildOf(c,a[h])){b=!1;break}if(!b)break}else if(this.commonService.isEqual(a[this.options.dataFields.id],c[this.options.dataFields.id])||0===e&&this.isParentOf(c,a)||this.isChildOf(c,a))b=!1;return b};b.prototype.processDragStart=function(a,c){this.dragDropService.clearData();if(!this.isDragAllowed(c))a.preventDefault();else if(c)if(this.isDragAllowed(c)){this.addDropMark({x:a.pageX,y:a.pageY});this.dropMark(a);a.dataTransfer?
(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text",c[this.options.dataFields.id]?c[this.options.dataFields.id].toString():"")):a.originalEvent&&a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.effectAllowed="move",a.originalEvent.dataTransfer.setData("text",c[this.options.dataFields.id]?c[this.options.dataFields.id].toString():""));var e={clone:this.cloneItem(c),source:c,sourceCtrl:this,sourceData:this.items};switch(this.selectionMode){case integralui_core_1.IntegralUISelectionMode.MultiSimple:e.clone=
this.createCloneList(this.currentSelectedItems);e.source=this.currentSelectedItems;break;case integralui_core_1.IntegralUISelectionMode.MultiExtended:e.clone=this.createCloneList(this.currentSelectedItems),e.source=this.currentSelectedItems}this.dragDropService.setData(e)}else a.dataTransfer?a.dataTransfer.effectAllowed="none":a.originalEvent&&a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.effectAllowed="none")};b.prototype.processDragEnter=function(a){if(!this.isCtrlDragEntered){this.isCtrlDragEntered=
!0;var c=this.dragDropService.getData();a={action:a.shiftKey?"copy":"move",dragItem:c.source,dropPos:-1,event:a,isDropAllowed:this.options.allowDrop,mousePos:this.commonService.getMousePos(a),sourceCtrl:c.sourceCtrl,targetCtrl:this,targetItem:null};this.dragEnter.emit(a)}};b.prototype.processDragLeave=function(a){if(this.isCtrlDragEntered){var c=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild),e=this.commonService.getMousePos(a),b=this.commonService.getShiftPos();e.x-=
b.x;e.y-=b.y;if(e.x<c.left||e.x>c.right||e.y<c.top||e.y>c.bottom)this.isCtrlDragEntered=!1,this.dropMark(a),this.stopScrollTimer(),c=this.dragDropService.getData(),a={action:a.shiftKey?"copy":"move",dragItem:c.source,dropPos:-1,event:a,isDropAllowed:!1,mousePos:this.commonService.getMousePos(a),sourceCtrl:c.sourceCtrl,targetCtrl:null,targetItem:null},this.dragLeave.emit(a)}};b.prototype.processDragOver=function(a,c,e,b){a.preventDefault();this.processDragEnter(a);var d=!0;a.dataTransfer?d="none"===
a.dataTransfer.effectAllowed?!1:!0:a.originalEvent&&a.originalEvent.dataTransfer&&(d="none"===a.originalEvent.dataTransfer.effectAllowed?!1:!0);if(d){var f=this.dragDropService.getData();d=this.commonService.getShiftPos();if(c){var g=this.commonService.getMousePos(a);g.x-=d.x;g.y-=d.y;g=this.dragDropService.getDropPos(g,e,b);d=this.isDropAllowed(f.source,c,g);e={action:a.shiftKey?"copy":"move",source:f.source,dropPos:g,allow:d,sourceCtrl:f.sourceCtrl,target:c,targetCtrl:this};e=this.callDragDropEvent(a,
e);if(d&&1!=e){b=this.commonService.getMousePos(a);e=b.y+16;b=b.x+20;var k="iui-dragwin-icon";switch(g){case 0:k+=" iui-dragwin-move-in";break;case 1:k+=" iui-dragwin-move-up";break;case 2:k+=" iui-dragwin-move-down"}a.shiftKey&&(k+="-copy");this.updateDragComponent({"class":k,top:e,left:b,text:c[this.options.dataFields.text]});this.dropMark(a,d);this.dragDropService.setData({action:a.shiftKey?"copy":"move",source:f.source,sourceCtrl:f.sourceCtrl,sourceData:f.sourceData,target:c,targetCtrl:this,dropPos:g})}else a.dataTransfer?
a.dataTransfer.dropEffect="none":a.originalEvent&&a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.dropEffect="none"),this.dropMark(a)}else this.options.allowDrop?(d=this.checkEmptySpace(a),e={action:a.shiftKey?"copy":"move",source:f.source,dropPos:-1,allow:d,sourceCtrl:f.sourceCtrl,target:null,targetCtrl:this},e=this.callDragDropEvent(a,e),d&&1!=e?(g=this.commonService.getMousePos(a),e=g.y+16,b=g.x+20,k="iui-dragwin-icon iui-dragwin-move-end",a.shiftKey&&(k+="-copy"),this.updateDragComponent({"class":k,
top:e,left:b,text:this.name?this.name:"Component"}),this.dropMark(a,d),this.dragDropService.setData({action:a.shiftKey?"copy":"move",source:f.source,sourceCtrl:f.sourceCtrl,sourceData:f.sourceData,target:null,targetCtrl:this,dropPos:-1})):(a.dataTransfer?a.dataTransfer.dropEffect="none":a.originalEvent&&a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.dropEffect="none"),this.dropMark(a))):(a.dataTransfer?a.dataTransfer.dropEffect="none":a.originalEvent&&a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.dropEffect=
"none"),this.dropMark(a))}};b.prototype.processDragDrop=function(a,c){a.preventDefault();this.dropMark(a);var e=!0;a.dataTransfer?e="none"===a.dataTransfer.effectAllowed?!1:!0:a.originalEvent&&a.originalEvent.dataTransfer&&(e="none"===a.originalEvent.dataTransfer.effectAllowed?!1:!0);if(e){var b=this.dragDropService.getData();(e=c?this.isDropAllowed(b.source,c,b.dropPos):this.checkEmptySpace(a))&&b.source&&(this.callDragDropEvent(a,{action:a.shiftKey?"copy":"move",source:b.source,dropPos:b.dropPos,
allow:e,sourceCtrl:b.sourceCtrl,target:b.target,targetCtrl:this},!0)||this.drop(a,b))}this.dragDropService.clearData()};b.prototype.drop=function(a,c){if(c&&c.sourceCtrl){var b=a.shiftKey&&c.clone?c.clone:c.source;if(Array.isArray(b)){for(var d=[],h=0;h<b.length;h++)d.push(b[h]);if(0<d.length){for(h=0;h<d.length;h++)this.processDataDrop(a,d[h],c);this.clearPrevSelection(d[d.length-1])}}else this.processDataDrop(a,b,c),this.clearPrevSelection(b);c.sourceCtrl!=c.targetCtrl&&c.sourceCtrl.updateLayout&&
c.sourceCtrl.updateLayout();this.updateLayout()}this.isCtrlDragEntered=!1};b.prototype.processDataDrop=function(a,c,b){var e=a.shiftKey;!a.shiftKey&&b.sourceCtrl&&b.sourceCtrl.removeItem&&(e=b.sourceCtrl.removeItem(c));if(e)switch(b.dropPos){case 0:this.insertItemAt(c,-1,b.target);break;case 1:this.insertItemBefore(c,b.target);break;case 2:this.insertItemAfter(c,b.target);break;default:this.addItem(c)}};b.prototype.callAfterSelectEvent=function(a){a={item:a};this.afterSelect.emit(a);this.selectionChanged.emit(a)};
b.prototype.itemDragStart=function(a,c){this.processDragStart(a,c.data);a.stopPropagation()};b.prototype.itemDragOver=function(a,c,b,d){if(this.isEnabled){var e=this.getItemElemList();e&&0<=b&&b<e.length&&(b=this.commonService.getPageRect(e[b].nativeElement),b={x:b.left,y:b.top,width:b.right-b.left,height:b.bottom-b.top},this.processScroll(a),this.processDragOver(a,c.data,b,d))}a.stopPropagation()};b.prototype.itemDragDrop=function(a,c){this.isEnabled&&this.processDragDrop(a,c.data);a.stopPropagation()};
b.prototype.exportToJSON=function(a,c){return JSON.stringify(this.items,a?a:[this.options.dataFields.allowDrag,this.options.dataFields.allowDrop,this.options.dataFields.allowEdit,this.options.dataFields.allowFocus,this.options.dataFields.autoCheck,this.options.dataFields.canSelect,this.options.dataFields.checkBoxSettings,this.options.dataFields.checked,this.options.dataFields.checkState,this.options.dataFields.content,this.options.dataFields.contextMenu,this.options.dataFields.enabled,this.options.dataFields.fixed,
this.options.dataFields.fixChildren,this.options.dataFields.hasChildren,this.options.dataFields.icon,this.options.dataFields.id,this.options.dataFields.selected,this.options.dataFields.showCheckBox,this.options.dataFields.statusIcon,this.options.dataFields.style,this.options.dataFields.templateObj,this.options.dataFields.text,this.options.dataFields.tooltip,this.options.dataFields.value,this.options.dataFields.visible],c?c:null)};b.prototype.filter=function(a){this.filterParams=a;this.updateLayout();
this.change.emit({type:"filtering"})};b.prototype.cloneItem=function(a){return this.dataService.clone(a)};b.prototype.createCloneList=function(a){for(var c=[],b=0;b<a.length;b++)c.push(this.cloneItem(a[b]));return c};b.prototype.getFilterTree=function(a){return a?this.filterService.createTree(a.conditions,a.formula):null};b.prototype.getObjFromItem=function(a){for(var c=null,b=0;b<this.currentList.length;b++)if(this.currentList[b].data==a){c=this.currentList[b];break}return c};b.prototype.getObjFromScrollItem=
function(a){for(var c=null,b=0;b<this.scrollItemList.length;b++){var d=this.scrollItemList[b];if(d.data==a){c=d;break}}return c};b.prototype.getItemCurrentIndex=function(a){if(a)return(a=this.getObjFromItem(a))&&this.currentList?this.currentList.indexOf(a):-1};b.prototype.getItemElemList=function(){return null};b.prototype.getItemFromComponent=function(a){return null};b.prototype.getList=function(a){switch(a){case "current":return this.currentList;case "selected":return this.currentSelectedItems}return this.dataService.getList()};
b.prototype.getTopItem=function(){return 0!=this.virtualMode?0<this.scrollItemList.length?this.scrollItemList[0].data:null:null};b.prototype.invokeMethod=function(a,c){var b=!0;if(this.isEnabled&&c)switch(a){case "SELECT_ITEM":b=this.processSelection(c.event,c.item);break;case "UPDATE_SELECTION":this.updateSelection(c.event,c.item)}return b};b.prototype.isChildOf=function(a,c){return!1};b.prototype.isComponentIndexInRange=function(a){return this.itemList?0<=a&&a<this.itemList.length:!1};b.prototype.isIndexInRange=
function(a){return this.currentList?0<=a&&a<this.currentList.length:!1};b.prototype.isItemAllowed=function(a){if(0==a[this.options.dataFields.visible])return!1;if(0==this.options.allowFilter)return!0;var c=!0;a&&this.filterParams&&(c=(c=a[this.options.dataFields.value])?c:a[this.options.dataFields.text],this.filterParams.callback?c=this.filterParams.callback(c,a):(c=this.filterService.match(c,this.filterParams.conditions,this.filterParams.formula,this.getFilterTree(this.filterParams),this.filterParams.caseSensitive),
!c&&this.filterParams.allowParent&&(c=this.filterIsThereChildren(a))));return c};b.prototype.filterIsThereChildren=function(a){var c=!1;if(a=a[this.options.dataFields.items])for(var b=0;b<a.length&&!(c=this.isItemAllowed(a[b]));b++);return c};b.prototype.isItemEnabled=function(a){return!0};b.prototype.isItemHovered=function(a){return a&&a==this.hoverItem?!0:!1};b.prototype.isItemSelected=function(a){return a&&1==a[this.options.dataFields.selected]?!0:!1};b.prototype.isParentOf=function(a,c){return!1};
b.prototype.updateItemList=function(){};b.prototype.itemMouseEnter=function(a,c){this.isEnabled&&!this.isScrollActive&&(this.hoverItem=c.data,this.updateItemStyle(c))};b.prototype.itemMouseLeave=function(a,c){this.isEnabled&&!this.isScrollActive&&(this.hoverItem=null,this.updateItemStyle(c))};b.prototype.itemGotFocus=function(a){this.refresh()};b.prototype.itemLostFocus=function(a){this.refresh()};b.prototype.itemKeyDown=function(a,c){if(this.isEnabled){var b={cancel:!1,item:c.data,event:a};this.keyDown.emit(b);
switch(a.keyCode){case 13:this.beforeEdit.emit(b);break;case 33:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processPageUpKey(c));break;case 34:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processPageDownKey(c));break;case 35:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processEndKey(c));break;case 36:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=
!0,this.processHomeKey(c));break;case 37:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processLeftArrowKey(c));break;case 38:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processUpArrowKey(c));break;case 39:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processRightArrowKey(c));break;case 40:!b.cancel&&this.options.allowFocus&&(a.preventDefault(),this.isKeyboardActive=!0,this.processDownArrowKey(c))}}};
b.prototype.itemKeyPress=function(a,c){this.isEnabled&&this.keyPress.emit({cancel:!1,item:c.data,event:a})};b.prototype.itemKeyUp=function(a,c){this.isEnabled&&this.keyUp.emit({cancel:!1,item:c.data,event:a})};b.prototype.processDownArrowKey=function(a,c){var b=this.getDownItem(a);if(b){this.currentFocusItem=b.data;var d=this,h=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(h)},1);this.isLastItem(b)&&this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y+2*this.avgItemHeight})}return b};
b.prototype.processEndKey=function(a,c){var b=null;if(0<this.scrollItemList.length){this.scrollPos({x:this.currentScrollPos.x,y:this.maxScrollPos.y});var d=this;setTimeout(function(){b=d.scrollItemList[d.scrollItemList.length-1];d.currentFocusItem=b.data;var a=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(a)},1)},1)}return b};b.prototype.processHomeKey=function(a,c){var b=null;if(0<this.scrollItemList.length){this.scrollPos({x:this.currentScrollPos.x,y:0});var d=this;setTimeout(function(){b=
d.scrollItemList[0];d.currentFocusItem=b.data;var a=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(a)},1)},1)}return b};b.prototype.processLeftArrowKey=function(a,c){return null};b.prototype.processPageDownKey=function(a,c){var b=null;if(0<this.scrollItemList.length){this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y+this.avgItemHeight*(this.scrollItemList.length-1)});var d=this;setTimeout(function(){var e=0<=a.index&&a.index<d.scrollItemList.length?a.index:d.scrollItemList.length-
1;d.currentScrollPos.y==d.maxScrollPos.y&&(e=d.scrollItemList.length-1);b=d.scrollItemList[e];d.currentFocusItem=b.data;var f=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(f)},1)},1)}return b};b.prototype.processPageUpKey=function(a,c){var b=null;if(0<this.scrollItemList.length){this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y-this.avgItemHeight*(this.scrollItemList.length-1)});var d=this;setTimeout(function(){var e=0<=a.index&&a.index<d.scrollItemList.length?
a.index:0;0==d.currentScrollPos.y&&(e=0);b=d.scrollItemList[e];d.currentFocusItem=b.data;var f=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(f)},1)},1)}return b};b.prototype.processRightArrowKey=function(a,c){return null};b.prototype.processUpArrowKey=function(a,c){var b=this.getUpItem(a);if(b){this.currentFocusItem=b.data;var d=this,h=setTimeout(function(){d.processSelection(c,b.data);clearTimeout(h)},1);this.isFirstItem(b)&&this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y-
this.avgItemHeight})}return b};b.prototype.getDownItem=function(a){a=0<=a.index&&a.index<this.scrollItemList.length-1?a.index+1:-1;return 0<=a?this.scrollItemList[a]:null};b.prototype.getUpItem=function(a){a=0<a.index?a.index-1:-1;return 0<=a?this.scrollItemList[a]:null};b.prototype.isFirstItem=function(a){return 0==a.index?!0:!1};b.prototype.isLastItem=function(a){return a.index==this.scrollItemList.length-2?!0:!1};b.prototype.moveFocusFromItem=function(a,b){if(!this.options.allowFocus)return null;
var c=null,d=this.getObjFromScrollItem(a);if(d)switch(b){case "down":c=this.processDownArrowKey(d);break;case "end":c=this.processEndKey(d);break;case "home":c=this.processHomeKey(d);break;case "left":c=this.processLeftArrowKey(d);break;case "pagedown":c=this.processPageDownKey(d);break;case "pageup":c=this.processPageUpKey(d);break;case "right":c=this.processRightArrowKey(d);break;case "up":c=this.processUpArrowKey(d)}return c?c.data:null};b.prototype.onWindowKeyDown=function(a){this.isEnabled&&
this.isKeyboardActive&&a.preventDefault()};b.prototype.onWindowKeyUp=function(a){this.isKeyboardActive=!1};b.prototype.getContentSize=function(){return{width:0,height:0}};b.prototype.refresh=function(){this.updateItemList();this.clearComponentSelection();for(var a=0;a<this.currentSelectedItems.length;a++){var c=this.getItemCurrentIndex(this.currentSelectedItems[a]);this.isComponentIndexInRange(c)&&(this.itemList[c].state|=integralui_core_1.IntegralUIObjectState.selected)}};b.prototype.updateBlockSize=
function(){this.blockSize={width:0,height:0}};b.prototype.resetLayout=function(){this.updateTimer&&clearTimeout(this.updateTimer);this.updateTimer=null};b.prototype.suspendLayout=function(){this.allowUpdate=!1};b.prototype.resumeLayout=function(){this.allowUpdate=!0;this.updateLayout()};b.prototype.updateLayout=function(){var a=this;a.allowUpdate&&(a.updateTimer=setTimeout(function(){a.updateCurrentList();a.clientRect={width:a.elemRef.nativeElement.firstElementChild.clientWidth,height:a.elemRef.nativeElement.firstElementChild.clientHeight};
a.virtualMode&&a.updateScrollItemList();var c=setTimeout(function(){a.updateVisibleRange();a.virtualMode&&a.updateScrollItemList();var b=setTimeout(function(){a.updateBlockSize();var c=a.getItemElemList();a.avgItemHeight=0;if(c&&0<c.length){for(var e=0,f=0;f<c.length;f++)e+=c[f].nativeElement.offsetHeight;a.avgItemHeight=Math.floor(e/c.length)}a.updateScrollSize();a.refresh();a.updateComplete.emit(null);clearTimeout(b)},1);clearTimeout(c)},1);clearTimeout(a.updateTimer)},100))};b.prototype.updateScrollSize=
function(){this.contentSize={width:this.clientRect.width-2,height:this.clientRect.height-2};this.scrollSize={width:0,height:this.avgItemHeight*this.currentList.length-this.clientRect.height+this.avgItemHeight};this.isVerScrollVisible()&&(this.contentSize.width-=18,0<this.scrollSize.width&&(this.scrollSize.width+=16));this.isHorScrollVisible()&&(this.scrollSize.height+=16);this.scrollSize.width=0<this.scrollSize.width?this.scrollSize.width:0;this.scrollSize.height=0<this.scrollSize.height?this.scrollSize.height:
0;this.maxScrollPos={x:this.scrollSize.width,y:this.scrollSize.height};this.currentScrollPos.x>this.maxScrollPos.x&&this.changeHorizontalScrollPos(this.maxScrollPos.x);this.currentScrollPos.y>this.maxScrollPos.y&&this.changeVerticalScrollPos(this.maxScrollPos.y);this.scrollBarSize={width:this.isVerScrollVisible()?this.clientRect.width-20:this.clientRect.width-4,height:this.isHorScrollVisible()?this.clientRect.height-20:this.clientRect.height-4};this.scrollLargeChange={x:this.scrollBarSize.width,y:this.scrollBarSize.height}};
b.prototype.updateVisibleRange=function(){this.visibleRange=1;var a=this.getItemElemList();if(a&&0<a.length){for(var c=0,b=0;b<a.length;b++)c+=a[b].nativeElement.offsetHeight;a=Math.floor(c/a.length);0<a&&(this.visibleRange=Math.floor(this.clientRect.height/a)+1)}};b.prototype.updateView=function(){this.currentIndex=0<this.avgItemHeight?Math.floor(this.currentScrollPos.y/this.avgItemHeight):0;this.currentIndex!=this.prevIndex&&(this.updateScrollItemList(),this.updateBlockSize(),this.prevIndex=this.currentIndex)};
b.prototype.updateCloneElemPos=function(a){1==a.buttons&&this.cloneElem&&(this.cloneElem.style.top=a.pageY-this.cloneElemStartPos.y+"px",this.cloneElem.style.left=a.pageX-this.cloneElemStartPos.x+"px")};b.prototype.onCtrlMouseEnter=function(a){this.isEnabled&&1==a.buttons&&this.cloneElem&&(this.cloneElem.style.display="block");this.elemRenderer.setElementStyle(this.elemRef.nativeElement,"cursor","default")};b.prototype.onCtrlMouseLeave=function(a){this.isEnabled&&1==a.buttons&&this.cloneElem&&(this.cloneElem.style.display=
"none");this.stopScrollTimer()};b.prototype.itemMouseDown=function(a,c){this.isEnabled&&(this.options.allowFocus&&1==a.buttons&&(this.currentFocusItem=c.data),this.processSelection(a,c.data));a.stopPropagation()};b.prototype.itemMouseUp=function(a,c){this.isEnabled&&this.updateSelection(a,c.data)};b.prototype.itemClickEvent=function(a,c){a.stopPropagation()};b.prototype.itemDblClickEvent=function(a,c){a.stopPropagation()};b.prototype.onScroll=function(a){a.target&&(this.virtualMode?(a.target.scrollTop=
0,a.target.scrollLeft=0):this.scrollPos({x:a.target.scrollLeft,y:a.target.scrollTop}))};b.prototype.scrollPos=function(a){if(0!=this.virtualMode)return a&&(this.currentScrollPos={x:Math.max(0,Math.min(a.x,this.maxScrollPos.x)),y:Math.max(0,Math.min(a.y,this.maxScrollPos.y))},this.scrollPosChanged.emit({value:this.currentScrollPos})),{x:Math.floor(this.currentScrollPos.x),y:Math.floor(this.currentScrollPos.y)};if(this.elemRef){var c=this.elemRef.nativeElement.firstElementChild.scrollWidth,b=this.elemRef.nativeElement.firstElementChild.scrollHeight;
this.maxScrollPos={x:c>this.elemRef.nativeElement.firstElementChild.clientWidth?c-this.elemRef.nativeElement.firstElementChild.clientWidth:0,y:b>this.elemRef.nativeElement.firstElementChild.clientHeight?b-this.elemRef.nativeElement.firstElementChild.clientHeight:0};a?(this.currentScrollPos.x=Math.max(0,Math.min(a.x,this.maxScrollPos.x)),this.currentScrollPos.y=Math.max(0,Math.min(a.y,this.maxScrollPos.y)),this.elemRef.nativeElement.firstElementChild.scrollLeft=this.currentScrollPos.x,this.elemRef.nativeElement.firstElementChild.scrollTop=
this.currentScrollPos.y,this.scrollPosChanged.emit({value:this.currentScrollPos})):(this.currentScrollPos.x=Math.max(0,Math.min(this.elemRef.nativeElement.firstElementChild.scrollLeft,this.maxScrollPos.x)),this.currentScrollPos.y=Math.max(0,Math.min(this.elemRef.nativeElement.firstElementChild.scrollTop,this.maxScrollPos.y)))}return this.currentScrollPos};b.prototype.changeHorizontalScrollPos=function(a){this.currentScrollPos.x=Math.max(0,Math.min(a,this.maxScrollPos.x));this.currentScrollPos.x!=
this.prevScrollPos.x&&(this.scrollPosChanged.emit({value:this.scrollPos()}),this.prevScrollPos.x=this.currentScrollPos.x)};b.prototype.changeVerticalScrollPos=function(a){this.currentScrollPos.y=Math.max(0,Math.min(a,this.maxScrollPos.y));this.currentScrollPos.y!=this.prevScrollPos.y&&(this.updateView(),this.scrollPosChanged.emit({value:this.scrollPos()}),this.prevScrollPos.y=this.currentScrollPos.y)};b.prototype.processMouseWheel=function(a,b){if(this.isEnabled&&0!=this.virtualMode){a.preventDefault();
this.hoverItem=null;var c=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));if(this.isVerScrollVisible()){var d=Math.floor(this.clientRect.height/4);c=this.currentScrollPos.y+d*c*-1;this.changeVerticalScrollPos(c)}else b&&this.isHorScrollVisible()&&(d=Math.floor(this.clientRect.width/4),c=this.currentScrollPos.x+d*c*-1,this.changeHorizontalScrollPos(c));a.stopPropagation()}};b.prototype.isVerScrollVisible=function(){return this.isEnabled&&this.options.showScroll.vertical&&0<this.scrollSize.height?
!0:!1};b.prototype.isHorScrollVisible=function(){return this.isEnabled&&this.options.showScroll.horizontal&&0<this.scrollSize.width?!0:!1};b.prototype.onVerticalScrollStart=function(a){this.hoverItem=null;this.isScrollActive=!0};b.prototype.onVerticalScrollEnd=function(a){this.isScrollActive=!1};b.prototype.onVerticalScrollChanged=function(a){this.changeVerticalScrollPos(a.value)};b.prototype.onHorizontalScrollStart=function(a){this.hoverItem=null;this.isScrollActive=!0};b.prototype.onHorizontalScrollEnd=
function(a){this.isScrollActive=!1};b.prototype.onHorizontalScrollChanged=function(a){this.currentScrollPos.x=a.value;this.scrollPosChanged.emit({value:this.scrollPos()})};b.prototype.processScroll=function(a){if(this.isVerScrollVisible()){var c=this.commonService.getShiftPos();a=this.commonService.getMousePos(a);a.x-=c.x;a.y-=c.y;var b=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild);c=b.top+25;b=b.bottom-25;this.isHorScrollVisible()&&(b-=16);a.y<c?this.startScrollTimer(!1):
a.y>b?this.startScrollTimer(!0):this.stopScrollTimer()}else this.stopScrollTimer()};b.prototype.startScrollTimer=function(a,b){var c=this;c.isScrollTimerActive||(c.accelerator=.5,c.scrollCount=0,c.isScrollTimerActive=!0,c.scrollTimerID||(c.scrollTimerID=setInterval(function(){c.scrollTimerElapsed(a)},b?b:100)))};b.prototype.stopScrollTimer=function(){this.scrollTimerID&&(clearInterval(this.scrollTimerID),this.scrollTimerID=null);this.accelerator=.5;this.scrollCount=0;this.isScrollTimerActive=!1};
b.prototype.scrollTimerElapsed=function(a){var b=this.currentScrollPos;0===this.scrollCount&&(this.scrollCount=5);this.scrollCount+=5;this.accelerator+=.5;var e=this.scrollCount+=Math.floor(this.accelerator);this.currentScrollPos.y=a?this.currentScrollPos.y+e>this.maxScrollPos.y?this.maxScrollPos.y:this.currentScrollPos.y+e:0>this.currentScrollPos.y-e?0:this.currentScrollPos.y-e;(0>=b.y||this.currentScrollPos.y<b.y)&&this.stopScrollTimer()};b.prototype.scrollTo=function(a){0!=this.virtualMode&&a&&
(a=this.getItemCurrentIndex(a),0<=a&&this.scrollPos({x:this.currentScrollPos.x,y:this.avgItemHeight*(a+this.visibleRange/2)}),this.updateLayout())};b.prototype.findItemById=function(a){return this.dataService.findObjectById(a)};b.prototype.findItemByText=function(a){return this.dataService.findObjectByText(a)};b.prototype.clearSelection=function(){this.clearPrevSelection();this.refresh()};b.prototype.clearComponentSelection=function(){this.itemList.forEach(function(a){return a.state&=~integralui_core_1.IntegralUIObjectState.selected})};
b.prototype.clearPrevSelection=function(a){for(var b=0;b<this.currentSelectedItems.length;b++)a&&!this.commonService.isEqual(this.currentSelectedItems[b][this.options.dataFields.id],a[this.options.dataFields.id])?this.currentSelectedItems[b][this.options.dataFields.selected]=!1:a||(this.currentSelectedItems[b][this.options.dataFields.selected]=!1);this.currentSelectedItems.length=0;a&&this.isItemEnabled(a)&&this.currentSelectedItems.push(a)};b.prototype.isItemInSelectionList=function(a){var b=!1,
e=this.currentSelectedItems;if(a&&e)for(var d=0;d<e.length;d++)if(this.commonService.isEqual(e[d][this.options.dataFields.id],a[this.options.dataFields.id])){b=!0;break}return b};b.prototype.processSelection=function(a,b,e){var c=!0;if(b){if(this.selectionMode==integralui_core_1.IntegralUISelectionMode.None||0==b[this.options.dataFields.canSelect])return;var h=0<this.currentSelectedItems.length;if(this.isItemEnabled(b)){var f=this.currentSelection,g=!0;f&&(g=a&&(a.ctrlKey||a.metaKey)||!this.commonService.isEqual(f[this.options.dataFields.id],
b[this.options.dataFields.id])||0==f[this.options.dataFields.selected]);var k={cancel:!1,item:b};this.beforeSelect.emit(k);c=1==k.cancel?!1:!0;if(1!=k.cancel)if(k=a&&(a.shiftKey||a.ctrlKey||a.metaKey)?!0:!1,g){this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiExtended&&(g=!this.isItemInSelectionList(b)||!k||a&&a.shiftKey);g&&(this.selectionMode==integralui_core_1.IntegralUISelectionMode.One?this.clearPrevSelection():a&&a.shiftKey?this.clearPrevSelection():k||this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiSimple||
1!=this.currentSelectedItems.length&&this.isItemInSelectionList(b)||this.clearPrevSelection());this.currentSelection=b;if(a&&a.shiftKey&&this.selectionMode!=integralui_core_1.IntegralUISelectionMode.One){if(this.shiftFirstSelectedItem||(this.shiftFirstSelectedItem=f),a=this.getItemCurrentIndex(this.shiftFirstSelectedItem),e=this.getItemCurrentIndex(b),a>e&&(h=a,a=e,e=h),this.isIndexInRange(a)&&this.isIndexInRange(e))for(;a<=e;a++)0!=this.currentList[a].data[this.options.dataFields.canSelect]&&(this.currentList[a].data[this.options.dataFields.selected]=
!0,this.currentSelectedItems.push(this.currentList[a].data))}else k||this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiSimple?(a=null==b[this.options.dataFields.selected]||"undefined"==b[this.options.dataFields.selected]?!1:b[this.options.dataFields.selected],b[this.options.dataFields.selected]=!a,b[this.options.dataFields.selected]?this.isItemInSelectionList(b)||this.currentSelectedItems.push(b):this.currentSelectedItems=this.currentSelectedItems.filter(function(a){return a!=b})):
(b[this.options.dataFields.selected]=!0,this.isItemInSelectionList(b)||this.currentSelectedItems.push(b)),this.shiftFirstSelectedItem=null;this.callAfterSelectEvent(b);this.refresh()}else k||this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiSimple?(a=null===b[this.options.dataFields.selected]||"undefined"==b[this.options.dataFields.selected]?!1:b[this.options.dataFields.selected],e&&"undefined"!=e&&(a=e),b[this.options.dataFields.selected]=!a,b[this.options.dataFields.selected]?this.isItemInSelectionList(b)||
this.currentSelectedItems.push(b):this.currentSelectedItems=this.currentSelectedItems.filter(function(a){return a!=b}),this.shiftFirstSelectedItem=null,this.callAfterSelectEvent(b),this.refresh()):k||this.selectionMode&integralui_core_1.IntegralUISelectionMode.MultiSimple||1!=this.currentSelectedItems.length&&this.isItemInSelectionList(b)||(this.shiftFirstSelectedItem=null,this.clearPrevSelection(b),this.refresh(),g&&h&&this.selectionChanged.emit({item:null}))}else this.clearPrevSelection(),this.refresh(),
h&&this.selectionChanged.emit({item:null})}return c};b.prototype.selectItems=function(a){if(a&&Array.isArray(a)){for(var b=this.currentSelectedItems.length=0;b<a.length;b++)a[b][this.options.dataFields.selected]=!0,this.currentSelectedItems.push(a[b]);0<a.length?(this.currentSelection=a[a.length-1],this.callAfterSelectEvent(this.currentSelection)):this.currentSelection=null;this.refresh()}};b.prototype.updateSelection=function(a,b){var c=a&&(a.shiftKey||a.ctrlKey||a.metaKey)?!0:!1;this.selectionMode==
integralui_core_1.IntegralUISelectionMode.MultiExtended&&0!=b[this.options.dataFields.canSelect]&&0<this.currentSelectedItems.length&&!a.shiftKey&&!c&&1==a.which&&(c=this.currentSelectedItems.length,this.clearPrevSelection(),b[this.options.dataFields.selected]=!0,this.currentSelectedItems.push(b),1<c&&this.callAfterSelectEvent(b),this.refresh())};b.prototype.applySorting=function(a){var b=this;a&&(b.sortComparer?a.sort(b.sortComparer):b.isSortingAllowed()&&a.sort(function(a,c){var d,e;(d=a[b.options.dataFields.value])||
(d=a[b.options.dataFields.text]);b.commonService.isObject(d)&&(d=d.value?d.value:d.text);(e=c[b.options.dataFields.value])||(e=c[b.options.dataFields.text]);b.commonService.isObject(e)&&(e=e.value?e.value:e.text);d=void 0!=d?d:null;e=void 0!=e?e:null;switch(b.options.sorting){case integralui_core_1.IntegralUISortOrder.Ascending:if(d<e)return-1;if(d>e)return 1;break;case integralui_core_1.IntegralUISortOrder.Descending:if(d>e)return-1;if(d<e)return 1;break;default:return 0}}))};b.prototype.isSortingAllowed=
function(){return this.options.sorting==integralui_core_1.IntegralUISortOrder.Ascending||this.options.sorting==integralui_core_1.IntegralUISortOrder.Descending};b.prototype.sort=function(a,b){this.options.sorting=a;this.sortComparer=b?b:null;this.updateLayout();this.change.emit({type:"sorting"})};b.prototype.updateItemStyle=function(a){a&&(a.style={general:[],content:[]},a.style.general.push(this.itemClassName),a.style.general.push(this.options.currentStyle.item.general.normal),a.style.content.push(this.itemContentClassName),
a.style.content.push(this.options.currentStyle.item.content.normal),this.isItemEnabled(a.data)?this.isItemSelected(a.data)?(a.style.general.push(this.options.currentStyle.item.general.selected),a.style.content.push(this.options.currentStyle.item.content.selected)):this.isItemHovered(a.data)&&(a.style.general.push(this.options.currentStyle.item.general.hovered),a.style.content.push(this.options.currentStyle.item.content.hovered)):(a.style.general.push(this.options.currentStyle.item.general.disabled),
a.style.content.push(this.options.currentStyle.item.content.disabled)),a.data==this.currentFocusItem&&a.style.general.push(this.options.currentStyle.item.general.focused))};b.prototype.getItemStyle=function(a){return a?{general:this.getItemGeneralStyle(a.general),content:this.getItemContentStyle(a.content)}:this.getDefaultItemStyle()};b.prototype.getItemGeneralStyle=function(a){return this.commonService.isString(a)?a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,this.itemClassName+"-disabled"),
focused:this.commonService.isFieldAvailable(a.focused,this.itemClassName+"-focused"),normal:this.commonService.isFieldAvailable(a.normal,this.itemClassName),hovered:this.commonService.isFieldAvailable(a.hovered,this.itemClassName+"-hovered"),selected:this.commonService.isFieldAvailable(a.selected,this.itemClassName+"-selected")}:this.getDefaultItemGeneralStyle()};b.prototype.getItemContentStyle=function(a){return this.commonService.isString(a)?a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,
this.itemContentClassName+"-disabled"),focused:this.commonService.isFieldAvailable(a.focused,this.itemContentClassName+"-focused"),normal:this.commonService.isFieldAvailable(a.normal,this.itemContentClassName),hovered:this.commonService.isFieldAvailable(a.hovered,this.itemContentClassName+"-hovered"),selected:this.commonService.isFieldAvailable(a.selected,this.itemContentClassName+"-selected")}:this.getDefaultItemContentStyle()};b.prototype.getDefaultListStyle=function(){return{general:this.getDefaultGeneralStyle(),
item:this.getDefaultItemStyle()}};b.prototype.getDefaultItemStyle=function(){return{general:this.getDefaultItemGeneralStyle(),content:this.getDefaultItemContentStyle()}};b.prototype.getDefaultItemGeneralStyle=function(){return{disabled:this.defaultStyle.item.general.disabled,focused:this.defaultStyle.item.general.focused,normal:this.defaultStyle.item.general.normal,hovered:this.defaultStyle.item.general.hovered,selected:this.defaultStyle.item.general.selected}};b.prototype.getDefaultItemContentStyle=
function(){return{disabled:this.defaultStyle.item.content.disabled,focused:this.defaultStyle.item.content.focused,normal:this.defaultStyle.item.content.normal,hovered:this.defaultStyle.item.content.hovered,selected:this.defaultStyle.item.content.selected}};b.prototype.updateStyle=function(a){this.options.currentStyle=a?{general:this.getGeneralStyle(a.general),item:this.getItemStyle(a.item)}:this.getDefaultListStyle()};b.prototype.itemTouchStart=function(a,b){this.isEnabled&&(this.options.allowFocus&&
1==a.buttons&&(this.currentFocusItem=b.data),this.processSelection(a,b.data))};b.prototype.itemTouchMove=function(a,b){};b.prototype.itemTouchEnd=function(a,b){};b.prototype.ctrlTouchStart=function(a){a.preventDefault();this.isEnabled&&(a=this.commonService.getTouchData(a))&&0<a.length&&(this.touchStartPos={x:a[0].pageX,y:a[0].pageY})};b.prototype.ctrlTouchEnd=function(a){var b=this;if(b.isEnabled){(a=b.commonService.getTouchData(a))&&0<a.length&&(b.touchEndPos={x:a[0].pageX,y:a[0].pageY});var e=
b.touchEndPos.x-b.touchStartPos.x,d=b.touchEndPos.y-b.touchStartPos.y,h=!1,f=!1,g=b.touchStartPos,k=b.currentScrollPos.x,l=b.currentScrollPos.y,m=setInterval(function(){var a=b.currentScrollPos;-20>e?(g.x-=10,g.x>b.touchEndPos.x?a.x+=10:(a.x=k-e,h=!0)):20<e?(g.x+=10,g.x<b.touchEndPos.x?a.x-=10:(a.x=k-e,h=!0)):h=!0;-20>d?(g.y-=10,g.y>b.touchEndPos.y?a.y+=10:(a.y=l-d,f=!0)):20<d?(g.y+=10,g.y<b.touchEndPos.y?a.y-=10:(a.y=l-d,f=!0)):f=!0;b.scrollPos(a);h&&f&&clearInterval(m)},5);b.touchStartPos=b.touchEndPos}};
return b}(integralui_core_1.IntegralUIBaseComponent);__decorate([core_1.Input(),__metadata("design:type",Object)],IntegralUIBaseList.prototype,"appRef",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIBaseList.prototype,"allowDrag",null);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIBaseList.prototype,"allowDrop",null);
__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIBaseList.prototype,"allowFilter",null);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIBaseList.prototype,"allowFocus",null);__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],IntegralUIBaseList.prototype,"focusedItem",null);
__decorate([core_1.Input(),__metadata("design:type",Array),__metadata("design:paramtypes",[Array])],IntegralUIBaseList.prototype,"items",null);__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],IntegralUIBaseList.prototype,"showScroll",null);__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],IntegralUIBaseList.prototype,"selectedItem",null);
__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],IntegralUIBaseList.prototype,"selectionMode",null);__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],IntegralUIBaseList.prototype,"sorting",null);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],IntegralUIBaseList.prototype,"virtualMode",null);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"afterSelect",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"beforeEdit",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"beforeSelect",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"change",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"clear",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"dragEnter",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"dragDrop",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"dragLeave",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"dragOver",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"itemAdding",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"itemAdded",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"itemRemoving",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"itemRemoved",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"keyDown",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"keyPress",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"keyUp",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"loadComplete",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"scrollPosChanged",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"selectionChanged",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIBaseList.prototype,"updateComplete",void 0);__decorate([core_1.HostListener("document:keydown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],IntegralUIBaseList.prototype,"onWindowKeyDown",null);
__decorate([core_1.HostListener("document:keyup",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],IntegralUIBaseList.prototype,"onWindowKeyUp",null);
IntegralUIBaseList=__decorate([core_1.Component({selector:"iui-baselist",template:"",providers:[integralui_data_service_1.IntegralUIDataService]}),__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,integralui_dragdrop_service_1.IntegralUIDragDropService,core_1.ElementRef,core_1.Renderer,integralui_common_service_1.IntegralUICommonService,integralui_filter_service_1.IntegralUIFilterService,core_1.ComponentFactoryResolver])],IntegralUIBaseList);
exports.IntegralUIBaseList=IntegralUIBaseList;