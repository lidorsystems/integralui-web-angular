/*
  filename: integralui.datepicker.js
  version : 1.0.0
  Copyright Â© 2016-2018 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,a){c.__proto__=a}||function(c,a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b])};return function(c,a){function b(){this.constructor=c}e(c,a);c.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_calendar_1=require("./integralui.calendar"),IntegralUICalendarPopup=function(e){function c(a){var b=e.call(this,a)||this;b.elemRef=a;b.calendarDisplayPosition="absolute";b.calendarPos={top:-9999,left:0};b.calendarOpacity=0;b.calendarSize={width:0,height:0};b.firstDayOfWeek=integralui_core_1.IntegralUIWeekDays.Sunday;b.closed=new core_1.EventEmitter;
b.dateChanged=new core_1.EventEmitter;return b}__extends(c,e);Object.defineProperty(c.prototype,"size",{get:function(){return this.ctrlSize},set:function(a){a&&(a.width&&this.ctrlSize.width!=a.width&&(this.ctrlSize.width=a.width),a.height&&this.ctrlSize.height!=a.height&&(this.ctrlSize.height=a.height),this.calendarSize={width:this.ctrlSize.width-2,height:this.ctrlSize.height-2})},enumerable:!0,configurable:!0});c.prototype.ngOnInit=function(){this.calendarDisplayPosition=this.allowAnimation?"absolute":
"relative";this.generalClassName="iui-popup";this.initStyle()};c.prototype.ngAfterContentInit=function(){this.focus()};c.prototype.ngAfterViewInit=function(){this.calendarSize={width:this.ctrlSize.width-2,height:this.ctrlSize.height-2};this.open()};c.prototype.open=function(){var a=this;if(a.allowAnimation){a.calendarOpacity=0;a.calendarPos.top=-a.calendarSize.height;var b=1E-4*a.calendarSize.height/4,c=setInterval(function(){0>a.calendarPos.top?(a.calendarPos.top+=4,a.calendarOpacity+=b):(a.calendarPos.top=
0,a.calendarOpacity=1,clearInterval(c))},5)}else a.calendarPos.top=0,a.calendarOpacity=1};c.prototype.close=function(a){var b=this;if(b.allowAnimation){b.calendarOpacity=1;b.calendarPos.top=0;var c=1E-4*b.calendarSize.height/4,d=setInterval(function(){b.calendarPos.top>-b.calendarSize.height?(b.calendarPos.top-=4,b.calendarOpacity-=c):(b.calendarPos.top=-b.calendarSize.height,b.calendarOpacity=0,b.closed.emit({value:a}),b.calendar&&b.calendar.reset(),clearInterval(d))},5)}else b.closed.emit({value:a}),
b.calendar&&b.calendar.reset()};c.prototype.calendarDateChanged=function(a){this.dateChanged.emit({date:a.date})};c.prototype.onBlur=function(a){this.close(this.date)};c.prototype.refresh=function(){this.calendar.refresh()};c.decorators=[{type:core_1.Component,args:[{selector:"iui-calendar-popup",template:'\n        <div [ngClass]="getControlClass()" style="position:absolute;overflow:hidden;z-index:999" [ngStyle]="getControlStyle()" (blur)="onBlur($event)" tabindex="999">\n            <div style="left:0;" [ngStyle]="{ position: calendarDisplayPosition, top: calendarPos.top + \'px\', opacity: calendarOpacity }">\n                <iui-calendar [allowAnimation]="true" [controlStyle]="calendarStyle" [firstDayOfWeek]="firstDayOfWeek" [size]="calendarSize" [selectedDate]="date" (dateChanged)="calendarDateChanged($event)" #calendar></iui-calendar>\n            </div>\n        </div>\n    ',
encapsulation:core_1.ViewEncapsulation.None}]}];c.ctorParameters=function(){return[{type:core_1.ElementRef}]};c.propDecorators={calendar:[{type:core_1.ViewChild,args:["calendar"]}],date:[{type:core_1.Input}],calendarStyle:[{type:core_1.Input}],firstDayOfWeek:[{type:core_1.Input}],size:[{type:core_1.Input}],closed:[{type:core_1.Output}],dateChanged:[{type:core_1.Output}]};return c}(integralui_core_1.IntegralUIPopup);exports.IntegralUICalendarPopup=IntegralUICalendarPopup;
var IntegralUIDatePicker=function(e){function c(a,b,c){var d=e.call(this,b)||this;d.elemRef=a;d.commonService=b;d.cmpResolver=c;d.calendarRef=null;d.calendar=null;d.buttonMargin={top:2,right:2,bottom:2,left:2};d.currentCalendarSize={width:250,height:200};d.headerMargin={top:0,right:0,bottom:0,left:0};d.headerSize={width:0,height:0};d.titleMargin={top:2,right:2,bottom:2,left:2};d.titleSize={width:0,height:0};d.updateTimer=null;d.headerClass=[];d.calendarFirstDayOfWeek=integralui_core_1.IntegralUIWeekDays.Sunday;
d.format=integralui_core_1.IntegralUIDateFormat.Short;d.locales="en-us";d.dateChanged=new core_1.EventEmitter;return d}__extends(c,e);c.prototype.ngOnInit=function(){this.currentSelectedDate||(this.currentSelectedDate=new Date);this.generalClassName="iui-datepicker";this.headerClassName=this.generalClassName+"-header";this.initStyle()};c.prototype.ngAfterViewInit=function(){this.updateLayout()};c.prototype.initStyle=function(){this.defaultStyle={general:{disabled:this.generalClassName+"-disabled",
focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},header:{disabled:this.headerClassName+"-disabled",focused:this.headerClassName+"-focused",normal:this.headerClassName,hovered:this.headerClassName+"-hovered",selected:this.headerClassName+"-selected"},calendar:{}};this.updateStyle(this.controlStyle);this.updateControlClass();this.updateHeaderClass()};c.prototype.ngOnDestroy=function(){this.removeCalendar()};
Object.defineProperty(c.prototype,"calendarSize",{get:function(){return this.currentCalendarSize},set:function(a){a&&(a.width&&this.currentCalendarSize.width!=a.width&&(this.currentCalendarSize.width=a.width),a.height&&this.currentCalendarSize.height!=a.height&&(this.currentCalendarSize.height=a.height))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"selectedDate",{get:function(){return this.currentSelectedDate},set:function(a){this.currentSelectedDate!=a&&(this.currentSelectedDate=
a,this.dateChanged.emit({date:this.currentSelectedDate}))},enumerable:!0,configurable:!0});c.prototype.getSelectedDate=function(){var a="";if(this.currentSelectedDate){a={year:"numeric",month:"numeric",day:"numeric"};switch(this.format){case integralui_core_1.IntegralUIDateFormat.Long:a.weekday="long";break;case integralui_core_1.IntegralUIDateFormat.Custom:a=this.formatOptions}a=this.currentSelectedDate.toLocaleString(this.locales,a)}return a};c.prototype.addCalendar=function(){if(this.appRef){this.removeCalendar();
var a=this.cmpResolver.resolveComponentFactory(IntegralUICalendarPopup);a&&(this.calendarRef=this.appRef.createComponent(a),this.calendarRef._component?this.calendar=this.calendarRef._component:this.calendarRef._hostElement&&(this.calendar=this.calendarRef._hostElement.component))}};c.prototype.hideCalendar=function(){this.calendar&&(this.calendar.display="none")};c.prototype.removeCalendar=function(){this.calendar&&(this.calendar.closed&&this.calendar.closed.unsubscribe(),this.calendar.dateChanged&&
this.calendar.dateChanged.unsubscribe());this.calendarRef&&this.calendarRef.destroy();this.calendar=null};c.prototype.showCalendar=function(a){var b=this;b.calendar||b.addCalendar();if(b.calendar){a=b.commonService.getShiftPos();var c=b.commonService.getPageRect(b.elemRef.nativeElement);b.calendar.allowAnimation=b.allowAnimation;b.calendar.date=b.selectedDate;b.calendar.display="block";b.calendar.firstDayOfWeek=b.calendarFirstDayOfWeek;b.calendar.position={x:c.left+a.x,y:c.bottom+a.y};b.calendar.size=
b.calendarSize;b.calendar.closed.subscribe(function(a){b.removeCalendar()});b.calendar.dateChanged.subscribe(function(a){b.selectedDate=a.date;b.removeCalendar()})}};c.prototype.updateLayout=function(){var a=this;a.updateTimer=setTimeout(function(){a.clientRect={width:a.elemRef.nativeElement.firstElementChild.clientWidth,height:a.elemRef.nativeElement.firstElementChild.clientHeight};a.headerSize={width:a.clientRect.width-4,height:a.headerElem.nativeElement.offsetHeight};a.updateHeaderLayout();clearTimeout(a.updateTimer)},
1)};c.prototype.updateHeaderLayout=function(){var a=this,b=setTimeout(function(){a.headerMargin={top:(a.clientRect.height-a.headerElem.nativeElement.offsetHeight)/2-2,right:0,bottom:0,left:0};a.buttonMargin={top:(a.headerSize.height-a.headerButtonElem.nativeElement.offsetHeight)/2,right:0,bottom:0,left:2};a.titleMargin={top:(a.headerSize.height-a.headerTitleElem.nativeElement.offsetHeight)/2,right:2,bottom:0,left:2};a.titleSize={width:a.headerSize.width-(a.headerButtonElem.nativeElement.offsetWidth+
a.buttonMargin.left+a.buttonMargin.right)-(a.titleMargin.left+a.titleMargin.right)-2,height:a.headerSize.height};clearTimeout(b)},1)};c.prototype.openCalendar=function(a){this.showCalendar(a)};c.prototype.getControlStyle=function(){var a={};0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};c.prototype.updateHeaderClass=function(){this.headerClass.length=0;this.headerClass.push(this.headerClassName);this.options.currentStyle&&
(this.headerClass.push(this.options.currentStyle.header.normal),this.state&integralui_core_1.IntegralUIObjectState.disabled?this.headerClass.push(this.options.currentStyle.header.disabled):this.state&integralui_core_1.IntegralUIObjectState.focused?this.headerClass.push(this.options.currentStyle.header.focused):this.state&integralui_core_1.IntegralUIObjectState.selected?this.headerClass.push(this.options.currentStyle.header.selected):this.state&integralui_core_1.IntegralUIObjectState.hovered&&this.headerClass.push(this.options.currentStyle.header.hovered))};
c.prototype.getHeaderClass=function(){return this.headerClass};c.prototype.getHeaderStyle=function(a){return this.commonService.isString(a)?a:a?{disabled:this.commonService.isFieldAvailable(a.disabled,this.headerClassName+"-disabled"),focused:this.commonService.isFieldAvailable(a.focused,this.headerClassName+"-focused"),hovered:this.commonService.isFieldAvailable(a.hovered,this.headerClassName+"-hovered"),normal:this.commonService.isFieldAvailable(a.normal,this.headerClassName),selected:this.commonService.isFieldAvailable(a.selected,
this.headerClassName+"-selected")}:{disabled:this.defaultStyle.header.disabled,focused:this.defaultStyle.header.focused,hovered:this.defaultStyle.header.hovered,normal:this.defaultStyle.header.normal,selected:this.defaultStyle.header.selected}};c.prototype.updateStyle=function(a){this.options.currentStyle=a?{general:this.getGeneralStyle(a.general),header:this.getHeaderStyle(a.header)}:{general:{disabled:this.defaultStyle.general.disabled,focused:this.defaultStyle.general.focused,hovered:this.defaultStyle.general.hovered,
normal:this.defaultStyle.general.normal,selected:this.defaultStyle.general.selected},header:{disabled:this.defaultStyle.header.disabled,focused:this.defaultStyle.header.focused,hovered:this.defaultStyle.header.hovered,normal:this.defaultStyle.header.normal,selected:this.defaultStyle.header.selected}}};c.prototype.refresh=function(){var a=this,b=setTimeout(function(){a.updateStyle(a.controlStyle);a.updateControlClass();a.updateHeaderClass();clearTimeout(b)},1)};c.decorators=[{type:core_1.Component,
args:[{selector:"iui-datepicker",template:"\n\t\t<div [ngClass]=\"getControlClass()\" [ngStyle]=\"getControlStyle()\">\n            <div class=\"iui-datepicker-header\" [ngStyle]=\"{ 'margin-top': headerMargin.top + 'px' }\" #header>\n                <div class=\"iui-datepicker-header-button iui-datepicker-header-button-down\" [ngStyle]=\"{ 'margin-top': buttonMargin.top + 'px', 'margin-right': buttonMargin.right + 'px' }\" (mousedown)=\"openCalendar($event)\" #headerButton><span></span></div>\n                <div class=\"iui-datepicker-header-title\" [ngStyle]=\"{ 'margin-top': titleMargin.top + 'px', 'margin-left': titleMargin.left + 'px', width: titleSize.width + 'px' }\" #headerTitle><span>{{getSelectedDate()}}</span></div>\n            </div>\n\t\t</div>\n\t",
inputs:"controlStyle data enabled name size state".split(" "),encapsulation:core_1.ViewEncapsulation.None}]}];c.ctorParameters=function(){return[{type:core_1.ElementRef},{type:integralui_common_service_1.IntegralUICommonService},{type:core_1.ComponentFactoryResolver}]};c.propDecorators={headerElem:[{type:core_1.ViewChild,args:["header",{read:core_1.ElementRef}]}],headerButtonElem:[{type:core_1.ViewChild,args:["headerButton",{read:core_1.ElementRef}]}],headerTitleElem:[{type:core_1.ViewChild,args:["headerTitle",
{read:core_1.ElementRef}]}],appRef:[{type:core_1.Input}],calendarFirstDayOfWeek:[{type:core_1.Input}],calendarSize:[{type:core_1.Input}],format:[{type:core_1.Input}],formatOptions:[{type:core_1.Input}],locales:[{type:core_1.Input}],selectedDate:[{type:core_1.Input}],dateChanged:[{type:core_1.Output}]};return c}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIDatePicker=IntegralUIDatePicker;