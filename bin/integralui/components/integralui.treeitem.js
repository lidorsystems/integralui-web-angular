/*
  filename: integralui.treeitem.js
  version : 2.2.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var g=function(b,f){g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return g(b,f)};return function(b,f){function a(){this.constructor=b}g(b,f);b.prototype=null===f?Object.create(f):(a.prototype=f.prototype,new a)}}(),__decorate=this&&this.__decorate||function(g,b,f,a){var c=arguments.length,d=3>c?b:null===a?a=Object.getOwnPropertyDescriptor(b,f):a,e;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(g,b,f,a);else for(var h=g.length-1;0<=h;h--)if(e=g[h])d=(3>c?e(d):3<c?e(b,f,d):e(b,f))||d;return 3<c&&d&&Object.defineProperty(b,f,d),d},__metadata=this&&this.__metadata||function(g,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(g,b)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_listitem_1=require("./integralui.listitem"),IntegralUITreeItem=function(g){function b(a,b,d,e){var c=g.call(this,a,d,e)||this;c.elemRef=a;c.dataService=b;c.commonService=d;c.baseService=e;c.contentAnimation={display:"none",left:0,width:0,height:0};c.numItems=
0;c.templateData=[];c.expandState="none";c.blockElemHeight="0";c.eventList=[];c.parentItem=null;c.blockClass=[];c.expandBoxClass=[];c.isExpandBoxTouched=!1;c.itemClick=new core_1.EventEmitter;c.itemDblClick=new core_1.EventEmitter;c.itemRightClick=new core_1.EventEmitter;return c}__extends(b,g);var f=b;Object.defineProperty(b.prototype,"expanded",{get:function(){return this.isExpanded},set:function(a){if(this.isExpanded!=a){var b=!0;this.parentCtrl&&this.parentCtrl.invokeEvent&&(b=this.parentCtrl.invokeEvent(a?
"BEFORE_EXPAND":"BEFORE_COLLAPSE",this.data));b&&(this.expandState=a?"expand":"collapse",this.isExpanded=a,this.parentCtrl&&this.parentCtrl.invokeMethod("CHANGE_EXPANDED",{component:this}),this.updateBlockClass(),this.updateExpandBoxClass(),this.toggleContent(),this.parentCtrl&&this.parentCtrl.invokeEvent&&this.parentCtrl.invokeEvent(a?"AFTER_EXPAND":"AFTER_COLLAPSE",this.data))}},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.templateData.push(this.data);this.parentCtrl=this.baseService.getComponent();
this.dataService.init([{data:this.items}]);this.isExpanded=this.parentCtrl?this.parentCtrl.isItemExpanded(this.data):!0;this.blockElemHeight="0";this.generalClassName="iui-treeitem";this.blockClassName=this.generalClassName+"-block";this.contentClassName=this.generalClassName+"-content";this.expandBoxClassName=this.generalClassName+"-expand-box";this.initStyle()};b.prototype.initStyle=function(){this.defaultStyle={general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",
normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},expandBox:{general:this.expandBoxClassName,load:this.expandBoxClassName+"-load",expanded:this.expandBoxClassName+"-open",collapsed:this.expandBoxClassName+"-close"},content:{disabled:this.contentClassName+"-disabled",focused:this.contentClassName+"-focused",normal:this.contentClassName,hovered:this.contentClassName+"-hovered",selected:this.contentClassName+"-selected"}};this.updateStyle(this.controlStyle);
this.refresh()};b.prototype.ngAfterViewInit=function(){this.contentElem&&(this.contentAnimation={display:"none",left:this.contentElem.nativeElement.offsetWidth/2,width:0,height:this.contentElem.nativeElement.offsetHeight},this.toggleContent())};b.prototype.ngAfterContentChecked=function(){this.contentList&&(this.itemList=this.contentList.toArray(),this.numItems!=this.itemList.length&&(this.numItems=this.itemList.length,this.refresh()))};b.prototype.onClick=function(a){this.isEnabled&&1==a.which&&
(a={event:a,item:this.data},this.parentCtrl?this.parentCtrl.itemClick.emit(a):this.itemClick.emit(a))};b.prototype.onDblClick=function(a){this.isEnabled&&1==a.which&&(a={cancel:!1,event:a,item:this.data},this.parentCtrl?this.parentCtrl.itemDblClick.emit(a):this.itemDblClick.emit(a),1!=a.cancel&&this.toggle())};b.prototype.onRightClick=function(a){this.isEnabled&&(a={event:a,item:this.data},this.parentCtrl?this.parentCtrl.itemRightClick.emit(a):this.itemRightClick.emit(a))};b.prototype.itemDragOver=
function(a,b){if(this.isEnabled&&this.parentCtrl){var c=this.parentCtrl.getItemFromComponent(this),e=this.getPageRect(),f=this.getContentSize();e={x:e.left,y:e.top,width:e.right-e.left,height:f.height};this.parentCtrl.expandOnDelay(c);this.parentCtrl.processDragOver(a,c,e,b)}a.stopPropagation()};b.prototype.itemDragDrop=function(a){if(this.isEnabled&&this.parentCtrl){this.parentCtrl.processDragDrop(a,this.data);var b=this;if(b.expanded&&!b.isBlockExpanded())var d=setTimeout(function(){b.toggleContent();
clearTimeout(d)},100)}a.stopPropagation()};b.prototype.isBlockExpanded=function(){return"0"==this.blockElemHeight?!1:!0};b.prototype.collapse=function(a){this.expanded=!1;a&&(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(b){b.collapse(a)})};b.prototype.expand=function(a){this.expanded=!0;a&&(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(b){b.expand(a)})};b.prototype.toggle=function(a,b){this.expanded=
void 0!=a?a:!this.expanded;b&&(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(c){c.toggle(a,b)})};b.prototype.onExpandBoxMouseDown=function(a){this.isEnabled&&!this.isExpandBoxTouched&&this.toggle();this.isExpandBoxTouched=!1;a.stopPropagation()};b.prototype.onExpandBoxMouseUp=function(a){this.isExpandBoxTouched=!1};b.prototype.onExpandBoxTouchStart=function(a){this.isExpandBoxTouched=!0;this.isEnabled&&this.toggle();a.stopPropagation()};b.prototype.toggleContent=
function(){var a=this;if(a.items&&a.contentElem){var b=a.contentElem.nativeElement.offsetHeight*a.items.length,d=0,e=0;if(a.expanded)if(a.allowAnimation)var f=setInterval(function(){d<b?(e=0==e?1:e+2,d+=e,a.blockElemHeight=d+"px"):(a.blockElemHeight="auto",a.expandState="none",a.updateExpandBoxClass(),a.parentCtrl&&a.parentCtrl.updateLayout(),clearInterval(f))},25);else a.blockElemHeight="auto",a.expandState="none",a.updateExpandBoxClass(),a.parentCtrl&&a.parentCtrl.updateLayout();else if(d=a.blockElem.nativeElement.offsetHeight,
a.allowAnimation)var g=setInterval(function(){0<d?(e=0==e?1:e+2,d-=e,a.blockElemHeight=d+"px"):(a.blockElemHeight="0",a.expandState="none",a.updateExpandBoxClass(),a.parentCtrl&&a.parentCtrl.updateLayout(),clearInterval(g))},25);else a.blockElemHeight="0",a.expandState="none",a.updateExpandBoxClass(),a.parentCtrl&&a.parentCtrl.updateLayout()}};b.prototype.getComponentFromItem=function(a){var b=null;if((this.itemList=this.contentList.toArray())&&0<this.itemList.length)for(var d=0;!b&&d<this.itemList.length;){b=
this.itemList[d];if(this.getItemFromComponent(b)==a)break;else b=b.getComponentFromItem(a);d++}return b};b.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};b.prototype.getItemObject=function(a,b){return this.parentCtrl?this.parentCtrl.getItemObject(a,b):null};b.prototype.isThereVisibleChildren=function(){var a=!1;if(this.data&&this.parentCtrl){var b=this.data[this.parentCtrl.getDataFields().items];
b&&0<b.length&&(a=!0)}return a};b.prototype.getSize=function(){var a={width:0,height:0};if(this.contentElem&&(a={width:this.contentElem.nativeElement.offsetWidth,height:this.contentElem.nativeElement.offsetHeight},this.isExpanded&&this.contentList)){var b=this.commonService.getPadding(this.blockElem.nativeElement);this.itemList=this.contentList.toArray();for(var d=0;d<this.itemList.length;d++){var e=this.itemList[d].getSize();e.width+=b.left;a.width<e.width&&(a.width=e.width)}}return a};b.prototype.checkExpandBoxVisibility=
function(){return this.parentCtrl?this.parentCtrl.showExpandBox:!0};b.prototype.onMouseEnter=function(a){this.isEnabled&&(this.state|=integralui_core_1.IntegralUIObjectState.hovered,this.mouseEnter.emit(a),this.data&&this.parentCtrl&&this.parentCtrl.invokeEvent("ITEM_HOVER",this.data),this.isHovered=!0);a.stopPropagation()};b.prototype.clearComponentSelection=function(){(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.state&=~integralui_core_1.IntegralUIObjectState.selected;
a.clearComponentSelection()})};b.prototype.selectItem=function(){this.parentCtrl&&this.parentCtrl.clearSelection();this.state|=integralui_core_1.IntegralUIObjectState.selected};b.prototype.getControlStyle=function(){var a={};this.data&&this.parentCtrl&&(a=this.parentCtrl.getDataFields(),a=this.data[a.style]||{});a.display=0==this.getItemDisplayMode()?"inline-block":"block";0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};
b.prototype.getItemDisplayMode=function(){return this.parentCtrl?this.parentCtrl.itemDisplay:integralui_core_1.IntegralUIItemDisplayMode.Full};b.prototype.refresh=function(){this.updateControlClass();this.updateContentClass();this.updateBlockClass();this.updateExpandBoxClass();if(this.contentList){this.itemList=this.contentList.toArray();for(var a=0;a<this.itemList.length;a++)this.itemList[a].refresh()}};b.prototype.updateBlockClass=function(){this.blockClass.length=0;this.blockClass.push(this.blockClassName);
this.items&&0<this.items.length&&(0!=this.expanded?this.blockClass.push(this.blockClassName+"-open"):this.blockClass.push(this.blockClassName+"-close"))};b.prototype.getBlockClass=function(){return this.blockClass};b.prototype.getGeneralClass=function(){return this.generalClassName};b.prototype.updateExpandBoxClass=function(){this.expandBoxClass.length=0;if(this.options.currentStyle&&this.parentCtrl){var a=this.parentCtrl.getDataFields();(this.parentCtrl.isThereChildren()||this.data&&this.data[a.hasChildren])&&
this.expandBoxClass.push(this.options.currentStyle.expandBox.general);if(this.data&&this.data[a.hasChildren]&&(this.isThereVisibleChildren()||!this.data[a.items]||this.data[a.items]&&0==this.data[a.items].length)||this.isThereVisibleChildren())this.parentCtrl&&this.parentCtrl.isItemLoading(this.data)?this.expandBoxClass.push(this.options.currentStyle.expandBox.load):0!=this.expanded?"none"==this.expandState?this.expandBoxClass.push(this.options.currentStyle.expandBox.expanded):"expand"==this.expandState&&
this.expandBoxClass.push(this.options.currentStyle.expandBox.expanded+"-animate"):"none"==this.expandState?this.expandBoxClass.push(this.options.currentStyle.expandBox.collapsed):"collapse"==this.expandState&&this.expandBoxClass.push(this.options.currentStyle.expandBox.collapsed+"-animate")}};b.prototype.getExpandBoxClass=function(){return this.expandBoxClass};b.prototype.getExpandBoxStyle=function(a){return this.commonService.isString(a)?a:a?{general:this.commonService.isFieldAvailable(a.general,
this.expandBoxClassName),load:this.commonService.isFieldAvailable(a.load,this.expandBoxClassName+"-load"),expanded:this.commonService.isFieldAvailable(a.expanded,this.expandBoxClassName+"-open"),collapsed:this.commonService.isFieldAvailable(a.collapsed,this.expandBoxClassName+"-close")}:{general:this.defaultStyle.expandBox.general,load:this.defaultStyle.expandBox.load,expanded:this.defaultStyle.expandBox.expanded,collapsed:this.defaultStyle.expandBox.collapsed}};b.prototype.updateStyle=function(a){this.options.currentStyle=
a?{content:this.getContentStyle(a.content),expandBox:this.getExpandBoxStyle(a.expandBox),general:this.getGeneralStyle(a.general)}:{content:{disabled:this.defaultStyle.content.disabled,focused:this.defaultStyle.content.focused,hovered:this.defaultStyle.content.hovered,normal:this.defaultStyle.content.normal,selected:this.defaultStyle.content.selected},expandBox:{general:this.defaultStyle.expandBox.general,load:this.defaultStyle.expandBox.load,expanded:this.defaultStyle.expandBox.expanded,collapsed:this.defaultStyle.expandBox.collapsed},
general:{disabled:this.defaultStyle.general.disabled,focused:this.defaultStyle.general.focused,hovered:this.defaultStyle.general.hovered,normal:this.defaultStyle.general.normal,selected:this.defaultStyle.general.selected}}};__decorate([core_1.ViewChild("content",{read:core_1.ElementRef,"static":!1}),__metadata("design:type",core_1.ElementRef)],b.prototype,"contentElem",void 0);__decorate([core_1.ViewChild("dragElem",{read:core_1.ElementRef,"static":!1}),__metadata("design:type",core_1.ElementRef)],
b.prototype,"dragElem",void 0);__decorate([core_1.ViewChild("block",{read:core_1.ElementRef,"static":!1}),__metadata("design:type",core_1.ElementRef)],b.prototype,"blockElem",void 0);__decorate([core_1.ViewChild("expandBox",{read:core_1.ElementRef,"static":!1}),__metadata("design:type",core_1.ElementRef)],b.prototype,"expandBoxElem",void 0);__decorate([core_1.ViewChildren(f),__metadata("design:type",core_1.QueryList)],b.prototype,"contentList",void 0);__decorate([core_1.Input(),__metadata("design:type",
Array)],b.prototype,"items",void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],b.prototype,"templateRef",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],b.prototype,"expanded",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"itemClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"itemDblClick",void 0);__decorate([core_1.Output(),
__metadata("design:type",core_1.EventEmitter)],b.prototype,"itemRightClick",void 0);return b=f=__decorate([core_1.Component({selector:"iui-treeitem",template:'\n        <li *ngIf="visible" [ngClass]="getControlClass()" style="position:relative">\n            <div [ngClass]="{ \'iui-treeitem-animate\': allowAnimation, \'iui-listitem-animate-enter-suspended\': allowAnimation && isHovered }" (mouseenter)="onMouseEnter($event)" (mousemove)="onMouseMove($event)" (mouseleave)="onMouseLeave($event)">\n                <div draggable="true" [ngClass]="getContentClass()" (dragstart)="itemDragStart($event)" (dragover)="itemDragOver($event)" (drop)="itemDragDrop($event)" [ngStyle]="getControlStyle()" #content>\n                    <span *ngIf="checkExpandBoxVisibility()" class="iui-treeitem-expand-box-general">\n                        <span [ngClass]="getExpandBoxClass()" (mousedown)="onExpandBoxMouseDown($event)" (mousedown)="onExpandBoxMouseUp($event)" (touchstart)="onExpandBoxTouchStart($event)" #expandBox></span>\n                    </span>\n                    <div (click)="onClick($event)" (dblclick)="onDblClick($event)" (contextmenu)="onRightClick($event)" (mousedown)="onMouseDown($event)" (mouseup)="onMouseUp($event)" (touchstart)="onTouchStart($event)" [ngStyle]="{ display: getItemDisplayMode() == 0 ? \'inline-block\' : \'block\' }" #dragElem>\n                        <ng-template ngFor [ngForOf]="templateData" [ngForTemplate]="templateRef"></ng-template> \n                    </div>\n                </div> \n            </div>\n            <span *ngIf="allowAnimation && isClicked" class="iui-listitem-animate-select-block" [ngStyle]="{ height: getSize().height + \'px\', width: clickPos.x + \'px\' }">\n                <span [ngClass]="{ \'iui-listitem-animate-select iui-listitem-animate-select-left\': isClicked }" [ngStyle]="{ height: getSize().height + \'px\' }"></span>\n            </span>\n            <span *ngIf="allowAnimation && isClicked" class="iui-listitem-animate-select-block" [ngStyle]="{ left: clickPos.x + \'px\', height: getSize().height + \'px\', width: getSize().width - clickPos.x + \'px\' }">\n                <span [ngClass]="{ \'iui-listitem-animate-select iui-listitem-animate-select-right\': isClicked }" [ngStyle]="{ height: getSize().height + \'px\' }"></span>\n            </span>\n            <ul [ngClass]="getBlockClass()" [ngStyle]="{ \'height\': blockElemHeight }" #block>\n                <iui-treeitem *ngFor="let item of items" [allowAnimation]="getItemObject(item, \'allowAnimation\')" [enabled]="getItemObject(item, \'enabled\')" [expanded]="getItemObject(item, \'expanded\')" [text]="getItemObject(item, \'text\')" [items]="getItemObject(item, \'items\')" [templateRef]="templateRef" [data]="item" [visible]="getItemObject(item, \'visible\')">></iui-treeitem>\n            </ul>\n        </li>\n    ',
inputs:"controlStyle data enabled icon name size state text".split(" "),outputs:"click mouseDown mouseEnter mouseLeave mouseMove mouseUp".split(" "),providers:[integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[core_1.ElementRef,integralui_data_service_1.IntegralUIDataService,integralui_common_service_1.IntegralUICommonService,integralui_core_1.IntegralUIBaseService])],b)}(integralui_listitem_1.IntegralUIListItem);
exports.IntegralUITreeItem=IntegralUITreeItem;