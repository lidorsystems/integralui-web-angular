/*
  filename: integralui.autocomplete.js
  version : 1.1.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var f=function(c,a){f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])};return f(c,a)};return function(c,a){function b(){this.constructor=c}f(c,a);c.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_filter_service_1=require("../services/integralui.filter.service"),i0=require("@angular/core"),i1=require("../services/integralui.data.service"),i2=require("../services/integralui.common.service"),i3=require("../services/integralui.filter.service"),i4=require("@angular/common"),
i5=require("@angular/forms"),i6=require("./integralui.core"),IntegralUIAutoComplete=function(f){function c(a,b,c,g,e){var d=f.call(this,c)||this;d.dataService=a;d.elemRef=b;d.commonService=c;d.filterService=g;d.cmpResolver=e;d.dataList=[];d.currentList=[];d.options={};d.filterParams=null;d.isFocused=!1;d.keepActive=!1;d.isPopupDelayed=!1;d.isPopupVisible=!1;d.listSize={width:100,height:200};d.dropListRef=null;d.dropList=null;d.sortComparer=null;d.maxVisibleItems=5;d.placeHolder="Placeholder text";
d.valueChanged=new core_1.EventEmitter;d.updateOptions();return d}__extends(c,f);Object.defineProperty(c.prototype,"dataFields",{set:function(a){this.updateDataFields(a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"dropDownWidth",{get:function(){return this.listSize.width},set:function(a){this.listSize.width!=a&&(this.listSize.width=a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"list",{get:function(){return this.dataList},set:function(a){this.dataList=
a;this.updateData()},enumerable:!0,configurable:!0});c.prototype.ngOnInit=function(){this.updateData();this.updateCurrentList();this.generalClassName="iui-autocomplete";this.initStyle()};c.prototype.ngAfterViewInit=function(){var a=this,b=setTimeout(function(){a.addDropList();clearTimeout(b)},100)};c.prototype.ngOnDestroy=function(){this.removeDropList()};c.prototype.updateDataFields=function(a){this.options.dataFields=a?{icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",style:a.style?a.style:"style",text:a.text?
a.text:"text",visible:a.visible?a.visible:"visible",value:a.value?a.value:"value"}:{icon:"icon",id:"id",style:"style",text:"text",visible:"visible",value:"value"};this.dataService&&this.dataService.updateDataFields(this.options.dataFields)};c.prototype.updateOptions=function(a){a?this.options={currentStyle:{},dataFields:null,sorting:integralui_core_1.IntegralUISortOrder.Ascending}:(this.options={currentStyle:{},dataFields:null,sorting:integralui_core_1.IntegralUISortOrder.Ascending},this.updateDataFields())};
c.prototype.addItemToCurrentList=function(a){a.type="item";a[this.options.dataFields.id]||(a[this.options.dataFields.id]=this.commonService.getUniqueId());this.isItemAllowed(a)&&this.currentList.push(a)};c.prototype.updateCurrentList=function(){this.currentList.length=0;var a=this.dataService.getList();if(a){this.applySorting(a);for(var b=0;b<a.length;b++)this.addItemToCurrentList(a[b])}};c.prototype.updateData=function(){this.dataService.init([{data:this.list}])};c.prototype.addDropList=function(){var a=
this;if(a.appRef){a.removeDropList();var b=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUIListPopup);b&&(a.dropListRef=a.appRef.createComponent(b),a.dropListRef.instance&&(a.dropList=a.dropListRef.instance),a.hideDropList(),a.dropList&&(a.dropList.closed.subscribe(function(b){a.hideDropList();a.isFocused=!0}),a.dropList.selectionChanged.subscribe(function(b){a.hideDropList();a.data=b.item;a.text=b.item[a.options.dataFields.text];a.isFocused=!0;a.callValueChanged();a.isPopupDelayed=
!0;setTimeout(function(){a.isPopupDelayed=!1},250)})))}};c.prototype.removeDropList=function(){this.dropList&&(this.dropList.closed&&this.dropList.closed.unsubscribe(),this.dropList.selectionChanged&&this.dropList.selectionChanged.unsubscribe());this.dropListRef&&this.dropListRef.destroy();this.dropList=null};c.prototype.hideDropList=function(){this.dropList&&(this.dropList.display="none");this.isPopupVisible=!1};c.prototype.showPopup=function(){var a=this.commonService.getShiftPos(),b=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild);
this.dropList&&(this.dropList.allowAnimation=this.allowAnimation,this.dropList.dataFields=this.options.dataFields,this.dropList.display="block",this.dropList.items=this.currentList,this.dropList.minWidth=this.listSize.width,this.dropList.maxVisibleItems=this.maxVisibleItems,this.dropList.position={x:b.left+a.x,y:b.bottom+a.y},this.dropList.size={width:Math.max(b.width,this.dropList.minWidth),height:0},this.dropList.refresh(),this.dropList.open(),this.isPopupVisible=!0)};c.prototype.callValueChanged=
function(){this.valueChanged.emit({data:this.data,text:this.text,value:this.text})};c.prototype.ctrlKeyDown=function(a){var b=this;b.dropList.selectedItem=null;switch(a.keyCode){case 9:a.preventDefault();b.keepActive=!0;b.processDownKey();break;case 13:b.hideDropList();break;case 27:b.data=b.originalData;b.hideDropList();break;case 34:b.keepActive=!0;b.processDownKey(b.maxVisibleItems);break;case 40:b.keepActive=!0;b.processDownKey();break;default:var c=setTimeout(function(){b.applyFilter();b.updateCurrentList();
b.isPopupVisible&&b.dropList?0<b.currentList.length?(b.dropList.items=b.currentList,b.dropList.updateLayout()):b.hideDropList():0<b.currentList.length?b.showPopup():b.hideDropList();clearTimeout(c)},1)}};c.prototype.ctrlLostFocus=function(){this.isFocused=!1;this.keepActive||this.dropList.isListActive()||this.hideDropList();this.keepActive=!1};c.prototype.processDownKey=function(a){a=a||1;this.isPopupVisible&&this.dropList&&0<this.dropList.items.length&&(this.isFocused=!1,this.dropList.focus(),this.dropList.selectedItem=
0<a&&a<=this.dropList.items.length?this.dropList.items[a-1]:this.dropList.items[this.dropList.items.length-1])};c.prototype.textChanged=function(a){this.callValueChanged()};c.prototype.applyFilter=function(){this.text&&""!=this.text?this.filterParams={caseSensitive:!1,conditions:{value:this.text,operation:"->"}}:this.resetFilter()};c.prototype.getFilterTree=function(a){return a?this.filterService.createTree(a.conditions,a.formula):null};c.prototype.resetFilter=function(){this.filterParams={}};c.prototype.filter=
function(a){this.filterParams=a};c.prototype.isItemAllowed=function(a){if(0==a[this.options.dataFields.visible])return!1;var b=!0;a&&this.filterParams&&(b=(b=a[this.options.dataFields.value])?b:a[this.options.dataFields.text],b=this.filterParams.callback?this.filterParams.callback(b,a):this.filterService.match(b,this.filterParams.conditions,this.filterParams.formula,this.getFilterTree(this.filterParams),this.filterParams.caseSensitive));return b};c.prototype.selectContent=function(a){a.target&&setTimeout(function(){a.target.setSelectionRange(0,
a.target.value.length)},1)};c.prototype.applySorting=function(a){var b=this;a&&(b.sortComparer?a.sort(b.sortComparer):b.isSortingAllowed()&&a.sort(function(a,c){var e,d;(e=a[b.options.dataFields.value])||(e=a[b.options.dataFields.text]);b.commonService.isObject(e)&&(e=e.value?e.value:e.text);(d=c[b.options.dataFields.value])||(d=c[b.options.dataFields.text]);b.commonService.isObject(d)&&(d=d.value?d.value:d.text);e=void 0!=e?e:null;d=void 0!=d?d:null;switch(b.options.sorting){case integralui_core_1.IntegralUISortOrder.Ascending:if(e<
d)return-1;if(e>d)return 1;break;case integralui_core_1.IntegralUISortOrder.Descending:if(e>d)return-1;if(e<d)return 1;break;default:return 0}}))};c.prototype.isSortingAllowed=function(){return this.options.sorting==integralui_core_1.IntegralUISortOrder.Ascending||this.options.sorting==integralui_core_1.IntegralUISortOrder.Descending};c.prototype.sort=function(a,b){this.options.sorting=a;this.sortComparer=b?b:null};c.prototype.getControlStyle=function(){var a={};0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+
"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};c.\u0275fac=function(a){return new (a||c)(i0.\u0275\u0275directiveInject(i1.IntegralUIDataService),i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i2.IntegralUICommonService),i0.\u0275\u0275directiveInject(i3.IntegralUIFilterService),i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver))};c.\u0275cmp=i0.\u0275\u0275defineComponent({type:c,selectors:[["iui-autocomplete"]],inputs:{controlStyle:"controlStyle",
data:"data",enabled:"enabled",name:"name",size:"size",state:"state",appRef:"appRef",dataFields:"dataFields",dropDownWidth:"dropDownWidth",list:"list",maxVisibleItems:"maxVisibleItems",placeHolder:"placeHolder",text:"text"},outputs:{valueChanged:"valueChanged"},features:[i0.\u0275\u0275ProvidersFeature([integralui_data_service_1.IntegralUIDataService]),i0.\u0275\u0275InheritDefinitionFeature],decls:2,vars:6,consts:[[3,"ngClass","ngStyle"],["type","text",3,"ngModel","disabled","placeholder","iuiFocus",
"ngModelChange","input","keydown","focus","blur"]],template:function(a,b){a&1&&(i0.\u0275\u0275elementStart(0,"div",0),i0.\u0275\u0275elementStart(1,"input",1),i0.\u0275\u0275listener("ngModelChange",function(a){return b.text=a})("input",function(a){return b.textChanged(a)})("keydown",function(a){return b.ctrlKeyDown(a)})("focus",function(a){return b.selectContent(a)})("blur",function(){return b.ctrlLostFocus()}),i0.\u0275\u0275elementEnd(),i0.\u0275\u0275elementEnd());a&2&&(i0.\u0275\u0275property("ngClass",
b.getControlClass())("ngStyle",b.getControlStyle()),i0.\u0275\u0275advance(1),i0.\u0275\u0275propertyInterpolate("disabled",!b.enabled),i0.\u0275\u0275propertyInterpolate("placeholder",b.placeHolder),i0.\u0275\u0275property("ngModel",b.text)("iuiFocus",b.isFocused))},directives:[i4.NgClass,i4.NgStyle,i5.DefaultValueAccessor,i5.NgControlStatus,i5.NgModel,i6.IntegralUIFocus],encapsulation:2});return c}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIAutoComplete=IntegralUIAutoComplete;
(function(){i0.\u0275setClassMetadata(IntegralUIAutoComplete,[{type:core_1.Component,args:[{selector:"iui-autocomplete",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="getControlStyle()">\n\t\t\t<input type="text" [(ngModel)]="text" disabled="{{!enabled}}" placeholder="{{placeHolder}}" (input)="textChanged($event)" (keydown)="ctrlKeyDown($event)" [iuiFocus]="isFocused" (focus)="selectContent($event)" (blur)="ctrlLostFocus()" />\n\t\t</div>\n\t',inputs:"controlStyle data enabled name size state".split(" "),
providers:[integralui_data_service_1.IntegralUIDataService]}]}],function(){return[{type:i1.IntegralUIDataService},{type:i0.ElementRef},{type:i2.IntegralUICommonService},{type:i3.IntegralUIFilterService},{type:i0.ComponentFactoryResolver}]},{appRef:[{type:core_1.Input}],dataFields:[{type:core_1.Input}],dropDownWidth:[{type:core_1.Input}],list:[{type:core_1.Input}],maxVisibleItems:[{type:core_1.Input}],placeHolder:[{type:core_1.Input}],text:[{type:core_1.Input}],valueChanged:[{type:core_1.Output}]})})();