/*
  filename: integralui.contextmenu.js
  version : 2.3.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var d=function(a,c){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])};return d(a,c)};return function(a,c){function b(){this.constructor=a}d(a,c);a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}(),__decorate=this&&this.__decorate||function(d,a,c,b){var e=arguments.length,f=3>e?a:null===b?b=Object.getOwnPropertyDescriptor(a,c):b,g;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(d,a,c,b);else for(var k=d.length-1;0<=k;k--)if(g=d[k])f=(3>e?g(f):3<e?g(a,c,f):g(a,c))||f;return 3<e&&f&&Object.defineProperty(a,c,f),f},__metadata=this&&this.__metadata||function(d,a){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(d,a)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_core_2=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_menuitem_1=require("../components/integralui.menuitem"),IntegralUIContextMenuComponent=function(d){function a(a,b,e,f,g){var c=d.call(this,e)||this;c.dataService=a;c.elemRef=b;c.commonService=
e;c.cmpResolver=f;c.baseService=g;c.blockDisplay="none";c.blockElemWidth="0";c.blockElemHeight="0";c.blockOverflow="hidden";c.blockOpacity=0;c.tRef=null;c.adjustment={top:0,left:0};c.autoClose=!0;c.direction=integralui_core_2.IntegralUIDirection.None;c.inverse=!1;c.items=[];c.mode="normal";c.position={x:0,y:-9999999};c.itemClick=new core_1.EventEmitter;c.menuOpened=new core_1.EventEmitter;c.menuClosed=new core_1.EventEmitter;c.itemList=[];return c}__extends(a,d);a.prototype.ngOnInit=function(){this.baseService.setComponent(this);
this.dataService.init(this.items);this.generalClassName="iui-contextmenu";this.initStyle()};a.prototype.ngAfterViewInit=function(){var c=this,a=setTimeout(function(){var b=c.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);b&&c.contentRef&&(c.tRef=c.contentRef.createComponent(b));clearTimeout(a)},100)};a.prototype.ngAfterContentInit=function(){var a=this,b=setTimeout(function(){a.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},1)};a.prototype.ngOnDestroy=
function(){this.tRef&&this.tRef.destroy()};a.prototype.onBlur=function(a){0!=this.autoClose&&this.menuClosed.emit({event:a})};a.prototype.onRightClick=function(a){a.preventDefault()};a.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};a.prototype.invokeMethod=function(a,b){switch(a){case "ITEM_CLICK":this.itemClick.emit({event:b.event,item:this.getItemFromComponent(b.cmp)})}};
a.prototype.getSize=function(){return{width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight}};a.prototype.adjustPosition=function(a,b,e,d,g){var c=this,f=c.commonService.getShiftPos();setTimeout(function(){var h=c.getSize();"manual"==b&&g&&(e.x=g.left+g.width+f.x+c.adjustment.left,e.y=g.bottom+f.y+4+c.adjustment.top,c.direction&integralui_core_2.IntegralUIDirection.Above&&(e.y-=h.height),c.inverse||c.direction&integralui_core_2.IntegralUIDirection.Left)&&
(e.x-=h.width);d&&e.y+h.height>d.height&&(e.y-=e.y+h.height-d.height);c.position=e;c.menuOpened.emit({event:a})},10)};a.prototype.open=function(a,b,e,d,g){this.items&&(this.blockDisplay="block",this.blockOpacity=1,this.adjustPosition(a,b,e,d,g))};__decorate([core_1.ViewChild("content",{read:core_1.ViewContainerRef,"static":!1}),__metadata("design:type",core_1.ViewContainerRef)],a.prototype,"contentRef",void 0);__decorate([core_1.ContentChildren(integralui_menuitem_1.IntegralUIMenuItem),__metadata("design:type",
core_1.QueryList)],a.prototype,"contentList",void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],a.prototype,"adjustment",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean)],a.prototype,"autoClose",void 0);__decorate([core_1.Input(),__metadata("design:type",Number)],a.prototype,"direction",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean)],a.prototype,"inverse",void 0);__decorate([core_1.Input(),__metadata("design:type",Array)],a.prototype,"items",
void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],a.prototype,"itemTemplate",void 0);__decorate([core_1.Input(),__metadata("design:type",String)],a.prototype,"mode",void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],a.prototype,"position",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],a.prototype,"itemClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],a.prototype,"menuOpened",void 0);__decorate([core_1.Output(),
__metadata("design:type",core_1.EventEmitter)],a.prototype,"menuClosed",void 0);return a=__decorate([core_1.Component({selector:"iui-contextmenu",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="{ \'top\': position.y + \'px\', \'left\': position.x + \'px\', \'height\': \'auto\', \'opacity\': blockOpacity }" (blur)="onBlur($event)" (contextmenu)="onRightClick($event)" tabindex="999">\n\t\t\t<ul #content>\n\t\t\t\t<iui-menuitem *ngFor="let item of items" [data]="item" [items]="item.items" [enabled]="item.enabled" [icon]="item.icon" [iconUrl]="item.iconUrl"  [text]="item.text" [orientation]="\'vertical\'" [level]="0" [templateRef]="itemTemplate" [showAnimation]="false"></iui-menuitem>\n\t\t\t</ul>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,core_1.ElementRef,integralui_common_service_1.IntegralUICommonService,core_1.ComponentFactoryResolver,integralui_core_1.IntegralUIBaseService])],a)}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIContextMenuComponent=IntegralUIContextMenuComponent;
var IntegralUIContextMenu=function(){function d(a,c,b){this.elemRef=a;this.viewContainer=c;this.cmpResolver=b;this.currentSettings=!1;this.eventList=[];this.isMenuActive=!1;this.winScrollPos={top:0,left:0};this.cmpRef=null;this.templateList=[];this.itemClick=new core_1.EventEmitter;this.menuClick=new core_1.EventEmitter;this.menuOpening=new core_1.EventEmitter;this.menuOpened=new core_1.EventEmitter;this.menuClosed=new core_1.EventEmitter}Object.defineProperty(d.prototype,"settings",{get:function(){return this.currentSettings},
set:function(a){this.currentSettings!=a&&(this.currentSettings=a,this.updateTemplate())},enumerable:!0,configurable:!0});d.prototype.ngAfterContentInit=function(){this.updateTemplate()};d.prototype.updateTemplate=function(){this.itemTemplate=void 0;if(this.templates){this.templateList=this.templates.toArray();for(var a=0;a<this.templateList.length;a++)if(this.templateList[a].settings)switch(this.templateList[a].settings.type){case "menu-item":this.itemTemplate=this.templateList[a].getTemplate()}}};
d.prototype.ngOnDestroy=function(){this.closeMenu()};d.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};d.prototype.closeMenu=function(a){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());a&&this.menuClosed.emit({event:a})};d.prototype.onContextMenu=function(a){"manual"!=this.settings.position&&this.processMenuOpen(a)};d.prototype.onMouseDown=function(a){"manual"==
this.settings.position&&(0>this.settings.buttonType||a.which==this.settings.buttonType)&&this.processMenuOpen(a,"manual")};d.prototype.processMenuOpen=function(a,c){a.preventDefault();var b=this;b.winScrollPos={top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=b.contextMenuRef?b.contextMenuRef:b.settings?b.settings.appRef:null;if(d){b.closeMenu();var f={cancel:!1,event:a};b.menuOpening.emit(f);1!=f.cancel&&(f=b.cmpResolver.resolveComponentFactory(IntegralUIContextMenuComponent))&&
(b.cmpRef=d.createComponent(f),b.cmpRef&&(d=null,b.cmpRef._component?d=b.cmpRef._component:b.cmpRef._hostElement&&(d=b.cmpRef._hostElement.component),d&&(b.isMenuActive=!0,d.mode=c,d.items=b.createMenuList(b.settings.items),d.adjustment=b.settings.adjustment?b.settings.adjustment:{top:0,left:0},d.autoClose=void 0!=b.settings.autoClose?b.settings.autoClose:!0,d.direction=b.settings.direction?b.settings.direction:integralui_core_2.IntegralUIDirection.None,d.inverse=void 0!=b.settings.inverse?b.settings.inverse:
!1,d.itemTemplate=b.itemTemplate,d.controlStyle=b.settings.style,f=b.settings.appSize?b.settings.appSize:{width:window.innerWidth,height:window.innerHeight},"manual"==c?d.open(a,c,{x:0,y:0},f,b.elemRef.nativeElement.getBoundingClientRect()):d.open(a,c,{x:a.pageX,y:a.pageY},f),setTimeout(function(){window.scrollTo(b.winScrollPos.left,b.winScrollPos.top)},5),b.eventList.push(d.itemClick.subscribe(function(a){b.itemClick.emit(a);b.menuClick.emit(a);b.closeMenu(a)})),b.eventList.push(d.menuOpened.subscribe(function(a){b.menuOpened.emit(a)})),
b.eventList.push(d.menuClosed.subscribe(function(a){b.closeMenu(a)})),"manual"==c&&a.stopPropagation())))}};d.prototype.createMenuList=function(a){var c=[];if(a)for(var b=0;b<a.length;b++)0!=a[b].visible&&c.push(a[b]);return c};__decorate([core_1.ContentChildren(integralui_core_1.IntegralUITemplate),__metadata("design:type",core_1.QueryList)],d.prototype,"templates",void 0);__decorate([core_1.Input("iuiContextMenu"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],d.prototype,
"settings",null);__decorate([core_1.Input(),__metadata("design:type",Object)],d.prototype,"contextMenuRef",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],d.prototype,"itemClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],d.prototype,"menuClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],d.prototype,"menuOpening",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],
d.prototype,"menuOpened",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],d.prototype,"menuClosed",void 0);__decorate([core_1.HostListener("contextmenu",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],d.prototype,"onContextMenu",null);__decorate([core_1.HostListener("mousedown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",
void 0)],d.prototype,"onMouseDown",null);return d=__decorate([core_1.Directive({selector:"[iuiContextMenu]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ViewContainerRef,core_1.ComponentFactoryResolver])],d)}();exports.IntegralUIContextMenu=IntegralUIContextMenu;