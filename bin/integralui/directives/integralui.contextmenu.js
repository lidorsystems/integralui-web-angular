/*
  filename: integralui.contextmenu.js
  version : 2.2.0
  Copyright Â© 2016-2018 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])};return function(b,a){function c(){this.constructor=b}e(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_core_2=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_menuitem_1=require("../components/integralui.menuitem"),IntegralUIContextMenuComponent=function(e){function b(b,c,d,g,f){var a=e.call(this,d)||this;a.dataService=b;a.elemRef=c;a.commonService=
d;a.cmpResolver=g;a.baseService=f;a.blockDisplay="none";a.blockElemWidth="0";a.blockElemHeight="0";a.blockOverflow="hidden";a.blockOpacity=0;a.trialRef=null;a.adjustment={top:0,left:0};a.autoClose=!0;a.direction=integralui_core_2.IntegralUIDirection.None;a.inverse=!1;a.items=[];a.mode="normal";a.position={x:0,y:-9999999};a.itemClick=new core_1.EventEmitter;a.menuOpened=new core_1.EventEmitter;a.menuClosed=new core_1.EventEmitter;a.itemList=[];return a}__extends(b,e);b.prototype.ngOnInit=function(){this.baseService.setComponent(this);
this.dataService.init(this.items);this.generalClassName="iui-contextmenu";this.initStyle()};b.prototype.ngAfterViewInit=function(){var a=this,c=setTimeout(function(){var b=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);b&&a.contentRef&&(a.trialRef=a.contentRef.createComponent(b));clearTimeout(c)},100)};b.prototype.ngAfterContentInit=function(){var a=this,c=setTimeout(function(){a.elemRef.nativeElement.firstElementChild.focus();clearTimeout(c)},1)};b.prototype.ngOnDestroy=
function(){this.trialRef&&this.trialRef.destroy()};b.prototype.onBlur=function(a){0!=this.autoClose&&this.menuClosed.emit({event:a})};b.prototype.onRightClick=function(a){a.preventDefault()};b.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};b.prototype.invokeMethod=function(a,c){switch(a){case "ITEM_CLICK":this.itemClick.emit({event:c.event,item:this.getItemFromComponent(c.cmp)})}};
b.prototype.getSize=function(){return{width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight}};b.prototype.adjustPosition=function(a,c,b,e,f){var d=this,g=d.commonService.getShiftPos();setTimeout(function(){var h=d.getSize();"manual"==c&&f&&(b.x=f.left+f.width+g.x+d.adjustment.left,b.y=f.bottom+g.y+4+d.adjustment.top,d.direction&integralui_core_2.IntegralUIDirection.Above&&(b.y-=h.height),d.inverse||d.direction&integralui_core_2.IntegralUIDirection.Left)&&
(b.x-=h.width);e&&b.y+h.height>e.height&&(b.y-=b.y+h.height-e.height);d.position=b;d.menuOpened.emit({event:a})},10)};b.prototype.open=function(a,b,d,e,f){this.items&&(this.blockDisplay="block",this.blockOpacity=1,this.adjustPosition(a,b,d,e,f))};b.decorators=[{type:core_1.Component,args:[{selector:"iui-contextmenu",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="{ \'top\': position.y + \'px\', \'left\': position.x + \'px\', \'height\': \'auto\', \'opacity\': blockOpacity }" (blur)="onBlur($event)" (contextmenu)="onRightClick($event)" tabindex="999">\n\t\t\t<ul #content>\n\t\t\t\t<iui-menuitem *ngFor="let item of items" [data]="item" [items]="item.items" [enabled]="item.enabled" [icon]="item.icon" [iconUrl]="item.iconUrl"  [text]="item.text" [orientation]="\'vertical\'" [level]="0" [templateRef]="itemTemplate" [showAnimation]="false"></iui-menuitem>\n\t\t\t</ul>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}]}];b.ctorParameters=function(){return[{type:integralui_data_service_1.IntegralUIDataService},{type:core_1.ElementRef},{type:integralui_common_service_1.IntegralUICommonService},{type:core_1.ComponentFactoryResolver},{type:integralui_core_1.IntegralUIBaseService}]};b.propDecorators={contentRef:[{type:core_1.ViewChild,
args:["content",{read:core_1.ViewContainerRef}]}],contentList:[{type:core_1.ContentChildren,args:[integralui_menuitem_1.IntegralUIMenuItem]}],adjustment:[{type:core_1.Input}],autoClose:[{type:core_1.Input}],direction:[{type:core_1.Input}],inverse:[{type:core_1.Input}],items:[{type:core_1.Input}],itemTemplate:[{type:core_1.Input}],mode:[{type:core_1.Input}],position:[{type:core_1.Input}],itemClick:[{type:core_1.Output}],menuOpened:[{type:core_1.Output}],menuClosed:[{type:core_1.Output}]};return b}(integralui_core_1.IntegralUIBaseComponent);
exports.IntegralUIContextMenuComponent=IntegralUIContextMenuComponent;
var IntegralUIContextMenu=function(){function e(b,a,c){this.elemRef=b;this.viewContainer=a;this.cmpResolver=c;this.isMenuActive=!1;this.winScrollPos={top:0,left:0};this.eventList=[];this.cmpRef=null;this.templateList=[];this.itemClick=new core_1.EventEmitter;this.menuClick=new core_1.EventEmitter;this.menuOpening=new core_1.EventEmitter;this.menuOpened=new core_1.EventEmitter;this.menuClosed=new core_1.EventEmitter}e.prototype.ngAfterContentInit=function(){this.templateList=this.templates.toArray();
for(var b=0;b<this.templateList.length;b++)if(this.templateList[b].settings)switch(this.templateList[b].settings.type){case "menu-item":this.itemTemplate=this.templateList[b].getTemplate()}};e.prototype.ngOnDestroy=function(){this.closeMenu()};e.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};e.prototype.closeMenu=function(b){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());
b&&this.menuClosed.emit({event:b})};e.prototype.onContextMenu=function(b){"manual"!=this.settings.position&&this.processMenuOpen(b)};e.prototype.onMouseDown=function(b){"manual"==this.settings.position&&(0>this.settings.buttonType||b.which==this.settings.buttonType)&&this.processMenuOpen(b,"manual")};e.prototype.processMenuOpen=function(b,a){b.preventDefault();var c=this;c.winScrollPos={top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=c.contextMenuRef?c.contextMenuRef:
c.settings?c.settings.appRef:null;if(d){c.closeMenu();var e={cancel:!1,event:b};c.menuOpening.emit(e);1!=e.cancel&&(e=c.cmpResolver.resolveComponentFactory(IntegralUIContextMenuComponent))&&(c.cmpRef=d.createComponent(e),c.cmpRef&&(d=null,c.cmpRef._component?d=c.cmpRef._component:c.cmpRef._hostElement&&(d=c.cmpRef._hostElement.component),d&&(c.isMenuActive=!0,d.mode=a,d.items=c.createMenuList(c.settings.items),d.adjustment=c.settings.adjustment?c.settings.adjustment:{top:0,left:0},d.autoClose=void 0!=
c.settings.autoClose?c.settings.autoClose:!0,d.direction=c.settings.direction?c.settings.direction:integralui_core_2.IntegralUIDirection.None,d.inverse=void 0!=c.settings.inverse?c.settings.inverse:!1,d.itemTemplate=c.itemTemplate,d.controlStyle=c.settings.style,e=c.settings.appSize?c.settings.appSize:{width:window.innerWidth,height:window.innerHeight},"manual"==a?d.open(b,a,{x:0,y:0},e,c.elemRef.nativeElement.getBoundingClientRect()):d.open(b,a,{x:b.pageX,y:b.pageY},e),setTimeout(function(){window.scrollTo(c.winScrollPos.left,
c.winScrollPos.top)},5),c.eventList.push(d.itemClick.subscribe(function(a){c.itemClick.emit(a);c.menuClick.emit(a);c.closeMenu(a)})),c.eventList.push(d.menuOpened.subscribe(function(a){c.menuOpened.emit(a)})),c.eventList.push(d.menuClosed.subscribe(function(a){c.closeMenu(a)})),"manual"==a&&b.stopPropagation())))}};e.prototype.createMenuList=function(b){var a=[];if(b)for(var c=0;c<b.length;c++)0!=b[c].visible&&a.push(b[c]);return a};e.decorators=[{type:core_1.Directive,args:[{selector:"[iuiContextMenu]"}]}];
e.ctorParameters=function(){return[{type:core_1.ElementRef},{type:core_1.ViewContainerRef},{type:core_1.ComponentFactoryResolver}]};e.propDecorators={templates:[{type:core_1.ContentChildren,args:[integralui_core_1.IntegralUITemplate]}],settings:[{type:core_1.Input,args:["iuiContextMenu"]}],contextMenuRef:[{type:core_1.Input}],itemClick:[{type:core_1.Output}],menuClick:[{type:core_1.Output}],menuOpening:[{type:core_1.Output}],menuOpened:[{type:core_1.Output}],menuClosed:[{type:core_1.Output}],onContextMenu:[{type:core_1.HostListener,
args:["contextmenu",["$event"]]}],onMouseDown:[{type:core_1.HostListener,args:["mousedown",["$event"]]}]};return e}();exports.IntegralUIContextMenu=IntegralUIContextMenu;