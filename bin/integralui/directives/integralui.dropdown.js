/*
  filename: integralui.dropdown.js
  version : 1.5.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var c=function(b,a){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};return c(b,a)};return function(b,a){function d(){this.constructor=b}c(b,a);b.prototype=null===a?Object.create(a):(d.prototype=a.prototype,new d)}}(),__decorate=this&&this.__decorate||function(c,b,a,d){var f=arguments.length,e=3>f?b:null===d?d=Object.getOwnPropertyDescriptor(b,a):d,g;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(c,b,a,d);else for(var h=c.length-1;0<=h;h--)if(g=c[h])e=(3>f?g(e):3<f?g(b,a,e):g(b,a))||e;return 3<f&&e&&Object.defineProperty(b,a,e),e},__metadata=this&&this.__metadata||function(c,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(c,b)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),IntegralUIDropDownComponent=function(c){function b(a,b){var d=c.call(this,b)||this;d.elemRef=a;d.commonService=b;d.showTimer=null;d.popupTimer=null;d.mousePos={x:0,y:0};d.dropdownDisplay="none";d.dropdownPos={top:0,left:0};d.dropdownSize={width:0,height:0};d.closed=new core_1.EventEmitter;d.updateOptions();return d}__extends(b,
c);Object.defineProperty(b.prototype,"options",{get:function(){return this.dropdownOptions},set:function(a){this.updateOptions(a)},enumerable:!0,configurable:!0});b.prototype.ngAfterContentInit=function(){var a=this,b=setTimeout(function(){a.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},1)};b.prototype.ngOnDestroy=function(){};b.prototype.updateAdjustment=function(a){return a?{top:this.commonService.isFieldAvailable(a.top,0),right:this.commonService.isFieldAvailable(a.right,0),
bottom:this.commonService.isFieldAvailable(a.bottom,0),left:this.commonService.isFieldAvailable(a.left,0)}:{top:0,right:0,bottom:0,left:0}};b.prototype.updateOptions=function(a){a?(this.dropdownOptions={adjustment:this.updateAdjustment(a.adjustment),autoClose:this.commonService.isFieldAvailable(a.autoClose,!0),autoPopDelay:this.commonService.isFieldAvailable(a.autoPopDelay,5E3),enabled:this.commonService.isFieldAvailable(a.enabled,!0),initialDelay:this.commonService.isFieldAvailable(a.initialDelay,
500),position:this.commonService.isFieldAvailable(a.position,"auto"),showMarker:this.commonService.isFieldAvailable(a.showMarker,!0),title:this.commonService.isFieldAvailable(a.title,"")},this.updateDropDownSize(a.dropDownSize)):this.dropdownOptions={adjustment:this.updateAdjustment(),autoClose:!0,autoPopDelay:5E3,enabled:!0,initialDelay:500,position:"auto",showMarker:!0,title:""}};b.prototype.updateDropDownSize=function(a){a&&(this.dropdownOptions.dropDownSize={width:this.commonService.isFieldAvailable(a.width,
0),height:this.commonService.isFieldAvailable(a.height,0)})};b.prototype.onBlur=function(a){0!=this.options.autoClose&&this.closed.emit(null)};b.prototype.onMouseDown=function(a){1==a.buttons&&this.closed.emit(null)};b.prototype.removeTimers=function(){this.showTimer&&(clearTimeout(this.showTimer),this.showTimer=null);this.popupTimer&&(clearTimeout(this.popupTimer),this.popupTimer=null)};b.prototype.open=function(a,b,c){var d=this;d.removeTimers();d.dropdownPos.top=-9999999;d.dropdownDisplay="none";
var f=setTimeout(function(){d.dropdownSize=d.getSize();d.dropdownOptions.enabled&&d.show(a,b,c);clearTimeout(f)},10)};b.prototype.show=function(a,b,c){this.dropdownPos={top:this.mousePos.y+24,left:this.mousePos.x};b=this.commonService.getShiftPos();switch(this.dropdownOptions.position){case "above":this.dropdownPos={top:a.top+b.y-4-this.dropdownSize.height,left:a.left+b.x+this.dropdownOptions.adjustment.left};break;case "left":this.dropdownPos={top:a.top+b.y-4,left:a.left+b.x-4-this.dropdownSize.width};
break;case "right":this.dropdownPos={top:a.top+b.y-4,left:a.right+b.x+4};break;case "below":this.dropdownPos={top:a.bottom+b.y+4+this.dropdownOptions.adjustment.top,left:a.left+b.x+this.dropdownOptions.adjustment.left};break;default:this.dropdownPos={top:a.bottom+b.y+4+this.dropdownOptions.adjustment.top,left:a.left+b.x+this.dropdownOptions.adjustment.left},c&&this.dropdownPos.top+this.dropdownSize.height>c.height&&(this.dropdownPos.top-=this.dropdownPos.top+this.dropdownSize.height-c.height)}this.dropdownDisplay=
"block"};b.prototype.getSize=function(){var a={width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight};this.options.dropDownSize&&(a.width=this.commonService.isFieldAvailable(this.options.dropDownSize.width,a.width),a.height=this.commonService.isFieldAvailable(this.options.dropDownSize.height,a.height));return a};b.prototype.updateMousePos=function(a){this.mousePos!=a&&(this.mousePos=a)};b.prototype.updateControlClass=function(){this.ctrlClass.length=
0;this.ctrlClass.push("iui-dropdown");if(this.dropdownOptions.showMarker)switch(this.dropdownOptions.position){case "above":this.ctrlClass.push("iui-dropdown-marker-bottom");break;case "right":this.ctrlClass.push("iui-dropdown-marker-left");break;case "below":this.ctrlClass.push("iui-dropdown-marker-top");break;case "left":this.ctrlClass.push("iui-dropdown-marker-right")}};__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],b.prototype,"options",null);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"closed",void 0);return b=__decorate([core_1.Component({selector:"iui-dropdown",template:'\n\t\t<div class="iui-dropdown" [ngClass]="getControlClass()" [ngStyle]="{ \'top\': dropdownPos.top + \'px\', \'left\': dropdownPos.left + \'px\' }" (blur)="onBlur($event)" (mousedown)="onMouseDown($event)" tabindex="999">\n\t\t\t<ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[core_1.ElementRef,integralui_common_service_1.IntegralUICommonService])],b)}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIDropDownComponent=IntegralUIDropDownComponent;
var IntegralUIDropDown=function(){function c(b,a,d){this.elemRef=b;this.cmpResolver=a;this.commonService=d;this.currentSettings=!1;this.eventList=[];this.templateData=[];this.isDropDownOpen=!1;this.winScrollPos={top:0,left:0};this.cmpRef=null;this.templateList=[];this.dropDownOpen=new core_1.EventEmitter;this.dropDownOpening=new core_1.EventEmitter;this.dropDownClose=new core_1.EventEmitter}Object.defineProperty(c.prototype,"settings",{get:function(){return this.currentSettings},set:function(b){this.currentSettings!=
b&&(this.currentSettings=b,this.updateTemplate())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"showDropDown",{get:function(){return this.isDropDownOpen},set:function(b){this.isDropDownOpen!=b&&((this.isDropDownOpen=b)?this.open():this.close())},enumerable:!0,configurable:!0});c.prototype.ngAfterContentInit=function(){this.updateTemplate()};c.prototype.updateTemplate=function(){this.templateData.length=0;if(this.templates){this.templateList=this.templates.toArray();for(var b=
0;b<this.templateList.length;b++)if(this.templateList[b].settings)switch(this.templateList[b].settings.type){case "dropdown":this.templateData.push(this.templateList[b].getTemplate())}}};c.prototype.closeDropDown=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(b){return b.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null;this.isDropDownOpen=!1;this.dropDownClose.emit(null)};c.prototype.close=function(){this.closeDropDown()};c.prototype.open=function(b){var a=this;a.winScrollPos=
{top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=a.dropDownRef?a.dropDownRef:a.settings?a.settings.appRef:null;if(d){var c={cancel:!1,event:b};a.dropDownOpening.emit(c);if(1!=c.cancel&&(c=a.cmpResolver.resolveComponentFactory(IntegralUIDropDownComponent))&&(a.cmpRef=d.createComponent(c),a.cmpRef&&(d=null,a.cmpRef._component?d=a.cmpRef._component:a.cmpRef._hostElement&&(d=a.cmpRef._hostElement.component),d))){d.options=a.settings;d.templateObj={data:a.settings.data,
template:a.templateData[0]};b&&d.updateMousePos(a.commonService.getMousePos(b));this.dropDownOpen.emit(null);c=a.settings.appSize?a.settings.appSize:{width:window.innerWidth,height:window.innerHeight};var e=this.elemRef.nativeElement.getBoundingClientRect();d.open(e,a.getSize(),c);setTimeout(function(){window.scrollTo(a.winScrollPos.left,a.winScrollPos.top)},5);a.eventList.push(d.closed.subscribe(function(b){a.closeDropDown()}));b&&b.stopPropagation()}}};c.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,
height:this.elemRef.nativeElement.offsetHeight}};c.prototype.onMouseDown=function(b){var a=this.settings?1==this.settings.manual:!1;1!=b.which||a||(this.closeDropDown(),this.open(b))};__decorate([core_1.ContentChildren(integralui_core_1.IntegralUITemplate),__metadata("design:type",core_1.QueryList)],c.prototype,"templates",void 0);__decorate([core_1.Input("iuiDropDown"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],c.prototype,"settings",null);__decorate([core_1.Input(),
__metadata("design:type",Object)],c.prototype,"dropDownRef",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],c.prototype,"showDropDown",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],c.prototype,"dropDownOpen",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],c.prototype,"dropDownOpening",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],
c.prototype,"dropDownClose",void 0);__decorate([core_1.HostListener("mousedown",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],c.prototype,"onMouseDown",null);return c=__decorate([core_1.Directive({selector:"[iuiDropDown]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ComponentFactoryResolver,integralui_common_service_1.IntegralUICommonService])],c)}();exports.IntegralUIDropDown=IntegralUIDropDown;