/*
  filename: integralui.popover.js
  version : 1.1.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var e=function(a,b){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,a){b.__proto__=a}||function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])};return e(a,b)};return function(a,b){function d(){this.constructor=a}e(a,b);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}(),__decorate=this&&this.__decorate||function(e,a,b,d){var c=arguments.length,f=3>c?a:null===d?d=Object.getOwnPropertyDescriptor(a,b):d,g;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(e,a,b,d);else for(var h=e.length-1;0<=h;h--)if(g=e[h])f=(3>c?g(f):3<c?g(a,b,f):g(a,b))||f;return 3<c&&f&&Object.defineProperty(a,b,f),f},__metadata=this&&this.__metadata||function(e,a){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,a)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_tooltip_1=require("./integralui.tooltip"),IntegralUIPopOverComponent=function(e){function a(b,a){var c=e.call(this,b,a)||this;c.elemRef=b;c.commonService=a;c.popoverDisplay="none";c.popoverPos={top:0,left:0};c.popoverSize={width:0,height:0};c.closed=new core_1.EventEmitter;c.updateOptions();return c}__extends(a,e);Object.defineProperty(a.prototype,
"options",{get:function(){return this.popoverOptions},set:function(b){this.updateOptions(b)},enumerable:!0,configurable:!0});a.prototype.updateOptions=function(b){this.popoverOptions=b?{activation:this.commonService.isFieldAvailable(b.activation,"auto"),autoPopDelay:this.commonService.isFieldAvailable(b.autoPopDelay,5E3),closeButton:this.commonService.isFieldAvailable(b.closeButton,!0),enabled:this.commonService.isFieldAvailable(b.enabled,!0),header:this.commonService.isFieldAvailable(b.header,!0),
initialDelay:this.commonService.isFieldAvailable(b.initialDelay,500),position:this.commonService.isFieldAvailable(b.position,"mouse"),showMarker:this.commonService.isFieldAvailable(b.showMarker,!0),title:this.commonService.isFieldAvailable(b.title,"")}:{activation:"auto",autoPopDelay:5E3,closeButton:!0,enabled:!0,header:!0,initialDelay:500,position:"mouse",showMarker:!0,title:""}};a.prototype.preventBubbleUp=function(b){b.stopPropagation()};a.prototype.close=function(){this.closed.emit(null)};a.prototype.open=
function(b,a){var c=this;c.popoverPos.top=-9999999;c.popoverDisplay="block";var d=setTimeout(function(){c.popoverSize=c.getSize();c.popoverDisplay="none";c.removeTimers();c.popoverOptions.enabled&&(c.showTimer=setTimeout(function(){c.show(b,a);"auto"==c.popoverOptions.activation&&(c.popupTimer=setTimeout(function(){c.closed.emit(null);clearTimeout(c.popupTimer)},c.popoverOptions.autoPopDelay));clearTimeout(c.showTimer)},c.popoverOptions.initialDelay));clearTimeout(d)},1)};a.prototype.show=function(b,
a){this.popoverPos={top:this.mousePos.y+24,left:this.mousePos.x};switch(this.popoverOptions.position){case "above":this.popoverPos={top:b.top-4-this.popoverSize.height,left:b.left+Math.floor((a.width-this.popoverSize.width)/2)};break;case "below":this.popoverPos={top:b.bottom+4,left:b.left+Math.floor((a.width-this.popoverSize.width)/2)};break;case "left":this.popoverPos={top:b.top+Math.floor((a.height-this.popoverSize.height)/2),left:b.left-4-this.popoverSize.width};break;case "right":this.popoverPos=
{top:b.top+Math.floor((a.height-this.popoverSize.height)/2),left:b.right+4}}this.popoverDisplay="block"};a.prototype.getSize=function(){return{width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight}};a.prototype.updateMousePos=function(b){this.mousePos!=b&&(this.mousePos=b)};a.prototype.updateControlClass=function(){this.ctrlClass.length=0;this.ctrlClass.push("iui-popover");if(this.popoverOptions.showMarker)switch(this.popoverOptions.position){case "above":this.ctrlClass.push("iui-popover-marker-bottom");
break;case "right":this.ctrlClass.push("iui-popover-marker-left");break;case "below":this.ctrlClass.push("iui-popover-marker-top");break;case "left":this.ctrlClass.push("iui-popover-marker-right")}};__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],a.prototype,"options",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],a.prototype,"closed",void 0);return a=__decorate([core_1.Component({selector:"iui-popover",template:'\n\t\t<div class="iui-popover" [ngClass]="getControlClass()" [ngStyle]="{ \'display\': popoverDisplay, \'top\': popoverPos.top + \'px\', \'left\': popoverPos.left + \'px\' }" style="opacity:1 !important" (click)="preventBubbleUp($event)" (mousedown)="preventBubbleUp($event)" (mouseup)="preventBubbleUp($event)">\n\t\t\t<div *ngIf="popoverOptions.header" class="iui-popover-header">\n                <div *ngIf="popoverOptions.closeButton" class="iui-popover-close-button" (click)="close()"><span></span></div>\n\t\t\t\t<span *ngIf="popoverOptions.title" class="iui-popover-title">{{popoverOptions.title}}</span>\n\t\t\t</div>\n\t\t\t<div class="iui-popover-content"><ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template></div>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[core_1.ElementRef,integralui_common_service_1.IntegralUICommonService])],a)}(integralui_tooltip_1.IntegralUITooltipComponent);exports.IntegralUIPopOverComponent=IntegralUIPopOverComponent;
var IntegralUIPopOver=function(e){function a(b,a,c){var d=e.call(this,b,a,c)||this;d.elemRef=b;d.cmpResolver=a;d.commonService=c;d.currentSettings=!1;d.templateData=[];d.currentMousePos={x:0,y:0};d.templateList=[];d.popOverClosed=new core_1.EventEmitter;return d}__extends(a,e);Object.defineProperty(a.prototype,"settings",{get:function(){return this.currentSettings},set:function(b){this.currentSettings!=b&&(this.currentSettings=b,this.updateTemplate())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"popOverShow",{get:function(){return this.isVisible},set:function(b){this.isVisible!=b&&(this.isVisible=b,this.toggle())},enumerable:!0,configurable:!0});a.prototype.ngAfterContentInit=function(){this.updateTemplate()};a.prototype.updateTemplate=function(){this.templateData.length=0;if(this.templates){this.templateList=this.templates.toArray();for(var b=0;b<this.templateList.length;b++)if(this.templateList[b].settings)switch(this.templateList[b].settings.type){case "popover":this.templateData.push(this.templateList[b].getTemplate())}}};
a.prototype.closePopOver=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(b){return b.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null};a.prototype.openPopOver=function(b){var a=this,c=a.popoverRef?a.popoverRef:a.settings.appRef;if(c){a.closePopOver();var e=a.cmpResolver.resolveComponentFactory(IntegralUIPopOverComponent);e&&(a.cmpRef=c.createComponent(e),a.cmpRef&&(c=null,a.cmpRef._component?c=a.cmpRef._component:a.cmpRef._hostElement&&(c=a.cmpRef._hostElement.component),
c&&(c.options=a.settings,a.templateData[0]&&(c.templateObj={data:a.settings.data||{},template:a.templateData[0]}),b&&c.updateMousePos(b),b=this.elemRef.nativeElement.getBoundingClientRect(),c.open(b,a.getSize()),a.eventList.push(c.closed.subscribe(function(b){a.closePopOver();a.popOverClosed.emit(null)})))))}};a.prototype.toggle=function(){1==this.popOverShow?this.openPopOver(0!=this.currentMousePos.x&&0!=this.currentMousePos.y?this.currentMousePos:void 0):this.closePopOver()};a.prototype.onMouseEnter=
function(a){void 0==this.popOverShow&&(a=this.commonService.getMousePos(a),this.openPopOver(a))};a.prototype.onMouseLeave=function(a){void 0==this.popOverShow&&this.closePopOver()};a.prototype.onMouseMove=function(a){if(this.cmpRef&&void 0==this.popOverShow)if(this.cmpRef._component){var b=this.cmpRef._component;b.updateMousePos(this.commonService.getMousePos(a))}else this.cmpRef&&this.cmpRef._hostElement&&(b=this.cmpRef._hostElement.component,b.updateMousePos(this.commonService.getMousePos(a)));
else this.currentMousePos=this.commonService.getMousePos(a)};__decorate([core_1.ContentChildren(integralui_core_1.IntegralUITemplate),__metadata("design:type",core_1.QueryList)],a.prototype,"templates",void 0);__decorate([core_1.Input("iuiPopOver"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],a.prototype,"settings",null);__decorate([core_1.Input(),__metadata("design:type",Object)],a.prototype,"popoverRef",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean),
__metadata("design:paramtypes",[Boolean])],a.prototype,"popOverShow",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],a.prototype,"popOverClosed",void 0);__decorate([core_1.HostListener("mouseenter",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"onMouseEnter",null);__decorate([core_1.HostListener("mouseleave",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",
[Object]),__metadata("design:returntype",void 0)],a.prototype,"onMouseLeave",null);__decorate([core_1.HostListener("mousemove",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"onMouseMove",null);return a=__decorate([core_1.Directive({selector:"[iuiPopOver]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ComponentFactoryResolver,integralui_common_service_1.IntegralUICommonService])],a)}(integralui_tooltip_1.IntegralUITooltip);
exports.IntegralUIPopOver=IntegralUIPopOver;