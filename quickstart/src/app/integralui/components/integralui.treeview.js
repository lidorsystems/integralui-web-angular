/*
  filename: integralui.treeview.js
  version : 2.2.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var h=function(b,a){h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,d){a.__proto__=d}||function(a,d){for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c])};return h(b,a)};return function(b,a){function c(){this.constructor=b}h(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}}(),__decorate=this&&this.__decorate||function(h,b,a,c){var d=arguments.length,e=3>d?b:null===c?c=Object.getOwnPropertyDescriptor(b,a):c,f;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(h,b,a,c);else for(var g=h.length-1;0<=g;g--)if(f=h[g])e=(3>d?f(e):3<d?f(b,a,e):f(b,a))||e;return 3<d&&e&&Object.defineProperty(b,a,e),e},__metadata=this&&this.__metadata||function(h,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(h,b)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_dragdrop_service_1=require("../services/integralui.dragdrop.service"),integralui_filter_service_1=require("../services/integralui.filter.service"),integralui_base_list_1=require("./integralui.base.list"),integralui_scrollbar_1=require("./integralui.scrollbar"),
integralui_treeitem_1=require("./integralui.treeitem"),IntegralUITreeView=function(h){function b(a,c,d,b,f,g,k,l){var e=h.call(this,a,c,d,b,f,g)||this;e.dataService=a;e.dragDropService=c;e.elemRef=d;e.elemRenderer=b;e.commonService=f;e.filterService=g;e.cmpResolver=k;e.baseService=l;e.fullList=[];e.isThereChildItems=!1;e.expandTimeout=null;e.expandItem=null;e.currentItemDisplay=integralui_core_1.IntegralUIItemDisplayMode.Full;e.isExpandBoxVisible=!0;e.longestObj={data:null,width:0};e.isExpandBoxTouched=
!1;e.tRef=null;e.autoExpand=!1;e.afterCollapse=new core_1.EventEmitter;e.afterExpand=new core_1.EventEmitter;e.beforeCollapse=new core_1.EventEmitter;e.beforeExpand=new core_1.EventEmitter;e.itemList=[];return e}__extends(b,h);Object.defineProperty(b.prototype,"compactMode",{get:function(){return this.options.compactMode},set:function(a){this.options.compactMode!=a&&(this.options.compactMode=a,this.updateLayout())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indent",{get:function(){return this.options.indent},
set:function(a){this.options.indent!=a&&(this.options.indent=a,this.updateLayout())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"itemDisplay",{get:function(){return this.currentItemDisplay},set:function(a){this.currentItemDisplay!=a&&(this.currentItemDisplay=a,this.updateLayout())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"showExpandBox",{get:function(){return this.isExpandBoxVisible},set:function(a){this.isExpandBoxVisible!=a&&(this.isExpandBoxVisible=
a,this.updateLayout())},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.baseService.setComponent(this);this.updateData();this.updateCurrentList();this.generalClassName="iui-treeview";this.itemClassName="iui-treeitem";this.itemContentClassName=this.itemClassName+"-content";this.expandBoxClassName=this.itemClassName+"-expand-box";this.initStyle()};b.prototype.updateData=function(){this.dataService.init([{data:this.items,fields:this.options.dataFields}])};b.prototype.initStyle=function(){this.defaultStyle=
{general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},item:{general:{disabled:this.itemClassName+"-disabled",focused:this.itemClassName+"-focused",normal:this.itemClassName,hovered:this.itemClassName+"-hovered",selected:this.itemClassName+"-selected"},expandBox:{general:this.expandBoxClassName,load:this.expandBoxClassName+"-load",expanded:this.expandBoxClassName+
"-open",collapsed:this.expandBoxClassName+"-close"},content:{disabled:this.itemContentClassName+"-disabled",focused:this.itemContentClassName+"-focused",normal:this.itemContentClassName,hovered:this.itemContentClassName+"-hovered",selected:this.itemContentClassName+"-selected"}}};this.updateStyle(this.controlStyle);this.updateControlClass();this.refresh()};b.prototype.ngAfterViewInit=function(){var a=this,c=setTimeout(function(){var d=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);
d&&a.contentRef&&(a.tRef=a.contentRef.createComponent(d));clearTimeout(c)},100);a.updateLayout()};b.prototype.ngAfterContentInit=function(){this.updateBlockSize()};b.prototype.ngOnDestroy=function(){this.removeDropMark();this.expandTimeout&&clearTimeout(this.expandTimeout);this.resetLayoutTimer();this.tRef&&this.tRef.destroy()};b.prototype.ngAfterContentChecked=function(){this.clientRect={width:this.elemRef.nativeElement.firstElementChild.clientWidth,height:this.elemRef.nativeElement.firstElementChild.clientHeight};
this.clientRect.width!=this.prevClientRect.width?(this.updateLayout(),this.prevClientRect.width=this.clientRect.width):this.clientRect.height!=this.prevClientRect.height&&(this.updateLayout(),this.prevClientRect.height=this.clientRect.height)};b.prototype.ngAfterViewChecked=function(){};b.prototype.checkForChildren=function(a){var c=!1;if(a=a[this.options.dataFields.items])for(var d=0;d<a.length;d++)if(this.isItemAllowed(a[d])){c=!0;break}return c};b.prototype.updateIsThereChildItems=function(){var a=
!1,c=this.dataService.getList();if(c)for(var d=0;d<c.length&&!(a=this.checkForChildren(c[d]));d++);this.isThereChildItems=a};b.prototype.processItemAdd=function(a,c){this.allowUpdate&&this.updateIsThereChildItems()};b.prototype.processItemRemoval=function(a,c){this.allowUpdate&&this.updateIsThereChildItems()};b.prototype.itemDblClickEvent=function(a,c){if(this.isEnabled){var d={cancel:!1,event:a,item:c.data};this.itemDblClick.emit(d);1!=d.cancel&&this.toggle(c.data)}};b.prototype.updateOptions=function(a){a?
(this.options={allowDrag:this.commonService.isFieldAvailable(a.allowDrag,!1),allowDrop:this.commonService.isFieldAvailable(a.allowDrop,!0),compactMode:this.commonService.isFieldAvailable(a.compactMode,!1),dataFields:null,indent:this.commonService.isFieldAvailable(a.indent,15),loadItems:[],selectedItem:this.commonService.isFieldAvailable(a.selectedItem,this.options.selectedItem?this.options.selectedItem:null)},this.updateShowScroll(a.showScroll)):(this.options={allowDrag:!1,allowDrop:!0,compactMode:!1,
dataFields:null,indent:15,loadItems:[],selectedItem:null},this.updateDataFields(),this.updateShowScroll())};b.prototype.updateDataFields=function(a){this.options.dataFields=a?{allowDrag:a.allowDrag?a.allowDrag:"allowDrag",allowDrop:a.allowDrop?a.allowDrop:"allowDrop",allowEdit:a.allowEdit?a.allowEdit:"allowEdit",allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:"checkBoxSettings",checked:a.checked?
a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",contextMenu:a.contextMenu?a.contextMenu:"contextMenu",enabled:a.enabled?a.enabled:"enabled",expanded:a.expanded?a.expanded:"expanded",hasChildren:a.hasChildren?a.hasChildren:"hasChildren",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",pid:a.pid?a.pid:"pid",selected:a.selected?a.selected:"selected",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",style:a.style?a.style:
"style",templateObj:a.templateObj?a.templateObj:"templateObj",text:a.text?a.text:"text",tooltip:a.tooltip?a.tooltip:"tooltip",value:a.value?a.value:"value",visible:a.value?a.visible:"visible"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",
id:"id",items:"items",pid:"pid",selected:"selected",statusIcon:"statusIcon",style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value",visible:"visible"};this.dataService&&this.dataService.updateDataFields(this.options.dataFields)};b.prototype.updateCurrentList=function(){var a=this;a.currentList.length=0;a.isThereChildItems=!1;var c=a.dataService.getList();1==a.options.compactMode&&(c=a.createCompactList(c));c&&(a.applySorting(c),c.forEach(function(c){a.addChildItems(c,0,
null,!1)}))};b.prototype.addChildItems=function(a,c,d,b,f){var e=this,k=!0;if(!a[e.options.dataFields.items])return k=e.addItemToCurrentList(a,c,d,b,f);if(k=e.addItemToCurrentList(a,c,d,b,f)){var h=0,m=!0;if(b||e.isItemExpanded(a))if(d=a[e.options.dataFields.items])e.applySorting(d),d.forEach(function(d){(m=e.addChildItems(d,c+e.options.indent,a[e.options.dataFields.id],b,a))&&h++});b||e.isThereChildItems||!(0<h||!e.isItemExpanded(a)&&a[e.options.dataFields.items]&&0<a[e.options.dataFields.items].length&&
e.isThereVisibleChildren(a))||(e.isThereChildItems=!0)}return k};b.prototype.addItemToCurrentList=function(a,c,d,b,f){a.type="item";a[this.options.dataFields.id]||(a[this.options.dataFields.id]=this.commonService.getUniqueId());d&&(a[this.options.dataFields.pid]=d);(d=this.isItemAllowed(a))&&(b?this.fullList.push(a):this.currentList.push({data:a,indent:c}));return d};b.prototype.resetVisiblity=function(a){if(a)for(var c=0;c<a.length;c++)a[c][this.options.dataFields.visible]=!0,this.resetVisiblity(a[c][this.options.dataFields.items])};
b.prototype.collapseChildren=function(a){if(a)for(var c=0;c<a.length;c++)a[c][this.options.dataFields.expanded]=!1,this.collapseChildren(a[c][this.options.dataFields.items])};b.prototype.createCompactList=function(a){this.resetVisiblity(a);if(this.selectedItem){var c=this.selectedItem,d=this.getItemParent(this.selectedItem),b=d,f=this.selectedItem;this.collapseChildren(f[this.options.dataFields.items]);if(d)for(;d;){for(var g=d[this.options.dataFields.items],k=0;k<g.length;k++)this.commonService.isEqual(g[k][this.options.dataFields.id],
f[this.options.dataFields.id])||(g[k][this.options.dataFields.expanded]=!1,g[k][this.options.dataFields.visible]=this.isItemExpanded(f)&&this.isThereVisibleChildren(f)?!1:!0);(g=this.getItemParent(d))||(c=d);f=d;d=g}for(k=0;k<a.length;k++)this.commonService.isEqual(a[k][this.options.dataFields.id],c[this.options.dataFields.id])||(a[k][this.options.dataFields.visible]=b&&this.isItemExpanded(c)?!1:this.isItemExpanded(f)&&this.isThereVisibleChildren(this.selectedItem)?!1:!0)}return a};b.prototype.loadData=
function(a,c,d,b){this.processLoadData(a,c,d,b)};b.prototype.updateItem=function(a){var c=this;if(a&&this.isItemExpanded(a))var d=setTimeout(function(){var b=c.getComponentFromItem(a);b&&!b.isBlockExpanded()&&b.toggleContent();clearTimeout(d)},100)};b.prototype.updateScrollItemList=function(){for(var a=this.scrollItemList.length=0,c=this.currentIndex;c<this.currentList.length&&c<this.currentIndex+this.visibleRange;c++,a++){var d=this.currentList[c];d={data:d.data,indent:d.indent,index:c-this.currentIndex,
inlineStyle:this.getItemInlineStyle(d),style:{},tabIndex:a};this.updateItemStyle(d);this.scrollItemList.push(d)}};b.prototype.expandOnDelay=function(a){var c=this;0!=c.autoExpand&&(c.expandItem!=a&&(c.expandTimeout&&clearTimeout(c.expandTimeout),c.expandTimeout=setTimeout(function(){c.expandTimeout&&c.expand(a);clearTimeout(c.expandTimeout)},500)),c.expandItem=a)};b.prototype.itemDragOver=function(a,c,d,b){if(this.isEnabled){var e=this.getItemElemList();e&&0<=d&&d<e.length&&(d=this.commonService.getPageRect(e[d].nativeElement),
d={x:d.left,y:d.top,width:d.right-d.left,height:d.bottom-d.top},this.expandOnDelay(c.data),this.processScroll(a),this.isScrollTimerActive||this.processDragOver(a,c.data,d,b))}a.stopPropagation()};b.prototype.itemDragDrop=function(a,c){this.isEnabled&&(this.expandItem=null,this.expandTimeout&&clearTimeout(this.expandTimeout),this.processDragDrop(a,c.data));a.stopPropagation()};b.prototype.collapse=function(a){this.toggle(a,!1)};b.prototype.expand=function(a){this.toggle(a,!0)};b.prototype.expandBoxMouseDown=
function(a,c){this.isEnabled&&(1!=a.buttons||this.isExpandBoxTouched||this.toggle(c),this.isExpandBoxTouched=!1);a.stopPropagation()};b.prototype.expandBoxMouseUp=function(a){this.isExpandBoxTouched=!1;a.stopPropagation()};b.prototype.expandBoxTouchStart=function(a,c){this.isEnabled&&(this.isExpandBoxTouched=!0,this.toggle(c));a.stopPropagation()};b.prototype.expandBoxTouchEnd=function(a,c){};b.prototype.toggle=function(a,c){if(a){if((a[this.options.dataFields.hasChildren]||a[this.options.dataFields.items]&&
0!=a[this.options.dataFields.items].length)&&!(c&&0!=a[this.options.dataFields.expanded]||!1===c&&0==a[this.options.dataFields.expanded])){var d=void 0!==c?c:!1!==a[this.options.dataFields.expanded]?!0:!1,b=void 0!=c?c:!d;if(0!=this.virtualMode){var f={cancel:!1,item:a};void 0!==c?c?this.beforeExpand.emit(f):this.beforeCollapse.emit(f):d?this.beforeCollapse.emit(f):this.beforeExpand.emit(f);1!=f.cancel&&(b!=a[this.options.dataFields.expanded]&&(a[this.options.dataFields.expanded]=b,1==this.options.compactMode&&
this.processSelection(null,a),this.updateCurrentLayout()),this.isItemExpanded(a)?this.afterExpand.emit({item:a}):this.afterCollapse.emit({item:a}))}else if(d=this.getComponentFromItem(a))d.expanded=b}}else if(0!=this.virtualMode){b=this.getFullList();for(d=0;d<b.length;d++)b[d][this.options.dataFields.expanded]=c;this.updateCurrentLayout()}else(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.toggle(c,!0)})};b.prototype.exportToJSON=function(a,
c,b){c=c?c:null;var d=0==b?this.items:this.getFullList();a=a?a:[this.options.dataFields.allowDrag,this.options.dataFields.allowDrop,this.options.dataFields.allowEdit,this.options.dataFields.allowFocus,this.options.dataFields.autoCheck,this.options.dataFields.canSelect,this.options.dataFields.checkBoxSettings,this.options.dataFields.checked,this.options.dataFields.checkState,this.options.dataFields.content,this.options.dataFields.contextMenu,this.options.dataFields.enabled,this.options.dataFields.expanded,
this.options.dataFields.fixed,this.options.dataFields.fixChildren,this.options.dataFields.hasChildren,this.options.dataFields.icon,this.options.dataFields.id,this.options.dataFields.pid,this.options.dataFields.selected,this.options.dataFields.showCheckBox,this.options.dataFields.statusIcon,this.options.dataFields.style,this.options.dataFields.templateObj,this.options.dataFields.text,this.options.dataFields.tooltip,this.options.dataFields.value,this.options.dataFields.visible];!1===b&&a.push(this.options.dataFields.items);
return JSON.stringify(d,a,c)};b.prototype.getFullList=function(){this.fullList.length=0;var a=this.dataService.getList();if(a)for(var c=0;c<a.length;c++)this.addChildItems(a[c],0,null,!0);return this.fullList};b.prototype.getItemElemList=function(){return this.itemElems?this.itemElems.toArray():null};b.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};b.prototype.getItemIndex=
function(a){return this.itemList&&0<this.itemList.length?this.itemList.indexOf(a):-1};b.prototype.getItemLevel=function(a){var c=0;for(a=this.getItemParent(a);a;)c++,a=this.getItemParent(a);return c};b.prototype.getItemObject=function(a,c){switch(c){case "allowAnimation":return this.allowAnimation;case "enabled":return a[this.options.dataFields.enabled];case "expanded":return a[this.options.dataFields.expanded];case "items":return a[this.options.dataFields.items];case "text":return a[this.options.dataFields.text];
case "visible":return a[this.options.dataFields.visible]||!0}return null};b.prototype.getItemParent=function(a){return this.dataService.getParent(a)};b.prototype.getList=function(a,c){switch(a){case "current":return this.currentList;case "selected":return this.currentSelectedItems}return this.dataService.getList(c)};b.prototype.isChildOf=function(a,c){var b=!1;if(a&&c){var e=c[this.options.dataFields.items];if(e&&0<e.length)for(var f=0;f<e.length;f++){if(this.commonService.isEqual(a[this.options.dataFields.id],
e[f][this.options.dataFields.id])){b=!0;break}else b=this.isChildOf(a,e[f]);if(b)break}}return b};b.prototype.isParentOf=function(a,c){var b=this.dataService.getParent(c);return a&&c&&b&&this.commonService.isEqual(a[this.options.dataFields.id],b[this.options.dataFields.id])?!0:!1};b.prototype.isThereChildren=function(){return this.isThereChildItems};b.prototype.isItemExpanded=function(a){return a?a[this.options.dataFields.expanded]||void 0===a[this.options.dataFields.expanded]?!0:!1:!0};b.prototype.isThereVisibleChildren=
function(a){var c=!1;if(a&&(a=a[this.options.dataFields.items]))for(var b=0;b<a.length;b++)if(this.isItemAllowed(a[b])){c=!0;break}return c};b.prototype.invokeEvent=function(a,c){var b=!0;if(this.isEnabled&&c){var e={cancel:!1,item:c};switch(a){case "AFTER_COLLAPSE":this.afterCollapse.emit({item:c});break;case "AFTER_EXPAND":this.afterExpand.emit({item:c});break;case "BEFORE_COLLAPSE":this.beforeCollapse.emit(e);b=!e.cancel;break;case "BEFORE_EXPAND":this.beforeExpand.emit(e);b=!e.cancel;break;case "ITEM_HOVER":this.itemHover.emit({item:c})}}return b};
b.prototype.invokeMethod=function(a,c){var b=!0;if(this.isEnabled&&c)switch(a){case "CHANGE_EXPANDED":this.changeExpanded(c.component);break;case "SELECT_ITEM":b=this.processSelection(c.event,c.item);break;case "UPDATE_SELECTION":this.updateSelection(c.event,c.item)}return b};b.prototype.changeExpanded=function(a){a&&a.data&&(a.data[this.options.dataFields.expanded]=a.expanded)};b.prototype.getItemRealIndex=function(a){var c=this.dataService.getList();return c?c.indexOf(a):-1};b.prototype.getPrevItem=
function(a){var c=null;if(a){var b=this.dataService.getList(),e=this.getItemParent(a);e&&(b=e[this.options.dataFields.items]);a=b.indexOf(a);a=0<a?a-1:-1;0<=a&&(c=b[a])}return c};b.prototype.getNextItem=function(a){var c=null;if(a){var b=this.dataService.getList(),e=this.getItemParent(a);e&&(b=e[this.options.dataFields.items]);a=b.indexOf(a);a=a<b.length-1?a+1:-1;0<=a&&(c=b[a])}return c};b.prototype.moveItem=function(a,c,b,e){if(a){this.allowUpdate=!1;var d=-1;switch(c){case integralui_core_1.IntegralUIMoveDirection.At:d=
e;break;case integralui_core_1.IntegralUIMoveDirection.Down:b=this.getNextItem(a);break;case integralui_core_1.IntegralUIMoveDirection.First:d=0;break;case integralui_core_1.IntegralUIMoveDirection.Last:d=this.getLastItemIndex();break;case integralui_core_1.IntegralUIMoveDirection.Left:b=this.getItemParent(a);break;case integralui_core_1.IntegralUIMoveDirection.Right:b=this.getPrevItem(a);break;case integralui_core_1.IntegralUIMoveDirection.Up:b=this.getPrevItem(a)}if(Array.isArray(a)){e=[];for(var g=
0;g<a.length;g++){for(var k=!1,h=this.getItemParent(a[g]);h;){if(0<=a.indexOf(h)){k=!0;break}h=this.getItemParent(h)}k||e.push(a[g])}if(0<e.length)if(a=this.getItemCurrentIndex(e[0]),g=this.getItemCurrentIndex(e[e.length-1]),a<=g)for(g=0;g<e.length;g++)this.moveItemAt(e[g],b,c,d);else for(g=e.length-1;0<=g;g--)this.moveItemAt(e[g],b,c,d)}else this.moveItemAt(a,b,c,d);this.allowUpdate=!0;this.updateCurrentLayout();this.change.emit({type:"move-item"})}};b.prototype.processLeftArrowKey=function(a,c){this.collapse(a.data);
return null};b.prototype.processRightArrowKey=function(a,c){this.expand(a.data);return null};b.prototype.getContentSize=function(){return this.contentElem?{width:this.contentElem.nativeElement.offsetWidth,height:this.contentElem.nativeElement.offsetHeight}:{width:0,height:0}};b.prototype.getComponentFromItem=function(a){var c=null;if((this.itemList=this.contentList.toArray())&&0<this.itemList.length)for(var b=0;!c&&b<this.itemList.length;){c=this.itemList[b];if(this.getItemFromComponent(c)==a)break;
else c=c.getComponentFromItem(a);b++}return c};b.prototype.updateBlockSize=function(){if(this.currentItemDisplay==integralui_core_1.IntegralUIItemDisplayMode.Partial)if(0!=this.virtualMode)this.updateLongestItem();else{if(this.contentList){var a=0;if(this.itemList=this.contentList.toArray())for(var c,b=0;b<this.itemList.length;b++)c=this.itemList[b].getSize(),a<c.width&&(a=c.width);this.blockSize={width:a>this.clientRect.width-2?a+16:this.clientRect.width-2,height:this.clientRect.height}}}else this.blockSize=
{width:this.scrollBarSize.width+2,height:this.scrollBarSize.height+2}};b.prototype.isItemInCurrentList=function(a){var c=!1;if(a)for(var b=0;b<this.currentList.length;b++)if(this.currentList[b].data.id==a.id){c=!0;break}return c};b.prototype.updateLongestItem=function(){var a=0,b=this;setTimeout(function(){b.longestObj&&!b.isItemInCurrentList(b.longestObj.data)&&(b.longestObj={data:null,width:0});var c=b.getItemElemList();if(c)for(var e=0;e<c.length;e++)if(e<b.scrollItemList.length){var f=b.getObjFromItem(b.scrollItemList[e].data);
if(f){var g=c[e].nativeElement.firstElementChild.offsetWidth+f.indent;a<g&&g>b.longestObj.width&&(a=g,b.longestObj={data:f.data,width:g})}}c=b.commonService.getPadding(b.elemRef.nativeElement.firstElementChild);b.blockSize.width=b.longestObj.width+(c.left+c.right)+4;b.updateScrollSize()},1)};b.prototype.updateCurrentLayout=function(){var a=this;a.allowUpdate&&(a.resetLayoutTimer(),a.updateCurrentList(),a.updateScrollItemList(),a.updateScrollSize(),a.updateTimer=setTimeout(function(){a.updateBlockSize();
clearTimeout(a.updateTimer)},1))};b.prototype.updateScrollSize=function(){this.contentSize={width:this.clientRect.width-2,height:this.clientRect.height-2};this.scrollSize={width:this.currentItemDisplay==integralui_core_1.IntegralUIItemDisplayMode.Partial?this.blockSize.width-this.clientRect.width-2:0,height:this.avgItemHeight*this.currentList.length-this.clientRect.height+this.avgItemHeight};this.isVerScrollVisible()&&(this.contentSize.width-=18,this.currentItemDisplay==integralui_core_1.IntegralUIItemDisplayMode.Partial&&
-6<=this.scrollSize.width&&(this.scrollSize.width+=16));this.isHorScrollVisible()&&(this.scrollSize.height+=16);this.scrollSize.width=0<this.scrollSize.width?this.scrollSize.width:0;this.scrollSize.height=0<this.scrollSize.height?this.scrollSize.height:0;this.maxScrollPos={x:this.scrollSize.width,y:this.scrollSize.height};this.currentScrollPos.x>this.maxScrollPos.x&&this.changeHorizontalScrollPos(this.maxScrollPos.x);this.currentScrollPos.y>this.maxScrollPos.y&&this.changeVerticalScrollPos(this.maxScrollPos.y);
this.scrollBarSize={width:this.isVerScrollVisible()?this.clientRect.width-20:this.clientRect.width-4,height:this.isHorScrollVisible()?this.clientRect.height-20:this.clientRect.height-4};this.scrollLargeChange={x:this.scrollBarSize.width,y:this.scrollBarSize.height}};b.prototype.beginLoad=function(a){a&&0>this.options.loadItems.indexOf(a)&&this.options.loadItems.push(a)};b.prototype.endLoad=function(a){a=this.options.loadItems.indexOf(a);0<=a&&this.options.loadItems.splice(a,1)};b.prototype.isItemLoading=
function(a){return 0<=this.options.loadItems.indexOf(a)?!0:!1};b.prototype.isVerScrollVisible=function(){return this.isEnabled&&this.options.showScroll.vertical&&this.scrollSize.height>this.avgItemHeight/2?!0:!1};b.prototype.scrollTo=function(a){if(0!=this.virtualMode&&a){this.suspendLayout();for(var b=this.getItemParent(a);null!=b;)this.expand(b),b=this.getItemParent(b);this.resumeLayout();var d=this,e=setTimeout(function(){var b=d.getItemCurrentIndex(a);0<=b&&(d.scrollPos({x:d.currentScrollPos.x,
y:d.avgItemHeight*(b-Math.floor(d.visibleRange/2))}),d.updateLayout());clearTimeout(e)},150)}};b.prototype.callAfterSelectEvent=function(a){var b={item:a};this.afterSelect.emit(b);this.selectionChanged.emit(b);1==this.options.compactMode&&(this.getItemParent(a)&&(a[this.options.dataFields.expanded]=!0),this.updateLayout())};b.prototype.clearComponentSelection=function(){this.contentList&&(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.state&=
~integralui_core_1.IntegralUIObjectState.selected;a.clearComponentSelection()})};b.prototype.getControlStyle=function(){var a={cursor:this.ctrlCursor,overflow:this.virtualMode?"hidden":"auto"};0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};b.prototype.getBlockStyle=function(){var a={};this.currentItemDisplay==integralui_core_1.IntegralUIItemDisplayMode.Partial&&(a={width:this.blockSize.width+"px"});return a};b.prototype.getItemInlineStyle=
function(a){var b=a.data[this.options.dataFields.style]||{};b["padding-left"]=a.indent+"px";return b};b.prototype.updateItemStyle=function(a){a&&(a.style={general:[],expandBox:[],content:[]},a.inlineStyle=this.getItemInlineStyle(a),a.style.general.push(this.itemClassName),a.style.general.push(this.options.currentStyle.item.general.normal),a.style.content.push(this.itemContentClassName),a.style.content.push(this.options.currentStyle.item.content.normal),this.isItemEnabled(a.data)?this.isItemSelected(a.data)?
(a.style.general.push(this.options.currentStyle.item.general.selected),a.style.content.push(this.options.currentStyle.item.content.selected)):this.isItemHovered(a.data)&&(a.style.general.push(this.options.currentStyle.item.general.hovered),a.style.content.push(this.options.currentStyle.item.content.hovered)):(a.style.general.push(this.options.currentStyle.item.general.disabled),a.style.content.push(this.options.currentStyle.item.content.disabled)),a.data==this.currentFocusItem&&a.style.content.push(this.options.currentStyle.item.content.focused),
(this.isThereChildItems||a.data[this.options.dataFields.hasChildren])&&a.style.expandBox.push(this.options.currentStyle.item.expandBox.general),a.data[this.options.dataFields.hasChildren]&&(this.isThereVisibleChildren(a.data)||!a.data[this.options.dataFields.items]||a.data[this.options.dataFields.items]&&0==a.data[this.options.dataFields.items].length)||this.isThereVisibleChildren(a.data))&&(this.isItemLoading(a.data)?a.style.expandBox.push(this.options.currentStyle.item.expandBox.load):0!=a.data[this.options.dataFields.expanded]?
a.style.expandBox.push(this.options.currentStyle.item.expandBox.expanded):a.style.expandBox.push(this.options.currentStyle.item.expandBox.collapsed))};b.prototype.getItemStyle=function(a){return a?{general:this.getItemGeneralStyle(a.general),expandBox:this.getItemExpandBoxStyle(a.expandBox),content:this.getItemContentStyle(a.content)}:this.getDefaultItemStyle()};b.prototype.getItemExpandBoxStyle=function(a){return this.commonService.isString(a)?a:a?{general:this.commonService.isFieldAvailable(a.disabled,
this.expandBoxClassName),load:this.commonService.isFieldAvailable(a.focused,this.expandBoxClassName+"-load"),expanded:this.commonService.isFieldAvailable(a.normal,this.expandBoxClassName+"-open"),collapsed:this.commonService.isFieldAvailable(a.hovered,this.expandBoxClassName+"-close")}:this.getDefaultItemExpandBoxStyle()};b.prototype.getDefaultItemStyle=function(){return{general:this.getDefaultItemGeneralStyle(),expandBox:this.getDefaultItemExpandBoxStyle(),content:this.getDefaultItemContentStyle()}};
b.prototype.getDefaultItemExpandBoxStyle=function(){return{general:this.defaultStyle.item.expandBox.general,load:this.defaultStyle.item.expandBox.load,expanded:this.defaultStyle.item.expandBox.expanded,collapsed:this.defaultStyle.item.expandBox.collapsed}};b.prototype.resetRefresh=function(){this.refreshTimer&&clearTimeout(this.refreshTimer);this.refreshTimer=null};b.prototype.refresh=function(a){if(this.allowUpdate)if(this.resetRefresh(),0!=this.virtualMode)for(this.updateControlClass(),a=0;a<this.scrollItemList.length;a++)this.updateItemStyle(this.scrollItemList[a]);
else{this.clearComponentSelection();for(a=0;a<this.currentSelectedItems.length;a++){var b=this.getComponentFromItem(this.currentSelectedItems[a]);b&&(b.state|=integralui_core_1.IntegralUIObjectState.selected)}if(this.contentList)for(this.itemList=this.contentList.toArray(),a=0;a<this.itemList.length;a++)this.itemList[a].refresh()}};__decorate([core_1.ViewChildren(integralui_treeitem_1.IntegralUITreeItem),__metadata("design:type",core_1.QueryList)],b.prototype,"contentList",void 0);__decorate([core_1.ViewChild("content",
{read:core_1.ViewContainerRef,"static":!1}),__metadata("design:type",core_1.ViewContainerRef)],b.prototype,"contentRef",void 0);__decorate([core_1.ViewChild("content",{read:core_1.ElementRef,"static":!1}),__metadata("design:type",core_1.ElementRef)],b.prototype,"contentElem",void 0);__decorate([core_1.ContentChild(core_1.TemplateRef,{"static":!1}),__metadata("design:type",Object)],b.prototype,"itemTemplate",void 0);__decorate([core_1.ViewChildren("itemElem",{read:core_1.ElementRef}),__metadata("design:type",
core_1.QueryList)],b.prototype,"itemElems",void 0);__decorate([core_1.ViewChild("verScroll",{"static":!1}),__metadata("design:type",integralui_scrollbar_1.IntegralUIScrollBar)],b.prototype,"verScrollCmp",void 0);__decorate([core_1.ViewChild("horScroll",{"static":!1}),__metadata("design:type",integralui_scrollbar_1.IntegralUIScrollBar)],b.prototype,"horScrollCmp",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean)],b.prototype,"autoExpand",void 0);__decorate([core_1.Input(),__metadata("design:type",
Boolean),__metadata("design:paramtypes",[Boolean])],b.prototype,"compactMode",null);__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],b.prototype,"indent",null);__decorate([core_1.Input(),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],b.prototype,"itemDisplay",null);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],b.prototype,"showExpandBox",null);__decorate([core_1.Output(),
__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterCollapse",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterExpand",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeCollapse",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeExpand",void 0);return b=__decorate([core_1.Component({selector:"iui-treeview",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="getControlStyle()" (DOMMouseScroll)="processMouseWheel($event)" (mousewheel)="processMouseWheel($event)" (mouseenter)="onCtrlMouseEnter($event)" (mouseleave)="onCtrlMouseLeave($event)" (dragenter)="ctrlDragEnter($event)" (dragleave)="ctrlDragLeave($event)" (dragover)="ctrlDragOver($event)" (drop)="ctrlDragDrop($event)" (dragend)="ctrlDragEnd($event)" (scroll)="onScroll($event)">\n            <span [ngSwitch]="virtualMode" #content>\n                <span *ngSwitchCase="true">\n\t                <ul  style="margin:0;padding:0;" [ngStyle]="{ width: currentItemDisplay == 0 ? \'9999px\' : blockSize.width + \'px\', height: contentSize.height + \'px\', \'margin-left\': -this.currentScrollPos.x + \'px\' }" (touchstart)="ctrlTouchStart($event)" (touchend)="ctrlTouchEnd($event)">\n\t                \t<li [ngClass]="{ \'iui-treeitem-animate\': allowAnimation }" *ngFor="let item of scrollItemList; let i = index" (mouseenter)="itemMouseEnter($event, item)" (mouseleave)="itemMouseLeave($event, item)" [ngStyle]="item.inlineStyle" #itemElem>\n\t                \t\t<div *ngIf="!item.isEmpty && !item.isEmptyPrev" [ngClass]="{ \'iui-listitem-animate-enter-suspended\': allowAnimation && item.data == hoverItem }" [ngStyle]="{ display: currentItemDisplay == 0 ? \'inline-block\' : \'block\' }">\n\t\t\t\t\t\t        <div [ngClass]="item.style.general" draggable="true" (mousedown)="itemMouseDown($event, item)" (mouseup)="itemMouseUp($event, item)" (dragstart)="itemDragStart($event, item)" (dragover)="itemDragOver($event, item, i)" (drop)="itemDragDrop($event, item)" (touchstart)="itemTouchStart($event, item)"  (touchmove)="itemTouchMove($event, item)" (touchend)="itemTouchEnd($event, item)">\n\t\t\t        \t            <div [ngClass]="item.style.content" tabindex="{{item.tabIndex}}" [iuiFocus]="item.data == this.currentFocusItem" (focus)="itemGotFocus(item)" (blur)="itemLostFocus(item)" (keydown)="itemKeyDown($event, item)" (keypress)="itemKeyPress($event, item)" (keyup)="itemKeyUp($event, item)" [ngStyle]="{ display: currentItemDisplay == 0 ? \'inline-block\' : \'block\' }">\n\t\t\t\t\t\t\t\t\t\t<span *ngIf="showExpandBox">\n\t\t\t\t\t\t\t\t\t\t\t<span [ngClass]="item.style.expandBox" (mousedown)="expandBoxMouseDown($event, item.data)" (mouseup)="expandBoxMouseUp($event)" (touchstart)="expandBoxTouchStart($event, item.data)" (touchend)="expandBoxTouchEnd($event, item.data)"></span>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t<div (click)="itemClickEvent($event, item)" (dblclick)="itemDblClickEvent($event, item)" (contextmenu)="itemRightClickEvent($event, item)" [ngStyle]="{ display: currentItemDisplay == 0 ? \'inline-block\' : \'block\' }">\n\t\t\t\t\t\t\t\t\t\t\t<span [iuiTemplateOutlet]="itemTemplate" [iuiTemplateOutletContext]="{$implicit: (item.data)}"></span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t        </div>\n\t\t\t\t\t\t        <span *ngIf="allowAnimation && item.isClicked" class="iui-listitem-animate-select-block" [ngStyle]="{ height: animateItemSize.height + \'px\', width: item.clickPos.x + \'px\' }">\n\t\t\t\t\t\t\t        <span [ngClass]="{ \'iui-listitem-animate-select iui-listitem-animate-select-left\': item.isClicked }" [ngStyle]="{ height: animateItemSize.height + \'px\' }"></span>\n\t\t\t\t\t\t       </span>\n\t\t\t\t\t\t        <span *ngIf="allowAnimation && item.isClicked" class="iui-listitem-animate-select-block" [ngStyle]="{ left: item.clickPos.x + \'px\', height: animateItemSize.height + \'px\', width: contentSize.width - item.clickPos.x + \'px\' }">\n\t\t\t\t\t\t\t        <span [ngClass]="{ \'iui-listitem-animate-select iui-listitem-animate-select-right\': item.isClicked }" [ngStyle]="{ height: animateItemSize.height + \'px\' }"></span>\n\t\t\t\t\t\t        </span>\n\t\t\t\t\t        </div>\n\t\t\t\t\t\t\t<span *ngIf="item.isEmptyPrev" style="pointer-events:none;">\n\t\t\t\t\t\t\t\t<div class="iui-treeview-item-empty-content" [ngClass]="{ \'open-empty-bottom\': item.status == 1, \'close-empty-bottom\': item.status == 2 }"></div>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span *ngIf="item.isEmpty" style="pointer-events:none;">\n\t\t\t\t\t\t\t\t<div class="iui-treeview-item-empty-content" [ngClass]="{ \'open-empty-bottom\': item.status == 1, \'close-empty-bottom\': item.status == 2, \'empty-bottom\': item.status == 3 }"></div>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t       </li>\n\t                </ul>\n\t\t            <iui-scrollbar *ngIf="isVerScrollVisible()" [enabled]="enabled" [value]="currentScrollPos.y" [max]="maxScrollPos.y" [largeChange]="scrollLargeChange.y" [height]="scrollBarSize.height" (valueChanged)="onVerticalScrollChanged($event)" (scrollStart)="onVerticalScrollStart($event)" (scrollEnd)="onVerticalScrollEnd($event)" #verScroll></iui-scrollbar>\n\t\t            <iui-scrollbar *ngIf="isHorScrollVisible()" [enabled]="enabled" [orientation]="horScrollOrientation" [value]="currentScrollPos.x" [max]="maxScrollPos.x" [width]="scrollBarSize.width" (valueChanged)="onHorizontalScrollChanged($event)" (scrollStart)="onHorizontalScrollStart($event)" (scrollEnd)="onHorizontalScrollEnd($event)" #horScroll></iui-scrollbar>\n\t\t            <div *ngIf="isVerScrollVisible() && isHorScrollVisible()" class="iui-scrollbar-corner" style="position:absolute;right:0;bottom:0;width:16px;height:16px;"></div>\n\t            </span>\n                <span *ngSwitchDefault>\n\t                <ul style="margin:0;padding:0;" [ngStyle]="getBlockStyle()">\n\t\t\t            <iui-treeitem *ngFor="let item of items" [allowAnimation]="getItemObject(item, \'allowAnimation\')" [enabled]="getItemObject(item, \'enabled\')" [expanded]="getItemObject(item, \'expanded\')" [text]="getItemObject(item, \'text\')" [templateRef]="itemTemplate" [data]="item" [items]="getItemObject(item, \'items\')" [visible]="getItemObject(item, \'visible\')">\n\t\t\t\t\t\t</iui-treeitem> \n\t                </ul>\n\t            </span>\n            </span>\n\t\t</div>\n\t',
inputs:"allowDrag allowDrop allowFilter allowFocus appRef controlStyle data enabled items name selectedItem selectionMode size sorting state virtualMode".split(" "),outputs:"afterSelect beforeEdit beforeSelect change clear dragEnter dragDrop dragDropComplete dragLeave dragOver itemAdding itemAdded itemHover itemRemoving itemRemoved keyDown keyPress keyUp loadComplete scrollPosChanged selectionChanged updateComplete".split(" "),providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService]}),
__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,integralui_dragdrop_service_1.IntegralUIDragDropService,core_1.ElementRef,core_1.Renderer,integralui_common_service_1.IntegralUICommonService,integralui_filter_service_1.IntegralUIFilterService,core_1.ComponentFactoryResolver,integralui_core_1.IntegralUIBaseService])],b)}(integralui_base_list_1.IntegralUIBaseList);exports.IntegralUITreeView=IntegralUITreeView;