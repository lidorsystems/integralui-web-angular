/*
  filename: integralui.base.grid.js
  version : 20.2.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]})(t,i)};return function(t,i){e(t,i);function o(){this.constructor=t}t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var IntegralUIGridLines,core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_dragdrop_service_1=require("../services/integralui.dragdrop.service"),integralui_filter_service_1=require("../services/integralui.filter.service"),integralui_datepicker_1=require("./integralui.datepicker"),integralui_colorpicker_1=require("./integralui.colorpicker"),i0=require("@angular/core"),i1=require("../services/integralui.data.service"),i2=require("../services/integralui.dragdrop.service"),i3=require("../services/integralui.common.service"),i4=require("../services/integralui.filter.service");!function(e){e[e.None=0]="None";e[e.Horizontal=1]="Horizontal";e[e.Vertical=2]="Vertical";e[e.Both=3]="Both"}(IntegralUIGridLines=exports.IntegralUIGridLines||(exports.IntegralUIGridLines={}));var IntegralUIBaseGrid=function(e){__extends(t,e);function t(t,i,o,r,l,s,n,a){var c=e.call(this,l)||this;c.dataService=t;c.dragDropService=i;c.elemRef=o;c.elemRenderer=r;c.commonService=l;c.filterService=s;c.changeRef=n;c.cmpResolver=a;c.animateColumnSize={width:0,height:0};c.animateRowSize={width:0,height:0};c.prevClickedObj=null;c.headerData=[];c.rowData=[];c.rowHoverData=[];c.rowSelectData=[];c.cellData=[];c.footerData=[];c.completeColumnList=[];c.completeLeftColumnList=[];c.completeRightColumnList=[];c.currentColumnList=[];c.currentLeftColumnList=[];c.currentRightColumnList=[];c.currentRowList=[];c.dataColumns=[];c.dataRows=[];c.flatCompleteColumnList=[];c.flatCompleteLeftColumnList=[];c.flatCompleteRightColumnList=[];c.flatCurrentColumnList=[];c.flatCurrentLeftColumnList=[];c.flatCurrentRightColumnList=[];c.maxColumnLevels=0;c.options={};c.scrollColumnList=[];c.scrollLeftColumnList=[];c.scrollRightColumnList=[];c.scrollFooterList=[];c.scrollLeftFooterList=[];c.scrollRightFooterList=[];c.scrollRowList=[];c.scrollLeftRowList=[];c.scrollRightRowList=[];c.columnDataKey="columns";c.rowDataKey="rows";c.dropMarkElem=null;c.dragCmpRef=null;c.dragCmp=null;c.cloneElem=null;c.cloneElemStartPos={x:0,y:0};c.isCtrlDragEntered=!1;c.isFirstDragEnter=!1;c.isDragHandleVisible=!1;c.dragRowList=[];c.targetDropRow=null;c.targetDropPos=-1;c.prevTargetDropPos=-1;c.dragHandlePos={top:-9999999,left:0};c.dragHandleShiftPos={x:0,y:0};c.dragObjIndent=0;c.isDragActive=!1;c.dragStartPos={x:0,y:0};c.dragEndPos={x:0,y:0};c.clickedCell=null;c.dropList=null;c.dropListRef=null;c.calendar=null;c.calendarRef=null;c.colorPopup=null;c.colorPopupRef=null;c.colorPanelSize={width:240,height:270};c.currentEditorCell=null;c.isPopupDelayed=!1;c.isEditorFocused=!1;c.originalEditorText="";c.originalEditorValue=null;c.expandColIndex=0;c.hoverCell=null;c.hoverColumn=null;c.hoverRow=null;c.isGridHovered=!1;c.currentIndex=0;c.prevIndex=0;c.tabIndexCount=0;c.ctrlCursor="default";c.blockHoverRect={height:30,left:0,top:-9999999,width:880};c.blockSelectRect=[];c.blockSelectHeight=0;c.hoverRowObj={data:{}};c.columnStartPos={x:0,y:0};c.resizeColumn=null;c.resizeColumnIndex=-1;c.reorderColumn=null;c.columnReorderActive=!1;c.currentFocusCell=null;c.isKeyboardActive=!1;c.allowUpdate=!0;c.avgRowHeight=0;c.blockMarginTop=0;c.blockSize={width:0,height:0};c.leftBlockSize={width:0,height:0};c.rightBlockSize={width:0,height:0};c.columnPadding={top:0,right:0,bottom:0,left:0};c.currentGridLines=IntegralUIGridLines.Both;c.currentHeaderHeight=0;c.currentFooterHeight=0;c.isExpandBoxVisible=!0;c.isLayoutUpdating=!1;c.isHoverTemplatePresent=!1;c.isSelectedTemplatePresent=!1;c.numVisibleCells=0;c.viewIndexRange={left:0,middle:999,right:999};c.fixedLeftViewIndexRange=0;c.fixedRightViewIndexRange=0;c.visibleRange=1;c.isAutoSizeColumnsActive=!1;c.isHeaderVisible=!0;c.isFooterVisible=!0;c.isUpdateActive=!1;c.scrollSize={width:0,height:0};c.contentLeftPos=0;c.initialContentLeftPos=0;c.allColWidth=0;c.horScrollElemPos={bottom:0};c.cornerScrollElemPos={bottom:0};c.paginatorPos={top:0,left:0};c.currentPageNumber=1;c.onlyCurrentPage=!1;c.currentPageList=[];c.pageNumber=0;c.pageList=[];c.pageRowCount=0;c.paginatorHeight=0;c.originalScrollColumnList=[];c.reorderColumnObj=null;c.reorderColumnObjPos={top:0,left:0};c.reorderColumnStartPos={top:0,left:0};c.reorderColumnCurrentPos={top:0,left:0};c.reorderColIndex=-1;c.reorderNewColIndex=-1;c.startColumnReorder=!1;c.isColumnResizing=!1;c.currentScrollPos={x:0,y:0};c.isKeyPressed=!1;c.maxScrollPos={x:0,y:0};c.accelerator=.5;c.scrollTimerID=null;c.isScrollTimerActive=!1;c.scrollCount=0;c.isScrollActive=!1;c.prevScrollPos={x:0,y:0};c.scrollBarSize={width:0,height:0};c.scrollLargeChange={x:0,y:0};c.currentSelectedColumn=null;c.currentSelectedRow=null;c.currentSelectionMode=integralui_core_1.IntegralUISelectionMode.One;c.isRowClicked=!1;c.shiftFirstSelectedRow=null;c.removeIndex=-1;c.currentSelectedRows=[];c.isExpandBoxTouched=!1;c.touchStartPos={x:0,y:0};c.touchEndPos={x:0,y:0};c.footerHeight=0;c.headerHeight=0;c.mouseWheelSpeed=integralui_core_1.IntegralUISpeedMode.Normal;c.rowContentVisibility=integralui_core_1.IntegralUIContentVisibility.Both;c.rowHeight=0;c.showHoverRow=!1;c.afterSelect=new core_1.EventEmitter;c.beforeEdit=new core_1.EventEmitter;c.beforeSelect=new core_1.EventEmitter;c.beforeUpdate=new core_1.EventEmitter;c.cellClick=new core_1.EventEmitter;c.cellDblClick=new core_1.EventEmitter;c.cellHover=new core_1.EventEmitter;c.cellRightClick=new core_1.EventEmitter;c.cellValueChanging=new core_1.EventEmitter;c.cellValueChanged=new core_1.EventEmitter;c.change=new core_1.EventEmitter;c.columnAdding=new core_1.EventEmitter;c.columnAdded=new core_1.EventEmitter;c.columnClick=new core_1.EventEmitter;c.columnDblClick=new core_1.EventEmitter;c.columnHover=new core_1.EventEmitter;c.columnRightClick=new core_1.EventEmitter;c.columnOrderChanged=new core_1.EventEmitter;c.columnRemoving=new core_1.EventEmitter;c.columnRemoved=new core_1.EventEmitter;c.columnsCleared=new core_1.EventEmitter;c.columnSizeChanged=new core_1.EventEmitter;c.dragEnd=new core_1.EventEmitter;c.dragEnter=new core_1.EventEmitter;c.dragDrop=new core_1.EventEmitter;c.dragDropComplete=new core_1.EventEmitter;c.dragLeave=new core_1.EventEmitter;c.dragOver=new core_1.EventEmitter;c.dragStart=new core_1.EventEmitter;c.keyDown=new core_1.EventEmitter;c.keyPress=new core_1.EventEmitter;c.keyUp=new core_1.EventEmitter;c.pageChanged=new core_1.EventEmitter;c.rowAdding=new core_1.EventEmitter;c.rowAdded=new core_1.EventEmitter;c.rowClick=new core_1.EventEmitter;c.rowDblClick=new core_1.EventEmitter;c.rowHover=new core_1.EventEmitter;c.rowRemoving=new core_1.EventEmitter;c.rowRemoved=new core_1.EventEmitter;c.rowRightClick=new core_1.EventEmitter;c.rowsCleared=new core_1.EventEmitter;c.loadComplete=new core_1.EventEmitter;c.scrollPosChanged=new core_1.EventEmitter;c.selectionChanged=new core_1.EventEmitter;c.updateComplete=new core_1.EventEmitter;c.dragGhost=null;c.dragMode=integralui_core_1.IntegralUIDragDropDisplayMode.Popup;c.emptyRowObj={cells:[],draggable:!1,isEmpty:!0,status:1,style:{}};c.sortColumn=null;c.sortComparer=null;c.updateOptions();return c}Object.defineProperty(t.prototype,"allowColumnReorder",{set:function(e){},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"allowDrag",{set:function(e){this.options.allowDrag=e},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"allowDrop",{set:function(e){this.options.allowDrop=e},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"allowFilter",{set:function(e){this.options.allowFilter=e},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"allowFocus",{set:function(e){this.options.allowFocus=e;if(!e)this.currentFocusCell=null;this.refresh()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"autoSizeColumns",{get:function(){return this.isAutoSizeColumnsActive},set:function(e){if(this.isAutoSizeColumnsActive!=e){this.isAutoSizeColumnsActive=e;this.updateLayout()}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"columns",{get:function(){return this.dataColumns},set:function(e){this.dataColumns=e;this.updateData()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"dataFields",{set:function(e){this.updateDataFields(e)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"focusedCell",{get:function(){return this.currentFocusCell?this.currentFocusCell.data:null},set:function(e){if(this.currentFocusCell!=e)this.updateFocusCell(this.getObjFromCell(e))},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"gridLines",{get:function(){return this.currentGridLines},set:function(e){if(this.currentGridLines!=e){this.currentGridLines=e;this.refresh()}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"paging",{set:function(e){this.updatePaging(e);this.resetPageNumber();this.updateCurrentLayout()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"rows",{get:function(){return this.dataRows},set:function(e){this.dataRows=e;this.updateData()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"selectedColumn",{get:function(){return this.currentSelectedColumn},set:function(e){if(this.currentSelectedColumn!=e)this.processColumnSelection(null,e)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"selectedRow",{get:function(){return this.currentSelectedRow},set:function(e){if(this.currentSelectedRow!=e){this.processRowSelection(null,e);this.updateSelectContentPos()}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this.currentSelectionMode},set:function(e){if(this.currentSelectionMode!=e){this.currentSelectionMode=e;this.clearPrevSelection(this.currentSelectionMode!=integralui_core_1.IntegralUISelectionMode.None?this.currentSelectedRow:null);this.refresh();if(this.currentSelectionMode==integralui_core_1.IntegralUISelectionMode.None){this.currentSelectedRow=null;this.selectionChanged.emit(null)}}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"showExpandBox",{get:function(){return this.isExpandBoxVisible},set:function(e){if(this.isExpandBoxVisible!=e){this.isExpandBoxVisible=e;this.updateLayout()}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"showScroll",{get:function(){return this.options.showScroll},set:function(e){this.updateShowScroll(e)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"sorting",{set:function(e){this.options.sorting=e},enumerable:!0,configurable:!0});t.prototype.ngOnInit=function(){this.dataService.init([{data:this.columns,fields:this.options.columnFields,key:this.columnDataKey},{data:this.rows,fields:this.options.rowFields,key:this.rowDataKey}])};t.prototype.addColumn=function(e){this.callEventAddColumn("add",e)};t.prototype.clearColumns=function(){this.dataService.clear(null,this.columnDataKey);this.columnsCleared.emit(null);this.currentScrollPos.x=0};t.prototype.insertColumnAt=function(e,t){this.callEventAddColumn("at",e,t)};t.prototype.insertColumnBefore=function(e,t){this.callEventAddColumn("ref",e,-1,t)};t.prototype.insertColumnAfter=function(e,t){this.callEventAddColumn("ref",e,-1,t,!0)};t.prototype.removeColumn=function(e){return this.callEventRemoveColumn(e)};t.prototype.removeColumnAt=function(e){return this.callEventRemoveColumn(null,e)};t.prototype.callEventAddColumn=function(e,t,i,o,r){var l={cancel:!1,column:t};this.columnAdding.emit(l);if(1!=l.cancel){switch(e){case"at":this.dataService.insert(t,i,null,null,!1,this.columnDataKey);break;case"ref":this.dataService.insertByRef(t,o,r,this.columnDataKey);break;default:this.dataService.insert(t,-1,null,null,!1,this.columnDataKey)}this.columnAdded.emit({column:t})}};t.prototype.callEventRemoveColumn=function(e,t){var i={cancel:!1,column:e};this.columnRemoving.emit(i);if(1!=i.cancel){this.removeIndex=this.columns?this.columns.indexOf(e):-1;var o=this.dataService.removeAt(e,t,null,this.columnDataKey);if(o.result){this.columnRemoved.emit({column:o.obj});return!0}}return!1};t.prototype.addRow=function(e,t){this.callEventAddRow("add",e,-1,t)};t.prototype.clearRows=function(e){this.dataService.clear(e,this.rowDataKey);this.rowsCleared.emit({parent:e});this.clearSelection();this.currentScrollPos.y=0};t.prototype.insertRowAt=function(e,t,i){this.callEventAddRow("at",e,t,i)};t.prototype.insertRowBefore=function(e,t){this.callEventAddRow("ref",e,-1,null,t)};t.prototype.insertRowAfter=function(e,t){this.callEventAddRow("ref",e,-1,null,t,!0)};t.prototype.removeRow=function(e){return this.callEventRemoveRow(e)};t.prototype.removeRowAt=function(e,t){return this.callEventRemoveRow(null,e,t)};t.prototype.callEventAddRow=function(e,t,i,o,r,l){var s={cancel:!1,row:t};this.rowAdding.emit(s);if(1!=s.cancel){switch(e){case"at":this.dataService.insert(t,i,o,null,!1,this.rowDataKey);break;case"ref":this.dataService.insertByRef(t,r,l,this.rowDataKey);break;default:this.dataService.insert(t,-1,o,null,!1,this.rowDataKey)}this.rowAdded.emit({row:t})}};t.prototype.callEventRemoveRow=function(e,t,i){var o={cancel:!1,row:e};this.rowRemoving.emit(o);if(1!=o.cancel){this.removeIndex=this.rows?this.rows.indexOf(e):-1;var r=this.dataService.removeAt(e,t,i,this.rowDataKey);if(r.result){if(e&&e[this.options.rowFields.selected]){e[this.options.rowFields.selected]=!1;this.currentSelectedRows=this.currentSelectedRows.filter(function(t){return t!=e});if(this.currentSelectedRow&&this.commonService.isEqual(this.currentSelectedRow[this.options.rowFields.id],e[this.options.rowFields.id]))this.currentSelectedRow=null;this.selectionChanged.emit({row:this.currentSelectedRow})}this.rowRemoved.emit({row:r.obj});return!0}}return!1};t.prototype.cellClickEvent=function(e,t){if(this.isEnabled&&1==e.which)this.cellClick.emit({cell:t.data,event:e})};t.prototype.cellDblClickEvent=function(e,t){if(this.isEnabled&&1==e.which)this.cellDblClick.emit({cell:t.data,event:e})};t.prototype.cellRightClickEvent=function(e,t){if(this.isEnabled)this.cellRightClick.emit({cell:t.data,event:e})};t.prototype.columnClickEvent=function(e,t){var i=this;if(i.isEnabled&&1==e.which)if(i.allowAnimation)var o=setTimeout(function(){i.columnClick.emit({column:t.data,event:e});clearTimeout(o)},250);else i.columnClick.emit({column:t.data,event:e})};t.prototype.columnDblClickEvent=function(e,t){if(this.isEnabled&&1==e.which)this.columnDblClick.emit({column:t.data,event:e})};t.prototype.columnRightClickEvent=function(e,t){if(this.isEnabled)this.columnRightClick.emit({column:t.data,event:e})};t.prototype.rowClickEvent=function(e,t){if(this.isEnabled&&1==e.which)this.rowClick.emit({event:e,row:t.data})};t.prototype.rowDblClickEvent=function(e,t){if(this.isEnabled&&1==e.which){var i={cancel:!1,event:e,row:t.data};this.rowDblClick.emit(i);if(1!=i.cancel)this.toggle(t.data)}};t.prototype.rowRightClickEvent=function(e,t){if(this.isEnabled){var i={event:e,row:t.data};this.rowRightClick.emit(i)}};t.prototype.updateData=function(){};t.prototype.updateDataFields=function(e){if(e){this.updateColumnFields(e.column);this.updateRowFields(e.row);this.updateCellFields(e.cell)}else{this.updateColumnFields();this.updateRowFields();this.updateCellFields()}};t.prototype.updateOptions=function(e){if(e){this.options={allowAnimation:this.commonService.isFieldAvailable(e.allowAnimation,!0),allowCellFocus:this.commonService.isFieldAvailable(e.allowCellFocus,!0),allowColumnReorder:this.commonService.isFieldAvailable(e.allowColumnReorder,!1),allowDrag:this.commonService.isFieldAvailable(e.allowDrag,!1),allowDrop:this.commonService.isFieldAvailable(e.allowDrop,!0),allowFilter:this.commonService.isFieldAvailable(e.allowFilter,!1),allowFocus:this.commonService.isFieldAvailable(e.allowFocus,!1),animationSpeed:200,autoExpand:this.commonService.isFieldAvailable(e.autoExpand,!0),displayMode:this.commonService.isFieldAvailable(e.displayMode,"normal"),editorSettings:{activate:"click"},enabled:this.commonService.isFieldAvailable(e.enabled,!0),expandColIndex:this.commonService.isFieldAvailable(e.expandColIndex,void 0!=this.options.expandColIndex?this.options.expandColIndex:0),fillSpace:this.commonService.isFieldAvailable(e.fillSpace,!1),gridLines:this.commonService.isFieldAvailable(e.gridLines,"both"),hoverSelection:this.commonService.isFieldAvailable(e.hoverSelection,!1),indent:this.commonService.isFieldAvailable(e.indent,15),labelEdit:this.commonService.isFieldAvailable(e.labelEdit,!1),loadRows:[],mouseWheelSpeed:this.commonService.isFieldAvailable(e.mouseWheelSpeed,"normal"),pathSeparator:this.commonService.isFieldAvailable(e.pathSeparator,"\\"),rowHeight:this.commonService.isFieldAvailable(e.rowHeight,-1),rtl:this.commonService.isFieldAvailable(e.rtl,!1),selectedColumn:this.commonService.isFieldAvailable(e.selectedColumn,this.currentSelectedColumn?this.currentSelectedColumn:null),selectedIndex:-1,selectedRow:this.commonService.isFieldAvailable(e.selectedRow,this.currentSelectedRow?this.currentSelectedRow:null),selectedRows:[],selectionMode:this.commonService.isFieldAvailable(e.selectionMode,integralui_core_1.IntegralUISelectionMode.One),showFooter:this.commonService.isFieldAvailable(e.showFooter,!0),showHeader:this.commonService.isFieldAvailable(e.showHeader,!0),showIcons:this.commonService.isFieldAvailable(e.showIcons,!0),sorting:this.commonService.isFieldAvailable(e.sorting,integralui_core_1.IntegralUISortOrder.None)};this.updatePaging(e.paging);this.updateDataFields(e.dataFields);this.updateShowScroll(e.showScroll)}else{this.options={allowAnimation:!0,allowCellFocus:!0,allowColumnReorder:!1,allowDrag:!1,allowDrop:!0,allowFilter:!1,allowFocus:!1,animationSpeed:200,autoExpand:!0,displayMode:"normal",editorSettings:{activate:"click"},enabled:!0,expandColIndex:0,fillSpace:!1,gridLines:"both",hoverSelection:!1,indent:15,labelEdit:!1,loadRows:[],mouseWheelSpeed:"normal",pathSeparator:"\\",rowHeight:-1,rtl:!1,selectedColumn:null,selectedIndex:-1,selectedRow:null,selectedRows:[],selectionMode:integralui_core_1.IntegralUISelectionMode.One,showFooter:!0,showHeader:!0,showIcons:!0,sorting:integralui_core_1.IntegralUISortOrder.None};this.updatePaging();this.updateDataFields();this.updateShowScroll()}};t.prototype.updateColumnFields=function(e){if(e)this.options.columnFields={aggregation:e.aggregation?e.aggregation:"aggregation",allowDrag:e.allowDrag?e.allowDrag:"allowDrag",allowDrop:e.allowDrop?e.allowDrop:"allowDrop",allowFilter:e.allowFilter?e.allowFilter:"allowFilter",allowGrouping:e.allowGrouping?e.allowGrouping:"allowGrouping",allowResize:e.allowResize?e.allowResize:"allowResize",canSelect:e.canSelect?e.canSelect:"canSelect",cellTemplateUrl:e.cellTemplateUrl?e.cellTemplateUrl:"cellTemplateUrl",columns:e.columns?e.columns:"columns",comparer:e.comparer?e.comparer:"comparer",contentAlignment:e.contentAlignment?e.contentAlignment:"contentAlignment",contextMenu:e.contextMenu?e.contextMenu:"contextMenu",editorType:e.editorType?e.editorType:"editorType",editorSettings:e.editorSettings?e.editorSettings:"editorSettings",editorTemplate:e.editorTemplate?e.editorTemplate:"editorTemplate",expanded:e.expanded?e.expanded:"expanded",filterParams:e.filterParams?e.filterParams:"filterParams",filterTemplate:e.filterTemplate?e.filterTemplate:"filterTemplate",fixed:e.fixed?e.fixed:"fixed",fixedWidth:e.fixedWidth?e.fixedWidth:"fixedWidth",footerAlignment:e.footerAlignment?e.footerAlignment:"footerAlignment",footerContent:e.footerContent?e.footerContent:"footerContent",footerTemplate:e.footerTemplate?e.footerTemplate:"footerTemplate",footerTemplateModel:e.footerTemplateModel?e.footerTemplateModel:"footerTemplateModel",footerText:e.footerText?e.footerText:"footerText",footerTooltip:e.footerTooltip?e.footerTooltip:"footerTooltip",groupText:e.groupText?e.groupText:"groupText",headerAlignment:e.headerAlignment?e.headerAlignment:"headerAlignment",headerContent:e.headerContent?e.headerContent:"headerContent",headerTemplate:e.headerTemplate?e.headerTemplate:"headerTemplate",headerTemplateModel:e.headerTemplateModel?e.headerTemplateModel:"headerTemplateModel",headerText:e.headerText?e.headerText:"headerText",headerTooltip:e.headerTooltip?e.headerTooltip:"headerTooltip",icon:e.icon?e.icon:"icon",id:e.id?e.id:"id",minWidth:e.minWidth?e.minWidth:"minWidth",maxWidth:e.maxWidth?e.maxWidth:"maxWidth",name:e.name?e.name:"name",objects:e.columns?e.columns:"columns",pid:e.pid?e.pid:"pid",selected:e.selected?e.selected:"selected",style:e.style?e.style:"style",templateSettings:e.templateSettings?e.templateSettings:"templateSettings",visible:e.visible?e.visible:"visible",width:e.width?e.width:"width"};else this.options.columnFields={aggregation:"aggregation",allowDrag:"allowDrag",allowDrop:"allowDrop",allowFilter:"allowFilter",allowGrouping:"allowGrouping",allowResize:"allowResize",canSelect:"canSelect",cellTemplateUrl:"cellTemplateUrl",columns:"columns",comparer:"comparer",contentAlignment:"contentAlignment",contextMenu:"contextMenu",editorType:"editorType",editorSettings:"editorSettings",editorTemplate:"editorTemplate",expanded:"expanded",filterParams:"filterParams",filterTemplate:"filterTemplate",footerTemplateModel:"footerTemplateModel",fixed:"fixed",fixedWidth:"fixedWidth",footerAlignment:"footerAlignment",footerContent:"footerContent",footerTemplate:"footerTemplate",footerText:"footerText",footerTooltip:"footerTooltip",groupText:"groupText",headerAlignment:"headerAlignment",headerContent:"headerContent",headerTemplate:"headerTemplate",headerTemplateModel:"headerTemplateModel",headerText:"headerText",headerTooltip:"headerTooltip",icon:"icon",id:"id",minWidth:"minWidth",maxWidth:"maxWidth",name:"name",objects:"columns",pid:"pid",selected:"selected",style:"style",templateSettings:"templateSettings",visible:"visible",width:"width"};if(this.dataService)this.dataService.updateDataFields(this.options.columnFields,this.columnDataKey)};t.prototype.updateRowFields=function(e){if(e)this.options.rowFields={allowDrag:e.allowDrag?e.allowDrag:"allowDrag",allowDrop:e.allowDrop?e.allowDrop:"allowDrop",allowEdit:e.allowEdit?e.allowEdit:"allowEdit",allowFocus:e.allowFocus?e.allowFocus:"allowFocus",autoCheck:e.autoCheck?e.autoCheck:"autoCheck",canSelect:e.canSelect?e.canSelect:"canSelect",cells:e.cells?e.cells:"cells",checkBoxSettings:e.checkBoxSettings?e.checkBoxSettings:"checkBoxSettings",checked:e.checked?e.checked:"checked",checkState:e.checkState?e.checkState:"checkState",content:e.content?e.content:"content",contentVisibility:e.contentVisibility?e.contentVisibility:"contentVisibility",contextMenu:e.contextMenu?e.contextMenu:"contextMenu",gid:e.gid?e.gid:"gid",enabled:e.enabled?e.enabled:"enabled",expanded:e.expanded?e.expanded:"expanded",fixed:e.fixed?e.fixed:"fixed",hasChildren:e.hasChildren?e.hasChildren:"hasChildren",icon:e.icon?e.icon:"icon",id:e.id?e.id:"id",name:e.name?e.name:"name",objects:e.rows?e.rows:"rows",pid:e.pid?e.pid:"pid",rows:e.rows?e.rows:"rows",selected:e.selected?e.selected:"selected",statusIcon:e.statusIcon?e.statusIcon:"statusIcon",style:e.style?e.style:"style",subobjects:e.cells?e.cells:"cells",templateObj:e.templateObj?e.templateObj:"templateObj",text:e.text?e.text:"text",tooltip:e.tooltip?e.tooltip:"tooltip",value:e.value?e.value:"value",visible:e.visible?e.visible:"visible"};else this.options.rowFields={allowDrag:"allowDrag",allowDrop:"allowDrop",allowFocus:"allowFocus",canSelect:"canSelect",cells:"cells",content:"content",contentVisibility:"contentVisibility",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",fixed:"fixed",gid:"gid",hasChildren:"hasChildren",icon:"icon",id:"id",name:"name",objects:"rows",pid:"pid",rows:"rows",selected:"selected",statusIcon:"statusIcon",style:"style",subobjects:"cells",text:"text",tooltip:"tooltip",value:"value",visible:"visible"};if(this.dataService)this.dataService.updateDataFields(this.options.rowFields,this.rowDataKey)};t.prototype.updateCellFields=function(e){if(e)this.options.cellFields={allowDrag:e.allowDrag?e.allowDrag:"allowDrag",allowEdit:e.allowEdit?e.allowEdit:"allowEdit",cid:e.cid?e.cid:"cid",content:e.content?e.content:"content",contextMenu:e.contextMenu?e.contextMenu:"contextMenu",editorSettings:e.editorSettings?e.editorSettings:"editorSettings",enabled:e.enabled?e.enabled:"enabled",expanded:e.expanded?e.expanded:"expanded",isGroup:e.isGroup?e.isGroup:"isGroup",labelEdit:e.labelEdit?e.labelEdit:"labelEdit",rid:e.rid?e.rid:"rid",selected:e.selected?e.selected:"selected",style:e.style?e.style:"style",tag:e.tag?e.tag:"tag",templateObj:e.templateObj?e.templateObj:"templateObj",text:e.text?e.text:"text",tooltip:e.tooltip?e.tooltip:"tooltip",value:e.value?e.value:"value",valueID:e.valueID?e.valueID:"valueID",valueType:e.valueType?e.valueType:"valueType"};else this.options.cellFields={allowDrag:"allowDrag",allowEdit:"allowEdit",cid:"cid",content:"content",contextMenu:"contextMenu",editorSettings:"editorSettings",enabled:"enabled",expanded:"expanded",isGroup:"isGroup",labelEdit:"labelEdit",rid:"rid",selected:"selected",style:"style",tag:"tag",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value",valueID:"valueID",valueType:"valueType"}};t.prototype.updateShowScroll=function(e){if(e)this.options.showScroll={horizontal:this.commonService.isFieldAvailable(e.horizontal,!0),vertical:this.commonService.isFieldAvailable(e.vertical,!0)};else this.options.showScroll={horizontal:!0,vertical:!0}};t.prototype.processLoadData=function(e,t,i,o){var r=this;r.clearRows(t);r.updateRowFields(i);var l=[];if(e)if(o||void 0==o){var s=[];e.forEach(function(e,t){var i=e[r.options.rowFields.pid];if(s[i]){if(!s[i][r.options.rowFields.rows])s[i][r.options.rowFields.rows]=[];s[e[r.options.rowFields.id]]=e;s[i][r.options.rowFields.rows].push(e)}else{s[e[r.options.rowFields.id]]=e;l.push(e)}});s.length=0}else l=e;if(t){t[r.options.rowFields.rows]=l;for(var n=0;n<t[r.options.rowFields.rows].length;n++)t[r.options.rowFields.rows][n][r.options.rowFields.pid]=t[r.options.rowFields.id]}else if(r.rows){r.rows.length=0;for(n=0;n<l.length;n++)r.rows.push(l[n])}r.loadComplete.emit(null);this.updateLayout()};t.prototype.calcMaxColumnLevels=function(e,t){if(e&&0!=e.length)for(var i=0;i<e.length;i++)if(this.isColumnExpanded(e[i])&&this.isColumnWithChildrenVisible(e[i])){if(this.maxColumnLevels<t)this.maxColumnLevels=t;this.calcMaxColumnLevels(e[i][this.options.columnFields.columns],t+1)}};t.prototype.getColumnSpan=function(e){var t=0;if(!e[this.options.columnFields.columns]||0==e[this.options.columnFields.columns].length)return 1;for(var i=0;i<e[this.options.columnFields.columns].length;i++)t+=this.getColumnSpan(e[this.options.columnFields.columns][i]);return t};t.prototype.isColumnWithChildrenVisible=function(e){var t=!1;if(e)if(t=this.isColumnVisible(e)){var i=e[this.options.columnFields.columns];if(i&&i.length>0){for(var o=0,r=0;r<i.length;r++)if(this.isColumnWithChildrenVisible(i[r]))o++;t=o>0?!0:!1}}return t};t.prototype.createColumnLevel=function(e,t,i,o){if(e&&!(t>=this.maxColumnLevels))for(var r=0;r<e.length;){if((t>0?this.isColumnExpanded(e[r]):!0)&&this.isColumnWithChildrenVisible(e[r])){if(!e[r][this.options.columnFields.id])e[r][this.options.columnFields.id]=this.commonService.getUniqueId();if(o)e[r][this.options.columnFields.pid]=o;var l=e[r][this.options.columnFields.columns],s={colSpan:l?this.getColumnSpan(e[r]):0,data:e[r],isRoot:0==t?!0:!1,isVisible:!this.isColumnExpanded(e[r])||!l||0==l.length?!0:!1,rowSpan:!this.isColumnExpanded(e[r])||!l||0==l.length?this.maxColumnLevels-t:0};switch(i){case"left":this.completeLeftColumnList[t].push(s);break;case"right":this.completeRightColumnList[t].push(s);break;default:this.completeColumnList[t].push(s)}this.createColumnLevel(e[r][this.options.columnFields.columns],t+1,i,e[r][this.options.columnFields.id])}r++}};t.prototype.updateColumnCompleteList=function(){var e=this.currentColumnList.map(function(e){return e.data}),t=this.currentLeftColumnList.map(function(e){return e.data}),i=this.currentRightColumnList.map(function(e){return e.data});this.calcMaxColumnLevels(e,1);this.calcMaxColumnLevels(t,1);this.calcMaxColumnLevels(i,1);for(var o=1;o<=this.maxColumnLevels;o++){this.completeColumnList.push([]);this.completeLeftColumnList.push([]);this.completeRightColumnList.push([])}this.createColumnLevel(e,0);this.createColumnLevel(t,0,"left");this.createColumnLevel(i,0,"right");this.flatCompleteColumnList=this.createFlatColumnList(this.completeColumnList);this.flatCompleteLeftColumnList=this.createFlatColumnList(this.completeLeftColumnList);this.flatCompleteRightColumnList=this.createFlatColumnList(this.completeRightColumnList)};t.prototype.createScrollRowList=function(){this.createScrollNormalRowList();this.createScrollLeftRowList();this.createScrollRightRowList()};t.prototype.createScrollNormalRowList=function(){this.scrollRowList.length=0;for(var e=0;e<100;e++){var t=this.createEmptyRowObj();this.scrollRowList.push(t)}};t.prototype.createScrollLeftRowList=function(){this.scrollLeftRowList.length=0;for(var e=0;e<100;e++){var t=this.createEmptyRowObj();this.scrollLeftRowList.push(t)}};t.prototype.createScrollRightRowList=function(){this.scrollRightRowList.length=0;for(var e=0;e<100;e++){var t=this.createEmptyRowObj();this.scrollRightRowList.push(t)}};t.prototype.createEmptyRowObj=function(){for(var e={clickPos:{x:0,y:0},cells:[],data:{},draggable:!1,indent:0,inlineStyle:{},isEmpty:!0,isGroup:!1,style:{}},t=0;t<1;t++)e.cells.push(this.createEmptyCellObj());return e};t.prototype.createEmptyCellObj=function(){return{align:"",colIndex:-1,data:{},display:"none",editorClass:"",editorList:[],editorSettings:{},editorStyle:"",editorType:null,editorValue:null,expandBoxAllowed:!1,indent:0,inlineStyle:{},isEditorEnabled:!0,isEditorVisible:!0,isEmpty:!0,rowIndex:-1,style:{content:"iui-grid-row-cell-content"},tabIndex:-1,width:100,height:"auto"}};t.prototype.updateScrollRowListLimit=function(e){this.updateScrollNormalRowListLimit(e);this.updateScrollLeftRowListLimit(e);this.updateScrollRightRowListLimit(e)};t.prototype.updateScrollNormalRowListLimit=function(e){for(var t=0;t<this.scrollRowList.length;t++)for(var i=0;i<e;i++)this.scrollRowList[t].cells.push(this.createEmptyCellObj())};t.prototype.updateScrollLeftRowListLimit=function(e){for(var t=0;t<this.scrollLeftRowList.length;t++)for(var i=0;i<e;i++)this.scrollLeftRowList[t].cells.push(this.createEmptyCellObj())};t.prototype.updateScrollRightRowListLimit=function(e){for(var t=0;t<this.scrollRightRowList.length;t++)for(var i=0;i<e;i++)this.scrollRightRowList[t].cells.push(this.createEmptyCellObj())};t.prototype.getNumScrollColumns=function(e){switch(e){case"left":return this.scrollLeftRowList.length>0?this.scrollLeftRowList[0].cells.length:0;case"right":return this.scrollRightRowList.length>0?this.scrollRightRowList[0].cells.length:0}return this.scrollRowList.length>0?this.scrollRowList[0].cells.length:0};t.prototype.getNumVisibleColumns=function(e){switch(e){case"left":return this.flatCompleteLeftColumnList.filter(function(e){return e.isVisible}).length;case"right":return this.flatCompleteRightColumnList.filter(function(e){return e.isVisible}).length}return this.flatCompleteColumnList.filter(function(e){return e.isVisible}).length};t.prototype.resetRowObj=function(e){if(e){e.clickPos={x:0,y:0};e.data={};e.draggable=!1;e.indent=0;e.inlineStyle={};e.isEmpty=!0;e.isGroup=!1;e.style={}}};t.prototype.resetCellObj=function(e){if(e){e.align="";e.colIndex=-1;e.data={};e.display="none";e.editorClass="";e.editorList=[];e.editorSettings={};e.editorStyle="";e.editorType=null;e.editorValue=null;e.expandBoxAllowed=!1;e.indent=0;e.inlineStyle={};e.isEditorEnabled=!0;e.isEditorVisible=!0;e.isEmpty=!0;e.rowIndex=-1;e.style={content:"iui-grid-row-cell-content"};e.tabIndex=-1;e.width=0;e.height="auto"}};t.prototype.updateScrollColumnList=function(){};t.prototype.updateScrollRowList=function(e){};t.prototype.addDropMark=function(e){if(this.appRef){this.removeDropMark();var t=this.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUIDragWindow);if(t){this.dragCmpRef=this.appRef.createComponent(t);if(this.dragCmpRef.instance)this.dragCmp=this.dragCmpRef.instance}}};t.prototype.removeDropMark=function(){if(this.dragCmpRef)this.dragCmpRef.destroy();this.dragCmp=null};t.prototype.callDragDropEvent=function(e,t,i){var o=this,r={action:t.action,cancel:!1,dragRow:t.source,dropPos:t.dropPos,event:e,isDropAllowed:t.allow,mousePos:this.commonService.getMousePos(e),resume:function(){o.drop(e,o.dragDropService.getData());o.dragDropService.clearData()},sourceCtrl:t.sourceCtrl,targetCtrl:t.targetCtrl,targetRow:t.target};if(i)this.dragDrop.emit(r);else this.dragOver.emit(r);return r};t.prototype.checkEmptySpace=function(e){var t=this.getContentSize(),i=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild),o=i.top+t.height,r=i.bottom,l=this.commonService.getMousePos(e),s=this.commonService.getShiftPos();l.x-=s.x;l.y-=s.y;return l.y>=o&&l.y<=r};t.prototype.ctrlDragEnter=function(e){if(this.isEnabled)this.processDragEnter(e)};t.prototype.ctrlDragDrop=function(e){if(this.isEnabled)this.processDragDrop(e);this.removeDropMark();e.stopPropagation()};t.prototype.ctrlDragLeave=function(e){if(this.isEnabled)this.processDragLeave(e)};t.prototype.ctrlDragOver=function(e){if(this.isEnabled)this.processDragOver(e);e.stopPropagation()};t.prototype.ctrlDragEnd=function(e){this.removeDropMark();var t=this.dragDropService.getData();if(t.targetCtrl&&t.targetCtrl.removeDropMark)t.targetCtrl.removeDropMark();this.rowDragEnd(e,null)};t.prototype.removeDragHandle=function(){this.isDragHandleVisible=!1;this.targetDropRow=null;this.targetDropPos=-1};t.prototype.dropMark=function(e,t){if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle){if(!t)this.removeDragHandle();this.updateScrollRowListDragOver(null)}else{if(!this.dragCmp&&!this.isScrollTimerActive)this.addDropMark({x:e.pageX,y:e.pageY});if(this.dragCmp){var i="none";if(this.options.allowDrop)i=t?"block":"none";this.dragCmp.display=i}}};t.prototype.updateDragComponent=function(e){if(this.dragCmp)this.dragCmp.updatePos(e)};t.prototype.isDragAllowed=function(e){return this.options.allowDrag?e&&(e[this.options.rowFields.allowDrag]||void 0===e[this.options.rowFields.allowDrag])?!0:!1:!1};t.prototype.isDropAllowed=function(e,t,i){var o=this.options.allowDrop;if(o&&e&&t)if(o=t[this.options.rowFields.allowDrop]||void 0===t[this.options.rowFields.allowDrop]?!0:!1)if(Array.isArray(e))for(var r=0;r<e.length;r++){if(this.commonService.isEqual(e[r][this.options.rowFields.id],t[this.options.rowFields.id])||0===i&&this.isParentOf(t,e[r])||this.isChildOf(t,e[r])){o=!1;break}if(!o)break}else if(this.commonService.isEqual(e[this.options.rowFields.id],t[this.options.rowFields.id])||0===i&&this.isParentOf(t,e)||this.isChildOf(t,e))o=!1;return o};t.prototype.processDragStart=function(e,t){if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.processDragStartHandle(e,t);else this.processDragStartPopup(e,t)};t.prototype.processDragStartHandle=function(e,t){this.dragDropService.clearData();if(this.isDragAllowed(t)){if(t)if(!this.isDragAllowed(t))this.ctrlCursor="no-drop";else{var i={clone:this.cloneRow(t),handle:this.dragRowList,source:t,sourceCtrl:this,sourceData:this.rows};switch(this.selectionMode){case integralui_core_1.IntegralUISelectionMode.MultiSimple:case integralui_core_1.IntegralUISelectionMode.MultiExtended:i.clone=this.createCloneList(this.currentSelectedRows);i.source=this.currentSelectedRows}var o={action:e.shiftKey?"copy":"move",cancel:!1,dragRow:i.source,dropPos:-1,event:e,isDropAllowed:this.options.allowDrop,mousePos:this.commonService.getMousePos(e),sourceCtrl:i.sourceCtrl,targetCtrl:this,targetRow:null};this.dragStart.emit(o);if(1==o.cancel){e.preventDefault();return}else{this.isFirstDragEnter=!0;this.dragDropService.setData(i)}}}else e.preventDefault()};t.prototype.processDragStartPopup=function(e,t){this.dragDropService.clearData();if(this.isDragAllowed(t)){if(t)if(!this.isDragAllowed(t)){if(e.dataTransfer)e.dataTransfer.effectAllowed="none";else if(e.originalEvent&&e.originalEvent.dataTransfer)e.originalEvent.dataTransfer.effectAllowed="none"}else{var i={clone:this.cloneRow(t),source:t,sourceCtrl:this,sourceData:this.rows};switch(this.selectionMode){case integralui_core_1.IntegralUISelectionMode.MultiSimple:case integralui_core_1.IntegralUISelectionMode.MultiExtended:i.clone=this.createCloneList(this.currentSelectedRows);i.source=this.currentSelectedRows}var o={action:e.shiftKey?"copy":"move",cancel:!1,dragRow:i.source,dropPos:-1,event:e,isDropAllowed:this.options.allowDrop,mousePos:this.commonService.getMousePos(e),sourceCtrl:i.sourceCtrl,targetCtrl:this,targetRow:null};this.dragStart.emit(o);if(1==o.cancel){e.preventDefault();return}else{this.isDragActive=!0;this.isFirstDragEnter=!0;this.addDropMark({x:e.pageX,y:e.pageY});this.dropMark(e);if(e.dataTransfer){e.dataTransfer.effectAllowed="move";e.dataTransfer.setData("text",t[this.options.rowFields.id]?t[this.options.rowFields.id].toString():"")}else if(e.originalEvent&&e.originalEvent.dataTransfer){e.originalEvent.dataTransfer.effectAllowed="move";e.originalEvent.dataTransfer.setData("text",t[this.options.rowFields.id]?t[this.options.rowFields.id].toString():"")}this.dragDropService.setData(i)}}}else e.preventDefault()};t.prototype.processDragEnter=function(e){e.preventDefault();if(!this.isCtrlDragEntered){this.isCtrlDragEntered=!0;var t=this.dragDropService.getData();if(!this.isFirstDragEnter&&this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle){this.dragRowList=t.handle;if(this.dragRowList){for(var i=0;i<this.dragRowList.length;i++){var o=this.getObjIndexFromScrollList(this.dragRowList[i].data);if(o>=0)this.scrollRowList.splice(o,1)}this.isDragHandleVisible=!0;this.targetDropPos=2;this.targetDropRow=this.scrollRowList.length>0?this.scrollRowList[this.scrollRowList.length-1].data:null;this.scrollRowList.splice(this.scrollRowList.length,0,{cells:[],draggable:!1,isEmpty:!0,status:1,style:{}})}}this.isFirstDragEnter=!1;var r={action:e.shiftKey?"copy":"move",dragRow:t.source,dropPos:-1,event:e,isDropAllowed:this.options.allowDrop,mousePos:this.commonService.getMousePos(e),sourceCtrl:t.sourceCtrl,targetCtrl:this,targetRow:null};this.dragEnter.emit(r)}};t.prototype.processDragLeave=function(e){e.preventDefault();if(this.isCtrlDragEntered){var t=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild),i=this.commonService.getMousePos(e),o=this.commonService.getShiftPos();i.x-=o.x;i.y-=o.y;if(i.x<=t.left||i.x>=t.right||i.y<=t.top||i.y>=t.bottom){this.isCtrlDragEntered=!1;if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.updateScrollRowList();this.stopScrollTimer();var r=this.dragDropService.getData(),l={action:e.shiftKey?"copy":"move",dragRow:r.source,dropPos:-1,event:e,isDropAllowed:!1,mousePos:this.commonService.getMousePos(e),sourceCtrl:r.sourceCtrl,targetCtrl:null,targetRow:null};this.dragLeave.emit(l)}this.dropMark(e)}};t.prototype.processDragOver=function(e,t,i,o,r){if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.processDragOverHandle(e,t,i,o,r);else this.processDragOverPopup(e,t,i,o,r)};t.prototype.processDragOverHandle=function(e,t,i,o,r){e.preventDefault();this.processDragEnter(e);this.hoverRow=null;this.changeCursor();var l=this.isDragActive;if(l){var s=this.dragDropService.getData(),n=this.commonService.getShiftPos();if(t&&!t.isEmpty){var a=this.commonService.getMousePos(e);a.x-=n.x;a.y-=n.y;var c="group"==t.data.type?"full":null,d=this.dragDropService.getDropPos(a,i,o,c);l=this.isDropAllowed(s.source,t.data,d);var u={action:e.shiftKey?"copy":"move",source:s.source,dropPos:d,allow:l,sourceCtrl:s.sourceCtrl,target:t.data,targetCtrl:this},h=this.callDragDropEvent(e,u);if(!l||1==h.cancel){this.ctrlCursor="no-drop";this.dropMark(e,!0);this.targetDropPos=-1;this.updateScrollRowListDragOver(t.data);this.updateDragHandlePos(e)}else{this.isDragHandleVisible=!0;this.dragRowList=s.handle;this.targetDropPos=d;this.updateScrollRowListDragOver(t.data);var p=this.getObjFromRow(t.data);this.dragObjIndent=p.indent;if(t.data[this.options.rowFields.rows]&&t.data[this.options.rowFields.rows].length>0)this.dragObjIndent+=this.options.indent;this.updateDragHandlePos(e);this.dragDropService.setData({action:e.shiftKey?"copy":"move",clone:s.clone,handle:s.handle,source:s.source,sourceCtrl:s.sourceCtrl,sourceData:s.sourceData,target:t.data,targetCtrl:this,dropPos:d})}}else if(!this.options.allowDrop){this.ctrlCursor="no-drop";this.dropMark(e)}else{this.dragRowList=s.handle;this.scrollRowList.length>0&&this.scrollRowList[this.scrollRowList.length-1].data;this.updateDragHandlePos(e)}}};t.prototype.processDragOverPopup=function(e,t,i,o,r){e.preventDefault();this.processDragEnter(e);var l=!0;if(e.dataTransfer)l="none"===e.dataTransfer.effectAllowed?!1:!0;else if(e.originalEvent&&e.originalEvent.dataTransfer)l="none"===e.originalEvent.dataTransfer.effectAllowed?!1:!0;if(l){var s=this.dragDropService.getData(),n=this.commonService.getShiftPos();if(t&&!t.isEmpty){(f=this.commonService.getMousePos(e)).x-=n.x;f.y-=n.y;var a="group"==t.data.type?"full":null,c=this.dragDropService.getDropPos(f,i,o,a);l=this.isDropAllowed(s.source,t.data,c);var d={action:e.shiftKey?"copy":"move",source:s.source,dropPos:c,allow:l,sourceCtrl:s.sourceCtrl,target:t.data,targetCtrl:this},u=this.callDragDropEvent(e,d);if(!l||1==u.cancel){if(e.dataTransfer)e.dataTransfer.dropEffect="none";else if(e.originalEvent&&e.originalEvent.dataTransfer)e.originalEvent.dataTransfer.dropEffect="none";this.dropMark(e)}else{var h=this.commonService.getMousePos(e),p=h.y+16,g=h.x+20,m="iui-dragwin-icon";switch(u.dropPos){case 0:m+=" iui-dragwin-move-in";break;case 1:m+=" iui-dragwin-move-up";break;case 2:m+=" iui-dragwin-move-down"}if("copy"==u.action)m+="-copy";this.updateDragComponent({class:m,top:p,left:g,text:t.data[this.options.rowFields.text]});this.dropMark(e,l);this.dragDropService.setData({action:u.action,clone:s.clone,dropPos:u.dropPos,source:s.source,sourceCtrl:s.sourceCtrl,sourceData:s.sourceData,target:t.data,targetCtrl:this})}}else if(!this.options.allowDrop){if(e.dataTransfer)e.dataTransfer.dropEffect="none";else if(e.originalEvent&&e.originalEvent.dataTransfer)e.originalEvent.dataTransfer.dropEffect="none";this.dropMark(e)}else{l=this.checkEmptySpace(e);d={action:e.shiftKey?"copy":"move",allow:l,dropPos:-1,source:s.source,sourceCtrl:s.sourceCtrl,target:null,targetCtrl:this},u=this.callDragDropEvent(e,d);if(!l||1==u.cancel){if(e.dataTransfer)e.dataTransfer.dropEffect="none";else if(e.originalEvent&&e.originalEvent.dataTransfer)e.originalEvent.dataTransfer.dropEffect="none";this.dropMark(e)}else{var f;p=(f=this.commonService.getMousePos(e)).y+16,g=f.x+20,m="iui-dragwin-icon iui-dragwin-move-end";if("copy"==u.action)m+="-copy";this.updateDragComponent({class:m,top:p,left:g,text:this.name?this.name:"Component"});this.dropMark(e,l&&!this.isScrollTimerActive);this.dragDropService.setData({action:u.action,clone:s.clone,source:s.source,sourceCtrl:s.sourceCtrl,sourceData:s.sourceData,target:null,targetCtrl:this,dropPos:-1})}}}};t.prototype.processDragDrop=function(e,t){e.preventDefault();var i=!0;if(e.dataTransfer)i="none"===e.dataTransfer.effectAllowed?!1:!0;else if(e.originalEvent&&e.originalEvent.dataTransfer)i="none"===e.originalEvent.dataTransfer.effectAllowed?!1:!0;var o=this.dragDropService.getData();if(i){if(t&&!t.isEmpty)i=this.isDropAllowed(o.source,t.data,o.dropPos);else i=this.checkEmptySpace(e);if(i&&o.source){var r={action:o.action,source:o.source,dropPos:o.dropPos,allow:i,sourceCtrl:o.sourceCtrl,target:o.target,targetCtrl:this},l=this.callDragDropEvent(e,r,!0);this.dragDropService.setData({action:l.action,clone:o.clone,dropPos:l.dropPos,source:o.source,sourceCtrl:o.sourceCtrl,sourceData:o.sourceData,target:o.target,targetCtrl:this});if(!l.cancel)this.drop(e,this.dragDropService.getData());else i=!1}if(o.sourceCtrl&&o.sourceCtrl.removeDropMark)o.sourceCtrl.removeDropMark()}if(i)this.dragDropService.clearData();else if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.updateLayout();var s=this,n=setTimeout(function(){s.dropMark(e);if(i){var t=s.dragDropService.getData(),o={action:t.action,dragRow:t.source,dropPos:t.dropPos,event:e,isDropAllowed:!0,mousePos:s.commonService.getMousePos(e),sourceCtrl:t.sourceCtrl,targetCtrl:s,targetRow:t.target};s.dragDropComplete.emit(o)}s.isDragActive=!1;s.clearDragDropSettings();clearTimeout(n)},150)};t.prototype.clearDragDropSettings=function(){this.dragDropService.clearData();this.isDragActive=!1;this.isDragHandleVisible=!1;this.dragStartPos={x:0,y:0};this.dragEndPos={x:0,y:0};this.changeCursor()};t.prototype.drop=function(e,t){if(t&&t.sourceCtrl){var i="copy"==t.action&&t.clone?t.clone:t.source;if(Array.isArray(i)){for(var o=[],r=0;r<i.length;r++)o.push(i[r]);if(o.length>0){for(r=0;r<o.length;r++)this.processDataDrop(e,o[r],t);this.clearPrevSelection()}}else{this.processDataDrop(e,i,t);this.clearPrevSelection()}if(t.sourceCtrl!=t.targetCtrl&&t.sourceCtrl.updateLayout)t.sourceCtrl.updateLayout();this.updateLayout()}this.isCtrlDragEntered=!1};t.prototype.processDataDrop=function(e,t,i){var o="copy"==i.action;if("copy"!=i.action&&i.sourceCtrl&&i.sourceCtrl.removeRow)o=i.sourceCtrl.removeRow(t);if(o)switch(i.dropPos){case 0:if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.insertRowAt(t,0,i.target);else this.insertRowAt(t,-1,i.target);break;case 1:this.insertRowBefore(t,i.target);break;case 2:this.insertRowAfter(t,i.target);break;default:this.addRow(t)}};t.prototype.callAfterSelectEvent=function(e){var t={obj:e};this.afterSelect.emit(t);this.selectionChanged.emit(null)};t.prototype.rowDragEnd=function(e,t){var i=this.dragDropService.getData(),o={action:e.shiftKey?"copy":"move",dragRow:i.source,dropPos:i.dropPos,event:e,mousePos:this.commonService.getMousePos(e),sourceCtrl:i.sourceCtrl,targetCtrl:this,targetRow:i.target};this.dragEnd.emit(o)};t.prototype.getEmptyObj=function(e){for(var t=null,i=0;i<this.scrollRowList.length;i++)if(this.scrollRowList[i].status==e){t=this.scrollRowList[i];break}return t};t.prototype.removeEmptyRow=function(e){var t=this.getEmptyObj(e);if(t){var i=this.scrollRowList.indexOf(t);if(i>=0)this.scrollRowList.splice(i,1)}};t.prototype.updateDragHandlePos=function(e){};t.prototype.updateScrollRowListDragOver=function(e){};t.prototype.addCalendar=function(){var e=this;if(e.appRef&&e.isEditorPresent(integralui_core_1.IntegralUIEditorType.Date)&&!e.calendarRef){e.removeCalendar();var t=e.cmpResolver.resolveComponentFactory(integralui_datepicker_1.IntegralUICalendarPopup);if(t){e.calendarRef=e.appRef.createComponent(t);if(e.calendarRef.instance)e.calendar=e.calendarRef.instance;e.hideCalendar();if(e.calendar){e.calendar.closed.subscribe(function(t){e.hideCalendar()});e.calendar.dateChanged.subscribe(function(t){e.hideCalendar();if(e.currentEditorCell&&1!=e.callCellValueChanging(e.currentEditorCell,t.date)){e.currentEditorCell.data[e.options.cellFields.value]=t.date;e.updateScrollRowList();e.callCellValueChanged(e.currentEditorCell)}e.isPopupDelayed=!0;setTimeout(function(){e.isPopupDelayed=!1},250)})}}}};t.prototype.addColorPopup=function(){var e=this;if(e.appRef&&e.isEditorPresent(integralui_core_1.IntegralUIEditorType.Color)&&!e.colorPopupRef){e.removeColorPopup();var t=e.cmpResolver.resolveComponentFactory(integralui_colorpicker_1.IntegralUIColorPickerPopup);if(t){e.colorPopupRef=e.appRef.createComponent(t);if(e.colorPopupRef.instance)e.colorPopup=e.colorPopupRef.instance;e.hideColorPopup();if(e.colorPopup)e.colorPopup.closed.subscribe(function(t){e.hideColorPopup();if(e.currentEditorCell&&1!=e.callCellValueChanging(e.currentEditorCell,t.value)){e.currentEditorCell.data[e.options.cellFields.value]=t.value;e.updateScrollRowList();e.callCellValueChanged(e.currentEditorCell)}e.isPopupDelayed=!0;setTimeout(function(){e.isPopupDelayed=!1},250)})}}};t.prototype.addDropList=function(){var e=this;if(e.appRef&&e.isEditorPresent(integralui_core_1.IntegralUIEditorType.DropList)&&!e.dropListRef){e.removeDropList();var t=e.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUIListPopup);if(t){e.dropListRef=e.appRef.createComponent(t);if(e.dropListRef.instance)e.dropList=e.dropListRef.instance;e.hideDropList();if(e.dropList){e.dropList.closed.subscribe(function(t){e.hideDropList()});e.dropList.selectionChanged.subscribe(function(t){e.hideDropList();if(t.item&&e.currentEditorCell&&1!=e.callCellValueChanging(e.currentEditorCell,t.item.value)){e.currentEditorCell.data[e.options.cellFields.value]=t.item.value;e.callCellValueChanged(e.currentEditorCell)}e.isPopupDelayed=!0;setTimeout(function(){e.isPopupDelayed=!1},250)})}}}};t.prototype.callCellValueChanging=function(e,t){var i={cancel:!1,cell:e.data,text:e.data[this.options.cellFields.text],value:void 0!=t?t:e.data[this.options.cellFields.value]};this.cellValueChanging.emit(i);return i.cancel};t.prototype.callCellValueChanged=function(e){var t={cell:e.data,text:e.data[this.options.cellFields.text],value:e.data[this.options.cellFields.value]};this.cellValueChanged.emit(t)};t.prototype.closeEditor=function(){this.currentEditorCell=null;this.originalEditorText="";this.originalEditorValue=null;this.isEditorFocused=!1};t.prototype.editCheckBoxValue=function(e){if(e.isEditorEnabled){var t=void 0!=e.data[this.options.cellFields.value]?e.data[this.options.cellFields.value]:"unchecked";if(1!=this.callCellValueChanging(e)){if("checked"==t||1==t)t="checked";else if(e.editorSettings&&e.editorSettings.threeState&&"indeterminate"==t)t="indeterminate";else t="unchecked";var i="unchecked";if(e.editorSettings&&e.editorSettings.threeState)switch(t){case"checked":i="unchecked";break;case"indeterminate":i="checked";break;case"unchecked":i="indeterminate"}else i="unchecked"==t?!0:!1;e.data[this.options.cellFields.value]=i;this.updateScrollRowList();this.callCellValueChanged(e)}}};t.prototype.editorClick=function(e){e.stopPropagation()};t.prototype.editorDblClickEvent=function(e){e.stopPropagation()};t.prototype.editorKeyDown=function(e,t){if(this.currentEditorCell)switch(e.keyCode){case 13:switch(t){case"numeric":this.callCellValueChanged(this.currentEditorCell);break;default:this.cellValueChanged.emit({cell:this.currentEditorCell.data,orgText:this.originalEditorText,text:this.currentEditorCell.data[this.options.cellFields.text],value:this.currentEditorCell.data[this.options.cellFields.value]})}this.closeEditor();break;case 27:switch(t){case"numeric":this.currentEditorCell.data[this.options.cellFields.value]=this.originalEditorValue;break;default:this.currentEditorCell.data[this.options.cellFields.text]=this.originalEditorText}this.closeEditor()}};t.prototype.editorLostFocus=function(e){if(this.currentEditorCell)switch(e){case"numeric":this.currentEditorCell.data[this.options.cellFields.value]=this.originalEditorValue;break;default:this.currentEditorCell.data[this.options.cellFields.text]=this.originalEditorText}this.closeEditor()};t.prototype.editorMouseDown=function(e,t){};t.prototype.editorMouseWheel=function(e){e.stopPropagation()};t.prototype.editorMouseTouch=function(e,t){e.stopPropagation()};t.prototype.editorNumericValueChange=function(e,t){if(t&&!isNaN(t)){var i=Number(t),o=e.editorSettings&&void 0!=e.editorSettings.min?e.editorSettings.min:-9999999,r=e.editorSettings&&void 0!=e.editorSettings.max?e.editorSettings.max:9999999;e.data[this.options.cellFields.value]=Math.min(Math.max(i,o),r);this.callCellValueChanged(e)}};t.prototype.editorPreventDragStart=function(e){e.preventDefault();e.stopPropagation()};t.prototype.editorValueChanged=function(e,t){if(!this.isLayoutUpdating&&!this.isScrollActive)this.callCellValueChanged(t)};t.prototype.getCellEditorClass=function(e){var t="",i=e.editorSettings&&e.editorSettings.style?e.editorSettings.style:{};switch(e.editorType){case integralui_core_1.IntegralUIEditorType.CheckBox:t="iui-editor-checkbox";t+=i.general?" "+i.general:"";switch(e.editorValue){case"checked":t+=i.checked?" "+i.checked:" iui-editor-checkbox-checked";break;case"indeterminate":t+=i.indeterminate?" "+i.indeterminate:" iui-editor-checkbox-indeterminate";break;default:t+=i.unchecked?" "+i.unchecked:" iui-editor-checkbox-unchecked"}if(!e.isEditorEnabled)t+=i.disabled?" "+i.disabled:" iui-editor-checkbox-disabled"}return t};t.prototype.getCellEditorList=function(e){return void 0!=e[this.options.columnFields.editorSettings]&&void 0!=e[this.options.columnFields.editorSettings].list?e[this.options.columnFields.editorSettings].list:[]};t.prototype.getCellEditorSettings=function(e){return void 0!=e[this.options.columnFields.editorSettings]?e[this.options.columnFields.editorSettings]:{}};t.prototype.getCellEditorStyle=function(e){var t={},i=e.editorSettings&&e.editorSettings.style?e.editorSettings.style:{};switch(e.editorType){case integralui_core_1.IntegralUIEditorType.Rating:t=i}return t};t.prototype.getCellEditorType=function(e){return void 0!=e[this.options.columnFields.editorType]?e[this.options.columnFields.editorType]:integralui_core_1.IntegralUIEditorType.None};t.prototype.getCellEditorVisibility=function(e,t){var i=!0;switch((void 0!=t[this.options.cellFields.editorSettings]?t[this.options.cellFields.editorSettings]:{}).visible){case integralui_core_1.IntegralUIVisibility.None:i=!1}return i};t.prototype.getCellField=function(e){switch(e){case"text":return this.options.cellFields.text;case"value":return this.options.cellFields.value}};t.prototype.getCellText=function(e){return void 0!=e.data[this.options.cellFields.text]?e.data[this.options.cellFields.text]:""};t.prototype.getCellValue=function(e){var t=void 0!=e.data[this.options.cellFields.value]?e.data[this.options.cellFields.value]:null;switch(e.editorType){case integralui_core_1.IntegralUIEditorType.CheckBox:if(e.editorSettings)if("checked"==t||1==t)t="checked";else if(e.editorSettings.threeState&&"indeterminate"==t)t="indeterminate";else t="unchecked";break;case integralui_core_1.IntegralUIEditorType.Color:if(e.editorSettings)switch(e.editorSettings.colorFormat){case integralui_core_1.IntegralUIColorFormat.HEX:t=null!==t?"object"===typeof t?t.hex:t:"";break;default:t=null!==t?"object"===typeof t?t.rgb:t:""}break;case integralui_core_1.IntegralUIEditorType.Date:var i="en-US",o={year:"numeric",month:"numeric",day:"numeric"};if(e.editorSettings){i=e.editorSettings.locales?e.editorSettings.locales:"en-US";switch(e.editorSettings.format){case integralui_core_1.IntegralUIDateFormat.Long:o.weekday="long";break;case integralui_core_1.IntegralUIDateFormat.Custom:o=e.editorSettings.formatOptions}}t=t?t.toLocaleString(i,o):"";break;case integralui_core_1.IntegralUIEditorType.DropList:if(this.commonService.isObject(t))t=t?t.text:"";else t=void 0!=t&&e.editorSettings?this.findItemByValue(t,e.editorSettings.items):"";break;case integralui_core_1.IntegralUIEditorType.Image:t=Array.isArray(t)?t:[{src:t}];break;case integralui_core_1.IntegralUIEditorType.Progress:t=this.getEditorProgressValue(e);break;case integralui_core_1.IntegralUIEditorType.Numeric:t=void 0!=e.data[this.options.cellFields.value]?e.data[this.options.cellFields.value]:"";break;case integralui_core_1.IntegralUIEditorType.TextBox:t=void 0!=e.data[this.options.cellFields.text]?e.data[this.options.cellFields.text]:""}return t};t.prototype.getEditorColorValue=function(e){var t="";if(e.editorSettings)switch(e.editorSettings.colorFormat){case integralui_core_1.IntegralUIColorFormat.HEX:t=e.editorValue;break;default:t="rgba("+e.editorValue+", 1)"}return t};t.prototype.findItemByValue=function(e,t){for(var i="",o=0;o<t.length;o++)if(void 0!=t[o].value&&t[o].value==e){i=void 0!=t[o].text&&""!=t[o].text?t[o].text:t[o].value.toString();break}return i};t.prototype.getEditorProgressStyle=function(e){return{width:e.editorValue+"%","z-index":2}};t.prototype.getEditorProgressValue=function(e){var t=e.editorSettings&&void 0!=e.editorSettings.min?e.editorSettings.min:0,i=e.editorSettings&&void 0!=e.editorSettings.max?e.editorSettings.max:100,o=e.data[this.options.cellFields.value];if(o&&!isNaN(o)&&!isNaN(i)&&i>0){return 100*Math.min(Math.max(o,t),i)/i}return 0};t.prototype.getHoverRow=function(){return this.hoverRow};t.prototype.hideCalendar=function(){if(this.calendar)this.calendar.display="none"};t.prototype.hideColorPopup=function(){if(this.colorPopup)this.colorPopup.display="none"};t.prototype.hideDropList=function(){if(this.dropList)this.dropList.display="none"};t.prototype.isCellEditorEnabled=function(e,t){return 0!=(void 0!=t[this.options.cellFields.editorSettings]?t[this.options.cellFields.editorSettings]:{}).enabled?!0:!1};t.prototype.isEditorPresent=function(e){var t=!1;if(!(t=this.isEditorPresentInList(e)))t=this.isEditorPresentInList(e,"left");else if(!t)t=this.isEditorPresentInList(e,"right");return t};t.prototype.isEditorPresentInList=function(e,t){var i=this,o=this.getColumnList(t),r=o?o.filter(function(t){return t.data[i.options.columnFields.editorType]===e}):null;return r&&r.length>0?!0:!1};t.prototype.openEditor=function(e,t,i){this.currentEditorCell=t;this.isEditorFocused=!0;switch(i){case"numeric":this.originalEditorValue=t.data[this.options.cellFields.value];break;default:this.originalEditorText=t.data[this.options.cellFields.text]}};t.prototype.removeCalendar=function(){if(this.calendar){if(this.calendar.closed)this.calendar.closed.unsubscribe();if(this.calendar.dateChanged)this.calendar.dateChanged.unsubscribe()}if(this.calendarRef)this.calendarRef.destroy();this.calendar=null};t.prototype.removeColorPopup=function(){if(this.colorPopup)if(this.colorPopup.closed)this.colorPopup.closed.unsubscribe();if(this.colorPopupRef)this.colorPopupRef.destroy();this.colorPopup=null};t.prototype.removeDropList=function(){if(this.dropList){if(this.dropList.closed)this.dropList.closed.unsubscribe();if(this.dropList.selectionChanged)this.dropList.selectionChanged.unsubscribe()}if(this.dropListRef)this.dropListRef.destroy();this.dropList=null};t.prototype.showPopup=function(e,t,i,o){var r=this.commonService.getShiftPos(),l=this.commonService.getPageRect(i.nativeElement),s=this.commonService.getPageRect(o.nativeElement);switch(t.editorType){case integralui_core_1.IntegralUIEditorType.Color:if(this.colorPopup){this.colorPopup.allowAnimation=!1;this.colorPopup.colorFormat=t.editorSettings&&void 0!=t.editorSettings.colorFormat?t.editorSettings.colorFormat:integralui_core_1.IntegralUIColorFormat.RGB;this.colorPopup.display="block";this.colorPopup.originalColorFormat=this.colorPopup.colorFormat;this.colorPopup.position={x:s.left+r.x-1,y:l.bottom+r.y};this.colorPopup.size={width:this.colorPanelSize.width,height:0};this.colorPopup.maxSize={width:this.colorPanelSize.width,height:this.colorPanelSize.height};if(null!=t.data.value)this.colorPopup.value="object"===typeof t.data.value?this.colorPopup.colorFormat==integralui_core_1.IntegralUIColorFormat.HEX?t.data.value.hex:t.data.value.rgb:t.data.value;if(!this.colorPopup.value)switch(this.colorPopup.colorFormat){case integralui_core_1.IntegralUIColorFormat.HEX:this.colorPopup.value="#000000";break;default:this.colorPopup.value="0, 0, 0"}this.colorPopup.size={width:this.colorPopup.maxSize.width,height:this.colorPopup.maxSize.height};if(this.allowAnimation)this.colorPopup.position.y-=2;this.colorPopup.open();this.currentEditorCell=t;this.colorPopup.focus()}break;case integralui_core_1.IntegralUIEditorType.Date:if(this.calendar){this.calendar.allowAnimation=t.editorSettings&&void 0!=t.editorSettings.allowAnimation?t.editorSettings.allowAnimation:!0;this.calendar.animationSpeed=t.editorSettings&&void 0!=t.editorSettings.animationSpeed?t.editorSettings.animationSpeed:integralui_core_1.IntegralUISpeedMode.Normal;this.calendar.calendarStyle=t.editorSettings&&t.editorSettings.style&&t.editorSettings.style.calendar?t.editorSettings.style.calendar:null;this.calendar.date=t.data.value;this.calendar.display="block";this.calendar.firstDayOfWeek=t.editorSettings&&void 0!=t.editorSettings.firstDayOfWeek?t.editorSettings.firstDayOfWeek:integralui_core_1.IntegralUIWeekDays.Sunday;this.calendar.position={x:s.left+r.x-1,y:l.bottom+r.y};this.calendar.size=t.editorSettings&&t.editorSettings.calendarSize?t.editorSettings.calendarSize:{width:250,height:200};if(this.allowAnimation)this.calendar.position.y-=2;this.calendar.refresh();this.calendar.open();this.currentEditorCell=t;this.calendar.focus()}break;case integralui_core_1.IntegralUIEditorType.DropList:if(this.dropList){this.dropList.allowAnimation=t.editorSettings&&void 0!=t.editorSettings.allowAnimation?t.editorSettings.allowAnimation:!0;this.dropList.animationSpeed=t.editorSettings&&void 0!=t.editorSettings.animationSpeed?t.editorSettings.animationSpeed:integralui_core_1.IntegralUISpeedMode.Normal;this.dropList.display="block";this.dropList.items=t.editorSettings&&t.editorSettings.items?t.editorSettings.items:[];this.dropList.listStyle=t.editorSettings&&t.editorSettings.style&&t.editorSettings.style.list?t.editorSettings.style.list:null;this.dropList.minWidth=t.editorSettings&&t.editorSettings.minWidth?t.editorSettings.minWidth:s.width;this.dropList.maxVisibleItems=t.editorSettings&&t.editorSettings.maxVisibleItems?t.editorSettings.maxVisibleItems:5;this.dropList.position={x:s.left+r.x-1,y:l.bottom+r.y};this.dropList.size={width:Math.max(s.width,this.dropList.minWidth),height:0};this.dropList.refresh();this.dropList.open();this.currentEditorCell=t;this.dropList.focus()}}};t.prototype.selectTextBoxContent=function(e){if(e.target)setTimeout(function(){e.target.setSelectionRange(0,e.target.value.length)},1)};t.prototype.expandBoxMouseDown=function(e,t){if(this.isEnabled){if(1==e.buttons&&!this.isExpandBoxTouched)this.toggle(t);this.isExpandBoxTouched=!1}e.stopPropagation()};t.prototype.expandBoxMouseUp=function(e,t){this.isExpandBoxTouched=!1;e.stopPropagation()};t.prototype.expandBoxTouchStart=function(e,t){if(this.isEnabled){this.isExpandBoxTouched=!0;this.toggle(t)}e.stopPropagation()};t.prototype.toggle=function(e,t){};t.prototype.updateExpandingCell=function(e,t){var i=0,o=this.getExpandingColumn();if(o)i=o[this.options.columnFields.id];var r=this.getCellByColumnId(e[this.options.rowFields.cells],i);if(r)r[this.options.cellFields.expanded]=t};t.prototype.convertToCSV=function(e){for(var t="",i=0;i<e.length;i++){var o="",r=e[i];if(r.length>0){for(var l=0;l<r.length;l++)o+=r[l].text+",";o=o.slice(0,-1);o+="\r\n"}t+=o}return t};t.prototype.exportToCSV=function(){for(var e=[],t=[],i=0;i<this.currentColumnList.length;i++){var o=this.currentColumnList[i].data,r={text:void 0!=o[this.options.columnFields.headerText]?o[this.options.columnFields.headerText].toString():""};t.push(r)}e.push(t);for(var l=this.getFullList(),s=0;s<l.length;s++){var n=l[s];t=[];for(i=0;i<this.currentColumnList.length;i++){var a=this.currentColumnList[i].data[this.options.columnFields.id],c=this.getCellByColumnId(n[this.options.rowFields.cells],a);r={};if(c)if(c.value)if(c.value instanceof Date)r.text=c.value.toLocaleDateString();else r.text=JSON.stringify(c.value);else if(c.text)r.text=c.text.indexOf(",")>=0?JSON.stringify(c.text):c.text;else r.text="";else r.text="";t.push(r)}e.push(t)}return this.convertToCSV(e)};t.prototype.exportToJSON=function(e,t,i,o){return'[\n{ "columns": '+this.exportColumnsToJSON(e,i)+' },\n{ "rows": '+this.exportRowsToJSON(t,i,o)+" }\n]"};t.prototype.exportColumnsToJSON=function(e,t){t=t?t:null;var i=this.columns,o=e?e:[this.options.columnFields.allowDrag,this.options.columnFields.allowDrop,this.options.columnFields.allowFilter,this.options.columnFields.allowGrouping,this.options.columnFields.allowResize,this.options.columnFields.canSelect,this.options.columnFields.cellTemplateUrl,this.options.columnFields.columns,this.options.columnFields.contentAlignment,this.options.columnFields.contextMenu,this.options.columnFields.editorType,this.options.columnFields.editorSettings,this.options.columnFields.editorTemplate,this.options.columnFields.filterParams,this.options.columnFields.fixed,this.options.columnFields.fixedWidth,this.options.columnFields.footerAlignment,this.options.columnFields.footerContent,this.options.columnFields.footerText,this.options.columnFields.footerTooltip,this.options.columnFields.groupText,this.options.columnFields.headerAlignment,this.options.columnFields.headerContent,this.options.columnFields.headerText,this.options.columnFields.headerTooltip,this.options.columnFields.icon,this.options.columnFields.id,this.options.columnFields.minWidth,this.options.columnFields.maxWidth,this.options.columnFields.pid,this.options.columnFields.selected,this.options.columnFields.style,this.options.columnFields.visible,this.options.columnFields.width];return JSON.stringify(i,o,t)};t.prototype.exportRowsToJSON=function(e,t,i){t=t?t:null;var o=0==i?this.rows:this.getFullList(),r=e?e:[this.options.rowFields.allowCellFocus,this.options.rowFields.allowDrag,this.options.rowFields.allowDrop,this.options.rowFields.allowEdit,this.options.rowFields.allowFocus,this.options.rowFields.autoCheck,this.options.rowFields.canSelect,this.options.rowFields.cells,this.options.rowFields.checked,this.options.rowFields.checkState,this.options.rowFields.content,this.options.rowFields.contentVisibility,this.options.rowFields.contextMenu,this.options.rowFields.gid,this.options.rowFields.enabled,this.options.rowFields.expanded,this.options.rowFields.fixed,this.options.rowFields.hasChildren,this.options.rowFields.icon,this.options.rowFields.id,this.options.rowFields.pid,this.options.rowFields.selected,this.options.rowFields.statusIcon,this.options.rowFields.style,this.options.rowFields.text,this.options.rowFields.tooltip,this.options.rowFields.value,this.options.rowFields.visible,this.options.cellFields.allowDrag,this.options.cellFields.allowEdit,this.options.cellFields.cid,this.options.cellFields.content,this.options.cellFields.contextMenu,this.options.cellFields.editorSettings,this.options.cellFields.enabled,this.options.cellFields.isGroup,this.options.cellFields.rid,this.options.cellFields.selected,this.options.cellFields.style,this.options.cellFields.tag,this.options.cellFields.text,this.options.cellFields.tooltip,this.options.cellFields.value,this.options.cellFields.valueID,this.options.cellFields.valueType];if(0==i)r.push(this.options.rowFields.rows);return JSON.stringify(o,r,t)};t.prototype.filter=function(e,t){if(e)e[this.options.columnFields.filterParams]=t;else{for(var i=0;i<this.flatCurrentColumnList.length;i++)this.flatCurrentColumnList[i][this.options.columnFields.filterParams]=null;for(i=0;i<this.flatCurrentLeftColumnList.length;i++)this.flatCurrentLeftColumnList[i][this.options.columnFields.filterParams]=null;for(i=0;i<this.flatCurrentRightColumnList.length;i++)this.flatCurrentRightColumnList[i][this.options.columnFields.filterParams]=null}this.updateLayout();this.change.emit({type:"filtering"})};t.prototype.changeCursor=function(e){var t="default";if(this.isEnabled)if(this.isDragActive&&this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)t="move";else if(this.resizeColumnIndex>=0||this.isColumnResizing)t="ew-resize";this.ctrlCursor=t};t.prototype.checkStatus=function(e){var t=!1;switch(e){case"column-reorder":t=this.columnReorderActive}return t};t.prototype.clearHoverRow=function(e){};t.prototype.cloneRow=function(e){return this.dataService.clone(e,this.rowDataKey)};t.prototype.createCloneList=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.cloneRow(e[i]));return t};t.prototype.createFlatColumnList=function(e){var t=[];e.map(function(e){return e.map(function(e){return t.push(e)})});return t};t.prototype.createFlatList=function(e,t,i){var o=this;if(e)e.map(function(e){i.push(e);o.createFlatList(e[t],t,i)})};t.prototype.createColumnListInRange=function(e,t){var i=this;if(e)e.map(function(e){var o={colIndex:i.getColumnIndexFromList(e),data:e,isVisible:!i.isColumnExpanded(e)||!e[i.options.columnFields.columns]||0==e[i.options.columnFields.columns].length?!0:!1};t.push(o);if(i.isColumnExpanded(e))i.createColumnListInRange(e[i.options.columnFields.columns],t)})};t.prototype.getColumnListInRange=function(e){var t=[],i=[];switch(e){case"left":i=this.completeLeftColumnList;break;case"right":i=this.completeRightColumnList;break;default:i=this.completeColumnList}if(i.length>0){var o=i[0],r=e?0:this.viewIndexRange.left,l=e?o.length-1:this.viewIndexRange.right,s=(this.isIndexInRange(r,o)?o[r]:o[0],this.isIndexInRange(l,o)?o[l]:o[o.length-1],o.filter(function(e,t){return t>=r&&t<=l}).map(function(e){return e.data}));this.createColumnListInRange(s,t)}return t};t.prototype.getCellByColumnId=function(e,t){var i=null;if(e)for(var o=0;o<e.length;o++)if(e[o][this.options.cellFields.cid]==t){i=e[o];break}return i};t.prototype.getCellWidth=function(e,t,i){var o=this.getColumnWidth(t);if(t&&this.getColumnIndex(t)==this.expandColIndex)o-=e.indent;return o=o>0?o:0};t.prototype.getColumnAllowResize=function(e){var t=e[this.options.columnFields.allowResize];if(t)return{left:this.commonService.isFieldAvailable(t.left,!0),right:this.commonService.isFieldAvailable(t.right,!0)};else return{left:!0,right:!0}};t.prototype.getColumnById=function(e){var t=null,i=[];this.createFlatList(this.dataService.getList(null,this.columnDataKey),this.options.columnFields.columns,i);if(i)for(var o=0;o<i.length;o++)if(i[o][this.options.columnFields.id]==e){t=i[o];break}return t};t.prototype.getColumnCurrentIndex=function(e){return e?this.getColumnIndexFromList(e):-1};t.prototype.getColumnIndexFromList=function(e){for(var t=-1,i=this.getColumnList(e[this.options.columnFields.fixed]),o=0;o<i.length;o++)if(i[o].data==e){t=o;break}return t};t.prototype.getColumnList=function(e){switch(e){case"left":return this.flatCompleteLeftColumnList;case"right":return this.flatCompleteRightColumnList}return this.flatCompleteColumnList};t.prototype.getCurrentColumnList=function(e){switch(e){case"left":return this.flatCurrentLeftColumnList;case"right":return this.flatCurrentRightColumnList}return this.flatCurrentColumnList};t.prototype.getColumnIndex=function(e,t){var i=t?t:this.dataService.getList(null,this.columnDataKey);return i?i.indexOf(e):-1};t.prototype.getColumnRealIndex=function(e){var t=this.dataService.getList(null,this.columnDataKey);return e>=0&&e<t.length&&e<this.currentColumnList.length?t.indexOf(this.currentColumnList[e].data):-1};t.prototype.getPrevColumnIndex=function(e,t){var i=t?t:this.dataService.getList(null,this.columnDataKey),o=i?i.indexOf(e):-1;return o>0?o-1:-1};t.prototype.getPrevFlatColumn=function(e,t,i){var o=this,r=null,l=this.getCurrentColumnList(t),s=l.filter(function(t){return t[o.options.columnFields.pid]==e[o.options.columnFields.pid]}),n=s?s.indexOf(e):-1;n=n>0?n-1:-1;if(i&&n>=0)r=this.isColumnWidthFixed(l[n])?this.getPrevFlatColumn(l[n],t,i):l[n];else if(n>=0)r=l[n];return r};t.prototype.getPrevFlatColumnIndex=function(e,t,i){var o=this.getPrevFlatColumn(e,t,i);return o?this.getColumnIndexFromList(o):-1};t.prototype.getNextColumnIndex=function(e,t){var i=t?t:this.dataService.getList(null,this.columnDataKey),o=i?i.indexOf(e):-1;return i&&o<i.length-1?o+1:i.length-1};t.prototype.getNextFlatColumn=function(e,t,i){var o=this,r=null,l=this.getCurrentColumnList(t),s=l.filter(function(t){return t[o.options.columnFields.pid]==e[o.options.columnFields.pid]}),n=s?s.indexOf(e):-1;n=s&&n<s.length-1?n+1:-1;if(i&&n>=0)r=this.isColumnWidthFixed(l[n])?this.getNextFlatColumn(l[n],t,i):l[n];else if(n>=0)r=l[n];return r};t.prototype.getNextFlatColumnIndex=function(e,t,i){var o=this.getNextFlatColumn(e,t,i);return o?this.getColumnIndexFromList(o):-1};t.prototype.getLastColumnIndex=function(e){var t=e?e:this.dataService.getList(null,this.columnDataKey);return t?t.length-1:-1};t.prototype.getColumnWidth=function(e,t){var i=this.options.columnFields.width,o=100;switch(t){case"min":i=this.options.columnFields.minWidth;o=e&&void 0!=e[i]?e[i]:0;return this.isThereChildColumns(e,!0)?this.getColumnWidthFromChildren(e):o;case"max":i=this.options.columnFields.maxWidth;o=e&&void 0!=e[i]?e[i]:9999999;return this.isThereChildColumns(e,!0)?this.getColumnWidthFromChildren(e):o}return e&&void 0!=e[i]?e[i]:100};t.prototype.getColumnWidthFromChildren=function(e){var t=100;if(e){var i=0,o=this.options.columnFields.width,r=0;if(this.isThereChildColumns(e)){for(var l=e[this.options.columnFields.columns],s=0;s<l.length;s++){i=void 0!=l[s][o]?l[s][o]:100;r+=(this.isThereChildColumns(l[s])?this.getColumnWidthFromChildren(l[s]):i)+10}t=r-10}else t=void 0!=e[o]?e[o]:100}return t};t.prototype.getMinColumnWidthFromChildren=function(e){var t=e[this.options.columnFields.columns];return t&&t.length>0?10*(t.length-1):0};t.prototype.setColumnWidth=function(e,t,i){if(e&&(i||1!=e[this.options.columnFields.fixedWidth])){var o=Math.max(this.getColumnWidth(e,"min"),this.getMinColumnWidthFromChildren(e)),r=this.getColumnWidth(e,"max"),l=Math.min(r,Math.max(o,t));e[this.options.columnFields.width]=l>0?l:0}};t.prototype.getPrevColumn=function(e,t){var i=null,o=this.getColumnIndexFromList(e)-1;if(o>=0)for(var r=this.getCurrentColumnList(e[this.options.columnFields.fixed]),l=o;l>=0;l--){var s=this.getColumnWidth(r[l]),n=this.getColumnWidth(r[l],"min"),a=t?!0:s>n;if(!this.isColumnWidthFixed(r[l])&&a){i=r[l];break}}return i};t.prototype.getExpandingColumn=function(){var e=this.dataService.getList(null,this.columnDataKey);return this.expandColIndex>=0&&this.expandColIndex<e.length?e[this.expandColIndex]:null};t.prototype.updateExpandingColumnID=function(){var e=this.getExpandingColumn();if(e)this.currentExpandColumnID=e[this.options.columnFields.id]};t.prototype.getFilterTree=function(e){for(var t=null,i=this.getCurrentColumnList(e[this.options.columnFields.fixed]),o=0;o<i.length;o++)if(i[o]==e){t=i[o].filter;break}return t};t.prototype.getCurrentList=function(){for(var e=[],t=0;t<this.currentRowList.length;t++)e.push(this.currentRowList[t].data);return e};t.prototype.getList=function(e,t){switch(e){case"current":return this.getCurrentList();case"selected":return this.currentSelectedRows}return this.dataService.getList(t,this.rowDataKey)};t.prototype.getFullList=function(){return[]};t.prototype.getTopRow=function(){return this.scrollRowList.length>0?this.scrollRowList[0].data:null};t.prototype.getObjFromRow=function(e){for(var t=null,i=0;i<this.currentRowList.length;i++)if(this.currentRowList[i].data==e){t=this.currentRowList[i];break}return t};t.prototype.createScrollObjFromRow=function(e,t,i){return null};t.prototype.getObjIndexFromScrollList=function(e,t){var i=-1,o=this.scrollRowList;switch(t){case"left":o=this.scrollLeftRowList;break;case"right":o=this.scrollRightRowList}for(var r=0;r<o.length;r++)if(o[r].data==e){i=r;break}return i};t.prototype.getObjFromScrollList=function(e,t){var i=this.scrollRowList;switch(t){case"left":i=this.scrollLeftRowList;break;case"right":i=this.scrollRightRowList}var o=this.getObjIndexFromScrollList(e,t);return this.isIndexInRange(o,i)?i[o]:null};t.prototype.getRowCurrentIndex=function(e){if(e){var t=this.getObjFromRow(e);return t&&this.currentRowList?this.currentRowList.indexOf(t):-1}return-1};t.prototype.getRowIndent=function(e,t,i){var o=this.columnPadding.left;if(this.isExpandBoxAllowed(t))o+=e.indent;return o};t.prototype.getRowLevel=function(e){return 0};t.prototype.getRowList=function(e){switch(e){case"left":return this.scrollLeftRowList;case"right":return this.scrollRightRowList}return this.scrollRowList};t.prototype.getRowFromComponent=function(e){return null};t.prototype.getRowScrollIndex=function(e){for(var t=-1,i=0;i<this.scrollRowList.length;i++)if(this.scrollRowList[i].data==e){t=i;break}return t};t.prototype.isChildOf=function(e,t){return!1};t.prototype.isColumnExpanded=function(e){return e?e[this.options.columnFields.expanded]||void 0===e[this.options.columnFields.expanded]?!0:!1:!0};t.prototype.isColumnFixed=function(e,t){if(t)return e[this.options.columnFields.fixed]==t;else return e&&("left"==e[this.options.columnFields.fixed]||"right"==e[this.options.columnFields.fixed])?!0:!1};t.prototype.isColumnVisible=function(e){return e&&0!=e[this.options.columnFields.visible]?!0:!1};t.prototype.isColumnWidthFixed=function(e){return 1==e[this.options.columnFields.fixedWidth]?!0:e[this.options.columnFields.columns]&&e[this.options.columnFields.columns].length>0?this.areChildColumnsFixed(e[this.options.columnFields.columns]):!1};t.prototype.isComponentIndexInRange=function(e){return this.rowList?e>=0&&e<this.rowList.length:!1};t.prototype.isContentAllowed=function(e,t){var i=this.rowContentVisibility==integralui_core_1.IntegralUIContentVisibility.Both;switch(t){case"hover":i=(i&&(!this.isSelectedTemplatePresent||!e[this.options.rowFields.selected])||this.rowContentVisibility==integralui_core_1.IntegralUIContentVisibility.Hover)&&(void 0==e[this.options.rowFields.contentVisibility]||e[this.options.rowFields.contentVisibility]==integralui_core_1.IntegralUIContentVisibility.Hover||e[this.options.rowFields.contentVisibility]==integralui_core_1.IntegralUIContentVisibility.Both);break;case"select":i=(i||this.rowContentVisibility==integralui_core_1.IntegralUIContentVisibility.Select)&&(void 0==e[this.options.rowFields.contentVisibility]||e[this.options.rowFields.contentVisibility]==integralui_core_1.IntegralUIContentVisibility.Select||e[this.options.rowFields.contentVisibility]==integralui_core_1.IntegralUIContentVisibility.Both)}return i};t.prototype.isExpandBoxAllowed=function(e){return e?this.getColumnIndex(e)==this.expandColIndex:!1};t.prototype.isIndexInRange=function(e,t){return t?e>=0&&e<t.length:!1};t.prototype.isRowAllowed=function(e,t){if(0==e[this.options.rowFields.visible])return!1;else if(0==this.options.allowFilter)return!0;var i=!0;if(e)for(var o=-1,r=null,l=null,s=0;s<e[this.options.rowFields.cells].length;s++){i=!0;o=(l=e[this.options.rowFields.cells][s])[this.options.cellFields.cid];if(!(r=this.getColumnById(o))&&s<this.flatCurrentColumnList.length)r=this.flatCurrentColumnList[s].data;if(r&&r[this.options.columnFields.filterParams]){var n=r[this.options.columnFields.filterParams],a=l[this.options.cellFields.value]?l[this.options.cellFields.value]:l[this.options.cellFields.text];if(n)if(n.callback)i=n.callback(a,l,e);else if(!(i=this.filterService.match(a,n.conditions,n.formula,this.getFilterTree(r),n.caseSensitive))&&n.allowParent)i=this.filterIsThereChildren(e,t)}if(!i)break}return i};t.prototype.filterIsThereChildren=function(e,t){var i=!1,o=e[this.options.rowFields.rows];if(o)for(var r=0;r<o.length&&!(i=this.isRowAllowed(o[r],t));r++);return i};t.prototype.isRowEnabled=function(e){return!0};t.prototype.isRowFixed=function(e){return!1};t.prototype.isRowHovered=function(e){return!this.isDragActive&&!this.isScrollTimerActive&&e&&e==this.hoverRow?!0:!1};t.prototype.isRowSelected=function(e){return e&&1==e[this.options.rowFields.selected]?!0:!1};t.prototype.isParentOf=function(e,t){return!1};t.prototype.isThereFixedColumns=function(e){switch(e){case"left":return this.currentLeftColumnList.length>0;case"right":return this.currentRightColumnList.length>0}return!1};t.prototype.processStateChanged=function(){};t.prototype.updateExpandStatus=function(){};t.prototype.resetHoverRowObj=function(){this.hoverRowObj={data:{}}};t.prototype.getSelectBlockRect=function(e){var t={left:0,top:"-9999999px",height:0,width:0};if(e<this.blockSelectRect.length)t={left:this.blockSelectRect[e].left+"px",top:this.blockSelectRect[e].top+"px",height:this.blockSelectRect[e].height+"px",width:this.blockSelectRect[e].width+"px"};return t};t.prototype.hoverBlockMouseMove=function(e){if(this.isEnabled&&!this.isScrollActive&&!this.isColumnResizing&&!this.columnReorderActive&&!this.hoverRow)this.rowMouseEnter(e,this.hoverRowObj)};t.prototype.hoverBlockMouseLeave=function(e){if(this.isEnabled&&!this.isScrollActive&&!this.isColumnResizing&&!this.columnReorderActive)this.rowMouseLeave(e,this.hoverRowObj)};t.prototype.rowMouseEnter=function(e,t){};t.prototype.rowMouseLeave=function(e,t){};t.prototype.getParentColumnList=function(e){var t=this,i=[];if(e&&e[this.options.columnFields.pid]){var o=this.getCurrentColumnList(e[this.options.columnFields.fixed]).filter(function(i){return i[t.options.columnFields.id]==e[t.options.columnFields.pid]}),r=o.length>0?o[0]:null;if(r&&r[this.options.columnFields.columns]&&r[this.options.columnFields.columns].length>0)i=r[this.options.columnFields.columns]}else i=this.dataService.getList(null,this.columnDataKey);return i};t.prototype.moveColumn=function(e,t,i,o){if(e){if(t!=integralui_core_1.IntegralUIMoveDirection.Left&&t!=integralui_core_1.IntegralUIMoveDirection.Right){var r=this.getParentColumnList(e);if(r){var l=r.indexOf(e);l>=0&&r.splice(l,1)}}var s=-1,n=this.getParentColumnList(i);switch(t){case integralui_core_1.IntegralUIMoveDirection.After:s=i?this.getNextColumnIndex(i,n):-1;break;case integralui_core_1.IntegralUIMoveDirection.At:s=o;break;case integralui_core_1.IntegralUIMoveDirection.Before:s=i?this.getColumnIndex(i,n):-1;break;case integralui_core_1.IntegralUIMoveDirection.First:s=0;break;case integralui_core_1.IntegralUIMoveDirection.Last:s=this.getLastColumnIndex(n)+1;break;case integralui_core_1.IntegralUIMoveDirection.Left:s=this.getPrevColumnIndex(e,n);break;case integralui_core_1.IntegralUIMoveDirection.Right:s=this.getNextColumnIndex(e,n)}if(n&&s>=0){this.allowUpdate=!1;if(t!=integralui_core_1.IntegralUIMoveDirection.Left&&t!=integralui_core_1.IntegralUIMoveDirection.Right)n.splice(s,0,e);else if(s<n.length){var a=n.indexOf(e);this.moveObject(a,s,n)}this.allowUpdate=!0;this.columnOrderChanged.emit({column:e});this.updateLayout()}}};t.prototype.paginatorMouseEnter=function(e){this.blockHoverRect.top=-9999999};t.prototype.scrollMouseEnter=function(e){this.blockHoverRect.top=-9999999};t.prototype.cellGotFocus=function(e){if(this.isEnabled)this.refresh()};t.prototype.cellLostFocus=function(e){if(this.isEnabled)this.refresh()};t.prototype.onContentScroll=function(e){e.srcElement.scrollTop=0;e.srcElement.scrollLeft=0;e.target.scrollTop=0;e.target.scrollLeft=0};t.prototype.onGridScroll=function(e){e.srcElement.scrollTop=0;e.srcElement.scrollLeft=0;e.target.scrollTop=0;e.target.scrollLeft=0};t.prototype.cellMouseEnter=function(e,t){if(this.isEnabled){this.cellHover.emit({cell:t.data});this.hoverCell=t}};t.prototype.cellMouseLeave=function(e){this.hoverCell=null};t.prototype.cellMouseDown=function(e,t){if(this.isEnabled&&1==e.which){this.clickedCell=t;this.currentFocusCell=t;if(t.editorType)switch(t.editorType){case integralui_core_1.IntegralUIEditorType.CheckBox:this.editCheckBoxValue(t)}}};t.prototype.cellMouseUp=function(e,t,i,o,r){if(1==e.which&&t.isEditorEnabled&&t.isEditorVisible&&this.clickedCell==t)switch(t.editorType){case integralui_core_1.IntegralUIEditorType.Color:case integralui_core_1.IntegralUIEditorType.Date:case integralui_core_1.IntegralUIEditorType.DropList:this.openDropDown(e,t,i,o,r);break;case integralui_core_1.IntegralUIEditorType.Numeric:this.openEditor(e,t,"numeric");break;case integralui_core_1.IntegralUIEditorType.TextBox:this.openEditor(e,t)}this.clickedCell=null};t.prototype.cellTouchEnd=function(e,t,i,o,r){if(t.isEditorEnabled&&t.isEditorVisible)switch(t.editorType){case integralui_core_1.IntegralUIEditorType.CheckBox:this.editCheckBoxValue(t);break;case integralui_core_1.IntegralUIEditorType.Color:case integralui_core_1.IntegralUIEditorType.Date:case integralui_core_1.IntegralUIEditorType.DropList:this.openDropDown(e,t,i,o,r);break;case integralui_core_1.IntegralUIEditorType.Numeric:this.openEditor(e,t,"numeric");break;case integralui_core_1.IntegralUIEditorType.TextBox:this.openEditor(e,t)}};t.prototype.openDropDown=function(e,t,i,o,r){};t.prototype.cellKeyDown=function(e,t){if(this.isEnabled){var i={cancel:!1,cell:t.data,event:e};this.keyDown.emit(i);switch(e.keyCode){case 9:break;case 13:this.beforeEdit.emit(i);break;case 27:break;case 33:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processPageUpKey(t)}break;case 34:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processPageDownKey(t)}break;case 35:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processEndKey(t)}break;case 36:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processHomeKey(t)}break;case 37:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processLeftArrowKey(t)}break;case 32:break;case 38:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processUpArrowKey(t)}break;case 39:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processRightArrowKey(t)}break;case 40:if(!i.cancel&&this.options.allowFocus){e.preventDefault();this.isKeyboardActive=!0;this.processDownArrowKey(t)}}}this.isKeyPressed=!0};t.prototype.cellKeyPress=function(e,t){var i={cancel:!1,cell:t.data,event:e};if(this.isEnabled)this.keyPress.emit(i)};t.prototype.cellKeyUp=function(e,t){var i={cancel:!1,cell:t.data,event:e};if(this.isEnabled)this.keyUp.emit(i);this.isKeyPressed=!1};t.prototype.isCellFocused=function(e){return this.currentFocusCell?e.data==this.currentFocusCell.data:!1};t.prototype.processDownArrowKey=function(e,t){var i=this.isKeyPressed?this.currentFocusCell:e,o=this.getDownCell(i);if(o&&!o.isEmpty){this.updateFocusCell(o);var r=this.getRowFromCell(o);if(r){var l=r.data;this.processRowSelection(t,l);if(this.isLastRow(o)){this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y+2*this.avgRowHeight});this.currentFocusCell.rowIndex-=2}this.refresh()}}return o&&!o.isEmpty?o:null};t.prototype.processEndKey=function(e,t){var i=null;if(this.scrollRowList.length>0){this.scrollPos({x:this.currentScrollPos.x,y:this.maxScrollPos.y});var o=this;setTimeout(function(){if(o.visibleRange<=o.scrollRowList.length){var r=o.getLastScrollIndex();if(r>=0){var l=o.scrollRowList[r];if(l&&l.cells&&e.colIndex>=0&&e.colIndex<l.cells.length){i=l.cells[e.colIndex];o.updateFocusCell(i);o.processRowSelection(t,l.data)}}}},1)}return i};t.prototype.processHomeKey=function(e,t){var i=null;if(this.scrollRowList.length>0){this.scrollPos({x:this.currentScrollPos.x,y:0});var o=this;setTimeout(function(){var r=o.scrollRowList[0];if(r)if(r&&r.cells&&e.colIndex>=0&&e.colIndex<r.cells.length){i=r.cells[e.colIndex];o.updateFocusCell(i);o.processRowSelection(t,r.data)}},1)}return i};t.prototype.processLeftArrowKey=function(e){var t=this.isKeyPressed?this.currentFocusCell:e,i=this.getPrevCell(t);if(i&&!i.isEmpty){this.updateFocusCell(i);if(this.isFirstCell(i))this.scrollPos({x:this.currentScrollPos.x-2*i.width,y:this.currentScrollPos.y});var o=this;setTimeout(function(){o.refresh()},1)}return i&&!i.isEmpty?i:null};t.prototype.processPageDownKey=function(e,t){var i=null,o=this;if(this.scrollRowList.length>0){o.scrollPos({x:o.currentScrollPos.x,y:o.currentScrollPos.y+o.avgRowHeight*(o.visibleRange-1)});setTimeout(function(){var r=e.rowIndex>=0&&e.rowIndex<o.visibleRange?e.rowIndex:o.visibleRange-1;if(o.currentScrollPos.y==o.maxScrollPos.y)r=o.getLastScrollIndex();if(r>=0){var l=o.scrollRowList[r];if(l&&l.cells&&e.colIndex>=0&&e.colIndex<l.cells.length){i=l.cells[e.colIndex];o.updateFocusCell(i);o.processRowSelection(t,l.data)}}},1)}return i};t.prototype.processPageUpKey=function(e,t){var i=null,o=this;if(o.scrollRowList.length>0){o.scrollPos({x:o.currentScrollPos.x,y:o.currentScrollPos.y-o.avgRowHeight*(o.visibleRange-1)});setTimeout(function(){var r=e.rowIndex>=0&&e.rowIndex<o.visibleRange?e.rowIndex:0;if(0==o.currentScrollPos.y)r=0;var l=o.scrollRowList[r];if(l&&l.cells&&e.colIndex>=0&&e.colIndex<l.cells.length){i=l.cells[e.colIndex];o.updateFocusCell(i);o.processRowSelection(t,l.data)}},1)}return i};t.prototype.processRightArrowKey=function(e){var t=this.isKeyPressed?this.currentFocusCell:e,i=this.getNextCell(t);if(i&&!i.isEmpty){this.updateFocusCell(i);if(this.isLastCell(i))this.scrollPos({x:this.currentScrollPos.x+2*i.width,y:this.currentScrollPos.y});else if(i.colIndex>=this.flatCurrentColumnList.length-2)this.scrollPos({x:this.maxScrollPos.x,y:this.currentScrollPos.y});var o=this;setTimeout(function(){o.refresh()},1)}return i&&!i.isEmpty?i:null};t.prototype.processUpArrowKey=function(e,t){var i=this.getUpCell(e);if(i&&!i.isEmpty){this.updateFocusCell(i);var o=this.getRowFromCell(i);if(o){var r=o.data;this.processRowSelection(t,r);if(this.isFirstRow(i)){this.scrollPos({x:this.currentScrollPos.x,y:this.currentScrollPos.y-this.avgRowHeight});this.currentFocusCell.rowIndex++}}}return i&&!i.isEmpty?i:null};t.prototype.getDownCell=function(e){if(e&&e.rowIndex>=0&&e.rowIndex<this.scrollRowList.length){this.scrollRowList[e.rowIndex];var t=e.rowIndex<this.scrollRowList.length-1?e.rowIndex+1:-1,i=t>=0?this.scrollRowList[t]:null;return i&&e.colIndex>=0&&e.colIndex<i.cells.length?i.cells[e.colIndex]:null}return null};t.prototype.getNextCell=function(e){if(e&&e.rowIndex>=0&&e.rowIndex<this.scrollRowList.length){var t=this.scrollRowList[e.rowIndex],i=e.colIndex,o=i>=0&&i<this.viewIndexRange.middle&&i<t.cells.length-1?i+1:this.viewIndexRange.middle-this.viewIndexRange.left;return o>=0?t.cells[o]:null}return null};t.prototype.getLastScrollIndex=function(){for(var e=0,t=0;t<this.scrollRowList.length;t++)if(this.scrollRowList[t].isEmpty){e=t-1;break}return e};t.prototype.getPrevCell=function(e){if(e&&e.rowIndex>=0&&e.rowIndex<this.scrollRowList.length){var t=this.scrollRowList[e.rowIndex],i=e.colIndex,o=i>0&&i<t.cells.length?i-1:0;return o>=0?t.cells[o]:null}return null};t.prototype.getUpCell=function(e){if(e&&e.rowIndex>=0&&e.rowIndex<this.scrollRowList.length){this.scrollRowList[e.rowIndex];var t=e.rowIndex>0?e.rowIndex-1:-1,i=t>=0?this.scrollRowList[t]:null;return i&&e.colIndex>=0&&e.colIndex<i.cells.length?i.cells[e.colIndex]:null}return null};t.prototype.isFirstCell=function(e){return 0==e.colIndex?!0:!1};t.prototype.isFirstRow=function(e){return 0==e.rowIndex?!0:!1};t.prototype.isLastCell=function(e){return e.colIndex==this.viewIndexRange.middle-this.viewIndexRange.left?!0:!1};t.prototype.isLastRow=function(e){return e.rowIndex==this.visibleRange-2?!0:!1};t.prototype.getRowFromCell=function(e){return e.rowIndex>=0&&e.rowIndex<this.scrollRowList.length?this.scrollRowList[e.rowIndex]:null};t.prototype.moveFocusFromCell=function(e,t){if(!this.options.allowFocus)return null;var i=null,o=this.getObjFromCell(e);if(o)switch(t){case"down":i=this.processDownArrowKey(o);break;case"end":i=this.processEndKey(o);break;case"home":i=this.processHomeKey(o);break;case"left":i=this.processLeftArrowKey(o);break;case"pagedown":i=this.processPageDownKey(o);break;case"pageup":i=this.processPageUpKey(o);break;case"right":i=this.processRightArrowKey(o);break;case"up":i=this.processUpArrowKey(o)}return i?i.data:null};t.prototype.getObjFromCell=function(e){for(var t=null,i=0;i<this.scrollRowList.length;i++)for(var o=this.scrollRowList[i],r=0;r<o.cells.length;r++){var l=o.cells[r];if(l.data==e){t=l;break}}return t};t.prototype.updateFocusCell=function(e){if(e){this.currentFocusCell={};this.currentFocusCell.isEmpty=!1;this.currentFocusCell.data=e.data;this.currentFocusCell.colIndex=e.colIndex;this.currentFocusCell.rowIndex=e.rowIndex}else this.currentFocusCell=null};t.prototype.onWindowKeyDown=function(e){if(this.isEnabled&&this.isKeyboardActive)e.preventDefault();if(this.isDragActive&&27==e.keyCode){this.dropMark(e);this.clearDragDropSettings();if(this.dragMode==integralui_core_1.IntegralUIDragDropDisplayMode.Handle)this.updateScrollRowList()}};t.prototype.onWindowKeyUp=function(e){this.isKeyboardActive=!1};t.prototype.checkForSelectionChange=function(){var e=this;if(this.currentSelectedRows.length>0){var t=this.getFullList(),i=[];this.currentSelectedRows.map(function(o){if(0==t.filter(function(t){return e.commonService.isEqual(t[e.options.rowFields.id],o[e.options.rowFields.id])}).length)i.push(o)});if(i.length>0){var o=[];i.map(function(t){t[e.options.rowFields.selected]=!1;o.push(e.currentSelectedRows.indexOf(t))});if(this.currentSelectedRow&&i.filter(function(t){return e.commonService.isEqual(e.currentSelectedRow[e.options.rowFields.id],t[e.options.rowFields.id])}).length>0)this.currentSelectedRow=null;for(var r=o.length-1;r>=0;r--)this.currentSelectedRows.splice(o[r],1);this.selectionChanged.emit({row:this.currentSelectedRow})}}};t.prototype.getContentSize=function(){return{width:0,height:0}};t.prototype.refresh=function(e){this.clearComponentSelection();for(var t=0;t<this.currentSelectedRows.length;t++){var i=this.getRowCurrentIndex(this.currentSelectedRows[t]);if(this.isComponentIndexInRange(i))this.rowList[i].state|=integralui_core_1.IntegralUIObjectState.selected}};t.prototype.suspendLayout=function(){this.allowUpdate=!1};t.prototype.resumeLayout=function(){this.allowUpdate=!0;this.updateLayout()};t.prototype.updateCurrentLayout=function(){};t.prototype.updateLayout=function(){};t.prototype.isThereChildColumns=function(e,t){var i=this.options.columnFields.columns;return t?this.areChildColumnsFixed(e[i]):e[i]&&e[i].length>0?!0:!1};t.prototype.areChildColumnsFixed=function(e){if(e&&e.length>0){for(var t=0,i=0;i<e.length;i++)if(1==e[i][this.options.columnFields.fixedWidth]||this.areChildColumnsFixed(e[i][this.options.columnFields.columns]))t++;return t==e.length?!0:!1}return!1};t.prototype.updateColumnWidth=function(e){if(this.isAutoSizeColumnsActive){for(var t=0,i=0,o=0,r=[],l=!1,s=0;s<this.currentColumnList.length;s++)if((t=(l=this.isThereChildColumns(this.currentColumnList[s].data))?this.calcColumnWidthFromChildren(this.currentColumnList[s].data):this.getColumnWidth(this.currentColumnList[s].data))>=this.getColumnWidth(this.currentColumnList[s].data,"min")){i+=t+this.columnPadding.left+this.columnPadding.right+6;if(1!=this.isColumnWidthFixed(this.currentColumnList[s].data)){o++;r.push(this.currentColumnList[s])}else if(l){this.setColumnWidth(this.currentColumnList[s].data,t,!0);this.updateCellWidth(this.currentColumnList[s].data)}}if(o>0){var n=this.isVerScrollVisible()?20:0,a=(this.clientRect.width-n-i)/o;this.updateColumnWidthByFactor(r,a)}}else if(e)this.changeColumnWidth(e);else for(s=0;s<this.currentColumnList.length;s++){e=this.currentColumnList[s].data;this.changeColumnWidth(e)}};t.prototype.changeColumnWidth=function(e){var t=this.getColumnWidth(e),i=this.isThereChildColumns(e)?this.calcColumnWidthFromChildren(e):t;if(i!=t){this.setColumnWidth(e,i);this.updateCellWidth(e)}};t.prototype.calcColumnWidthFromChildren=function(e){for(var t=0,i=0,o=0,r=e[this.options.columnFields.columns],l=0;l<r.length;l++){t=this.getColumnWidth(r[l]);if((i=this.isThereChildColumns(r[l])?this.calcColumnWidthFromChildren(r[l]):t)!=t){this.setColumnWidth(r[l],i);this.updateCellWidth(r[l])}o+=i+10}return o-=10};t.prototype.updateColumnWidthByFactor=function(e,t){var i=0,o=0,r=0,l=0;o=0;for(var s=[],n=0;n<e.length;n++){i=this.isThereChildColumns(e[n].data)?this.calcColumnWidthFromChildren(e[n].data):this.getColumnWidth(e[n].data);l=this.getColumnWidth(e[n].data,"min");if(1==this.isColumnWidthFixed(e[n].data))l=i;if(i>=l)if(i+t<=l){r+=i+t-l;this.setColumnWidth(e[n].data,l);this.updateCellWidth(e[n].data)}else{s.push(e[n]);o++}}if(o>0){var a=r/o;if(0!=a)this.updateColumnWidthByFactor(s,t+a);else for(n=0;n<s.length;n++){i=this.isThereChildColumns(s[n].data)?this.calcColumnWidthFromChildren(s[n].data):this.getColumnWidth(s[n].data);i+=t;this.setColumnWidth(s[n].data,i);this.updateCellWidth(s[n].data);if(i>Math.max(this.getColumnWidth(s[n].data,"min"),this.getMinColumnWidthFromChildren(s[n].data)))this.resizeChildColumns(s[n].data,t)}}};t.prototype.checkWidthChanges=function(){if(this.isAutoSizeColumnsActive){for(var e=0,t=0,i=0;i<this.currentColumnList.length;i++){t=this.getColumnWidth(this.currentColumnList[i].data);this.getColumnWidth(this.currentColumnList[i].data,"min");e+=t+this.columnPadding.left+this.columnPadding.right+6}var o=this.isVerScrollVisible()?20:0,r=this.clientRect.width-o-e-2;if(r>0)for(i=this.currentColumnList.length-1;i>=0;i--){var l=this.currentColumnList[i].data;if(!this.isColumnWidthFixed(l)){t=this.getColumnWidth(l)+r;this.setColumnWidth(l.data,t);this.updateCellWidth(l.data);break}}}};t.prototype.updateCellWidth=function(e){if(e)for(var t=this.getRowList(e[this.options.columnFields.fixed]),i=0;i<t.length;i++)for(var o=t[i],r=this.isColumnFixed(e),l=this.getColumnCurrentIndex(e),s=r?l:l-this.viewIndexRange.left,n=0;n<o.cells.length;n++)if(o.cells[n].colIndex==s){var a=this.getCellWidth(o,e);if(this.getColumnIndex(e)==this.expandColIndex){var c=this.getColumnWidth(e);c=c>0?c:this.columnPadding.left;if(0==a)o.cells[n].indent=c;else o.cells[n].indent=this.getRowIndent(o,e)}o.cells[n].width=a;break}};t.prototype.updateChildColumnsWidth=function(e,t,i){if(t>Math.max(this.getColumnWidth(e,"min"),this.getMinColumnWidthFromChildren(e))){this.resizeChildColumns(e,i);this.resizeParentColumn(e,i)}};t.prototype.resizeChildColumns=function(e,t){var i=this,o=e[this.options.columnFields.columns];if(o&&o.length>0){var r=o.filter(function(e){var o=i.getColumnWidth(e);return i.isColumnWidthFixed(e)||t<0&&0==o?!0:!1}).length;t=o.length>r?t/(o.length-r):0;o.filter(function(e){return!i.isColumnWidthFixed(e)}).map(function(e){i.updateWidthByFactor(e,t);i.resizeChildColumns(e,t)})}};t.prototype.resizeParentColumn=function(e,t){var i=this;if(e[this.options.columnFields.pid]){var o=[];switch(e[this.options.columnFields.fixed]){case"left":o=this.flatCurrentLeftColumnList;break;case"right":o=this.flatCurrentRightColumnList;break;default:o=this.flatCurrentColumnList}var r=o.filter(function(t){return t[i.options.columnFields.id]==e[i.options.columnFields.pid]}),l=r.length>0?r[0]:null;if(l){this.updateWidthByFactor(l,t);this.resizeParentColumn(l,t)}}};t.prototype.updateWidthByFactor=function(e,t){var i=this.getColumnWidth(e);this.isColumnFixed(e,"right")?i-=t:i+=t;i=Math.max(0,i);this.setColumnWidth(e,i);this.updateCellWidth(e)};t.prototype.updateRange=function(){};t.prototype.getBlockBottomPos=function(){var e=this.isHorScrollVisible()?16:0;if(this.isPaginationEnabled())e+=this.paginatorHeight;return e};t.prototype.getBlockRightPos=function(){return this.isVerScrollVisible()?16:0};t.prototype.onCtrlMouseEnter=function(e){if(this.isEnabled&&1==e.buttons&&this.cloneElem)this.cloneElem.style.display="block";this.elemRenderer.setStyle(this.elemRef.nativeElement,"cursor","default")};t.prototype.onCtrlMouseLeave=function(e){if(this.isEnabled&&1==e.buttons&&this.cloneElem)this.cloneElem.style.display="none";this.stopScrollTimer()};t.prototype.currentPage=function(e){if(this.currentPageNumber!=e&&e>=1&&e<=this.pageList.length){this.currentPageNumber=e;this.updateCurrentLayout()}return this.currentPageNumber};t.prototype.getMaxPages=function(){return this.pageList?this.pageList.length:0};t.prototype.firstPage=function(){if(1!=this.currentPageNumber){this.currentPageNumber=1;this.updateCurrentLayout()}};t.prototype.lastPage=function(){if(this.currentPageNumber!=this.pageList.length){this.currentPageNumber=this.pageList.length;this.updateCurrentLayout()}};t.prototype.nextPage=function(){if(this.currentPageNumber<this.pageList.length){this.currentPageNumber++;this.updateCurrentLayout()}};t.prototype.prevPage=function(){if(this.currentPageNumber>1){this.currentPageNumber--;this.updateCurrentLayout()}};t.prototype.resetPageNumber=function(){this.currentPageNumber=1};t.prototype.updatePageNumber=function(){if(this.currentPageNumber>this.pageList.length)if(0==this.pageList.length)this.resetPageNumber();else this.currentPageNumber=this.pageList.length};t.prototype.updatePaging=function(e){if(e)this.options.paging={enabled:this.commonService.isFieldAvailable(e.enabled,!1),showControlPanel:this.commonService.isFieldAvailable(e.showControlPanel,!0),pageSize:this.commonService.isFieldAvailable(e.pageSize,100)};else this.options.paging={enabled:!1,showControlPanel:!0,pageSize:100}};t.prototype.paginatorPageChanged=function(e){this.currentPageNumber=e.value;this.updateCurrentLayout();this.pageChanged.emit({page:this.currentPageNumber,maxPages:this.getMaxPages(),pageSize:this.options.paging.pageSize})};t.prototype.isPaginationEnabled=function(){return this.options.paging.enabled&&this.options.paging.showControlPanel};t.prototype.getColumnOpacity=function(e){return 1};t.prototype.updateOrignalScrollColumnList=function(){this.originalScrollColumnList.length=0;if(this.scrollColumnList.length>0)for(var e=0;e<this.scrollColumnList[0].columns.length;e++)this.originalScrollColumnList.push(this.scrollColumnList[0].columns[e])};t.prototype.updateReorderColumnPos=function(){if(this.reorderColumn){for(var e=0,t=0;t<this.originalScrollColumnList.length&&this.originalScrollColumnList[t]!=this.reorderColumnObj;t++)e+=this.getColumnWidth(this.originalScrollColumnList[t].data)+this.columnPadding.left+this.columnPadding.right+6;this.reorderColumnObjPos.left=e+this.reorderColumnCurrentPos.left-this.reorderColumnStartPos.left;var i=this.getHeaderRect();this.reorderColIndex=this.getColumnIndexFromScrollList(this.reorderColumn);this.reorderNewColIndex=this.reorderColIndex;e=0;for(t=0;t<this.originalScrollColumnList.length;t++){e;e+=this.getColumnWidth(this.originalScrollColumnList[t].data)+this.columnPadding.left+this.columnPadding.right+6;if(0!=this.originalScrollColumnList[t].data[this.options.columnFields.allowDrop]&&this.reorderColumnCurrentPos.left-i.left<e){this.reorderNewColIndex=t;break}}if(this.reorderColIndex!=this.reorderNewColIndex)this.moveObject(this.reorderColIndex,this.reorderNewColIndex,this.scrollColumnList)}};t.prototype.getHeaderRect=function(){return{top:0,right:0,bottom:0,left:0,height:0,width:0,x:0,y:0}};t.prototype.resetReorderColumnSettings=function(){this.reorderColumnObj=null;this.reorderColumn=null;this.columnReorderActive=!1;this.startColumnReorder=!1};t.prototype.restoreColumnOrder=function(){if(this.originalScrollColumnList.length>0){this.scrollColumnList.length=0;for(var e=0;e<this.originalScrollColumnList.length;e++)this.scrollColumnList.push(this.originalScrollColumnList[e])}};t.prototype.getColumnIndexFromScrollList=function(e){for(var t=-1,i=0;i<this.scrollColumnList.length;i++)if(this.scrollColumnList[i].data==e){t=i;break}return t};t.prototype.moveObject=function(e,t,i){if(this.isIndexInRange(e,i)&&this.isIndexInRange(t,i))i.splice(t,0,i.splice(e,1)[0])};t.prototype.scrollPos=function(e){if(e){this.currentScrollPos={x:Math.max(0,Math.min(e.x,this.maxScrollPos.x)),y:Math.max(0,Math.min(e.y,this.maxScrollPos.y))};this.currentIndex=this.avgRowHeight>0?Math.floor(this.currentScrollPos.y/this.avgRowHeight):0}return{x:Math.floor(this.currentScrollPos.x),y:Math.floor(this.currentScrollPos.y)}};t.prototype.changeHorizontalScrollPos=function(e){this.blockHoverRect.top=-9999999;this.currentScrollPos.x=Math.max(0,Math.min(e,this.maxScrollPos.x));if(this.currentScrollPos.x!=this.prevScrollPos.x){this.updateRange();this.scrollPosChanged.emit({value:this.scrollPos()});this.prevScrollPos.x=this.currentScrollPos.x}};t.prototype.changeVerticalScrollPos=function(e){this.blockHoverRect.top=-9999999;this.currentScrollPos.y=Math.max(0,Math.min(e,this.maxScrollPos.y));if(this.currentScrollPos.y!=this.prevScrollPos.y){this.updateView();this.scrollPosChanged.emit({value:this.scrollPos()});this.prevScrollPos.y=this.currentScrollPos.y}};t.prototype.gridMouseWheel=function(e){e.preventDefault();this.hideCalendar();this.hideColorPopup();this.hideDropList();if(this.isEnabled){this.hoverRow=null;var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),i=5;switch(this.mouseWheelSpeed){case integralui_core_1.IntegralUISpeedMode.VerySlow:i=15;break;case integralui_core_1.IntegralUISpeedMode.Slow:i=9;break;case integralui_core_1.IntegralUISpeedMode.Fast:i=3;break;case integralui_core_1.IntegralUISpeedMode.VeryFast:i=1}if(this.isVerScrollVisible()){var o=Math.floor(this.clientRect.height/i);if(this.mouseWheelSpeed==integralui_core_1.IntegralUISpeedMode.VerySlow&&this.avgRowHeight>0)o=this.avgRowHeight;var r=this.currentScrollPos.y+o*t*-1;this.changeVerticalScrollPos(r)}}e.stopPropagation()};t.prototype.isVerScrollVisible=function(){return this.isEnabled&&this.options.showScroll.vertical&&this.scrollSize.height>0?!0:!1};t.prototype.isHorScrollVisible=function(){return this.isEnabled&&this.options.showScroll.horizontal&&this.scrollSize.width>0?!0:!1};t.prototype.onVerticalScrollStart=function(e){this.hoverRow=null;this.isScrollActive=!0};t.prototype.onVerticalScrollEnd=function(e){this.isScrollActive=!1};t.prototype.onVerticalScrollChanged=function(e){if(this.currentScrollPos.y!=e.value)this.changeVerticalScrollPos(e.value)};t.prototype.onHorizontalScrollStart=function(e){this.hoverRow=null;this.isScrollActive=!0};t.prototype.onHorizontalScrollEnd=function(e){this.isScrollActive=!1;this.refresh()};t.prototype.onHorizontalScrollChanged=function(e){if(this.currentScrollPos.x!=e.value){this.currentScrollPos.x=e.value;this.scrollPosChanged.emit({value:this.scrollPos()});this.updateRange()}};t.prototype.scrollMouseDown=function(e){this.hideColorPopup()};t.prototype.updateSelectContentPos=function(){};t.prototype.updateView=function(e){this.currentIndex=this.avgRowHeight>0?Math.floor(this.currentScrollPos.y/this.avgRowHeight):0;if(this.currentIndex!=this.prevIndex){this.updateScrollRowList(e);this.updateSelectContentPos();this.prevIndex=this.currentIndex}};t.prototype.processScroll=function(e,t,i){if(this.isEnabled)if(this.isVerScrollVisible()){var o=this.commonService.getShiftPos(),r=this.commonService.getMousePos(e);r.x-=o.x;r.y-=o.y;var l=this.commonService.getPageRect(this.elemRef.nativeElement.firstElementChild),s=t?t:0,n=i?i:0,a=l.top+this.currentHeaderHeight+s+25,c=l.bottom-this.currentFooterHeight-n-25;if(this.isHorScrollVisible())c-=16;if(r.y<a&&this.currentScrollPos.y>0)this.startScrollTimer(!1);else if(r.y>c&&this.currentScrollPos.y<this.maxScrollPos.y)this.startScrollTimer(!0);else this.stopScrollTimer()}else this.stopScrollTimer()};t.prototype.startScrollTimer=function(e,t){var i=this;i.removeDropMark();if(!i.isScrollTimerActive){i.accelerator=.5;i.scrollCount=0;i.isScrollTimerActive=!0;var o=t?t:100;i.scrollTimerID=setInterval(function(){i.scrollTimerElapsed(e)},o)}};t.prototype.stopScrollTimer=function(){if(this.scrollTimerID){clearInterval(this.scrollTimerID);this.scrollTimerID=null}this.accelerator=.5;this.scrollCount=0;this.isScrollTimerActive=!1};t.prototype.scrollTimerElapsed=function(e){var t=this.currentScrollPos;if(0===this.scrollCount)this.scrollCount=5;this.scrollCount+=5;this.accelerator+=.5;this.scrollCount+=Math.floor(this.accelerator);var i=this.scrollCount;if(e)if(this.currentScrollPos.y+i>this.maxScrollPos.y)this.currentScrollPos.y=this.maxScrollPos.y;else this.currentScrollPos.y+=i;else if(this.currentScrollPos.y-i<0)this.currentScrollPos.y=0;else this.currentScrollPos.y-=i;if(t.y<=0||this.currentScrollPos.y<t.y)this.stopScrollTimer()};t.prototype.scrollTo=function(e){if(e){var t=this.getRowCurrentIndex(e);if(t>=0)this.scrollPos({x:this.currentScrollPos.x,y:this.avgRowHeight*(t+1-this.visibleRange/2)});this.updateLayout()}};t.prototype.findRowById=function(e){return this.dataService.findObjectById(e,this.rowDataKey)};t.prototype.findRowByText=function(e){return this.dataService.findObjectByText(e,this.rowDataKey)};t.prototype.clearSelection=function(){this.clearPrevSelection();this.currentSelectedRow=null;this.updateSelectContentPos();this.refresh()};t.prototype.processColumnSelection=function(e,t,i){if(t){if(0==t[this.options.columnFields.canSelect])return;var o=!0;if(this.currentSelectedColumn)o=!this.commonService.isEqual(this.currentSelectedColumn[this.options.columnFields.id],t[this.options.columnFields.id]);var r={cancel:!1,obj:t};this.beforeSelect.emit(r);if(o&&1!=r.cancel){if(this.currentSelectedColumn){this.currentSelectedColumn[this.options.columnFields.selected]=!1;this.refresh(this.currentSelectedColumn)}this.currentSelectedColumn=t;t[this.options.columnFields.selected]=!0;this.refresh(t);this.callAfterSelectEvent(t)}}else return this.currentSelectedColumn};t.prototype.clearComponentSelection=function(){this.rowList.forEach(function(e){return e.state&=~integralui_core_1.IntegralUIObjectState.selected})};t.prototype.clearPrevSelection=function(e){for(var t=0;t<this.currentSelectedRows.length;t++)if(e&&!this.commonService.isEqual(this.currentSelectedRows[t][this.options.rowFields.id],e[this.options.rowFields.id]))this.currentSelectedRows[t][this.options.rowFields.selected]=!1;else if(!e)this.currentSelectedRows[t][this.options.rowFields.selected]=!1;this.currentSelectedRows.length=0;if(e&&this.isRowEnabled(e))this.currentSelectedRows.push(e)};t.prototype.isRowInSelectionList=function(e){var t=!1,i=this.currentSelectedRows;if(e&&i)for(var o=0;o<i.length;o++)if(this.commonService.isEqual(i[o][this.options.rowFields.id],e[this.options.rowFields.id])){t=!0;break}return t};t.prototype.processRowSelection=function(e,t,i){if(t){if(this.selectionMode==integralui_core_1.IntegralUISelectionMode.None||0==t[this.options.rowFields.canSelect])return;var o=this.currentSelectedRows.length>0;if(!this.isRowEnabled(t)){this.clearPrevSelection();this.currentSelectedRow=null;this.refresh();if(o)this.selectionChanged.emit(null)}else{var r=this.currentSelectedRow,l=!0;if(r)l=e&&(e.ctrlKey||e.metaKey)||!this.commonService.isEqual(r[this.options.rowFields.id],t[this.options.rowFields.id])||0==r[this.options.rowFields.selected];var s={cancel:!1,obj:t};this.beforeSelect.emit(s);if(1!=s.cancel){var n=e&&(e.shiftKey||e.ctrlKey||e.metaKey)?!0:!1;if(l){if(this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiExtended)l=!this.isRowInSelectionList(t)||!n||e&&e.shiftKey;if(l)if(this.selectionMode==integralui_core_1.IntegralUISelectionMode.One)this.clearPrevSelection();else if(e&&e.shiftKey)this.clearPrevSelection();else if(!n&&this.selectionMode!=integralui_core_1.IntegralUISelectionMode.MultiSimple&&(1==this.currentSelectedRows.length||!this.isRowInSelectionList(t)))this.clearPrevSelection();this.currentSelectedRow=t;if(e&&e.shiftKey&&this.selectionMode!=integralui_core_1.IntegralUISelectionMode.One){if(!this.shiftFirstSelectedRow)this.shiftFirstSelectedRow=r;var a=this.getRowCurrentIndex(this.shiftFirstSelectedRow),c=this.getRowCurrentIndex(t);if(a>c){var d=a;a=c;c=d}if(this.isIndexInRange(a,this.currentRowList)&&this.isIndexInRange(c,this.currentRowList))for(var u=a;u<=c;u++)if(0!=this.currentRowList[u].data[this.options.rowFields.canSelect]){this.currentRowList[u].data[this.options.rowFields.selected]=!0;this.currentSelectedRows.push(this.currentRowList[u].data)}}else if(n||this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiSimple){var h=null==t[this.options.rowFields.selected]||"undefined"==t[this.options.rowFields.selected]?!1:t[this.options.rowFields.selected];t[this.options.rowFields.selected]=!h;if(!t[this.options.rowFields.selected])this.currentSelectedRows=this.currentSelectedRows.filter(function(e){return e!=t});else if(!this.isRowInSelectionList(t))this.currentSelectedRows.push(t);this.shiftFirstSelectedRow=null}else{t[this.options.rowFields.selected]=!0;if(!this.isRowInSelectionList(t))this.currentSelectedRows.push(t);this.shiftFirstSelectedRow=null}this.callAfterSelectEvent(t);this.refresh()}else if(n||this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiSimple){h=null===t[this.options.rowFields.selected]||"undefined"==t[this.options.rowFields.selected]?!1:t[this.options.rowFields.selected];if(i&&"undefined"!=i)h=i;t[this.options.rowFields.selected]=!h;if(!t[this.options.rowFields.selected])this.currentSelectedRows=this.currentSelectedRows.filter(function(e){return e!=t});else if(!this.isRowInSelectionList(t))this.currentSelectedRows.push(t);this.shiftFirstSelectedRow=null;this.callAfterSelectEvent(t);this.refresh()}else if(!n&&!(this.selectionMode&integralui_core_1.IntegralUISelectionMode.MultiSimple)&&(1==this.currentSelectedRows.length||!this.isRowInSelectionList(t))){this.shiftFirstSelectedRow=null;this.clearPrevSelection(t);this.refresh();if(o)this.selectionChanged.emit(null)}}}}};t.prototype.selectRows=function(e){var t=this;if(e&&Array.isArray(e)){this.currentSelectedRows.map(function(e){return e[t.options.rowFields.selected]=!1});this.currentSelectedRows.length=0;for(var i=0;i<e.length;i++){e[i][this.options.rowFields.selected]=!0;this.currentSelectedRows.push(e[i])}if(e.length>0){this.currentSelectedRow=e[e.length-1];this.callAfterSelectEvent(this.currentSelectedRow)}else this.currentSelectedRow=null;this.refresh()}};t.prototype.updateRowSelection=function(e,t){var i=e&&(e.shiftKey||e.ctrlKey||e.metaKey)?!0:!1;if(this.selectionMode==integralui_core_1.IntegralUISelectionMode.MultiExtended&&0!=t[this.options.rowFields.canSelect]&&this.currentSelectedRows.length>0&&!e.shiftKey&&!i&&1==e.which){var o=this.currentSelectedRows.length;this.clearPrevSelection();this.currentSelectedRow=t;t[this.options.rowFields.selected]=!0;this.currentSelectedRows.push(t);if(o>1)this.callAfterSelectEvent(t);this.refresh()}};t.prototype.sort=function(e,t,i){this.sortColumn=e;this.sortComparer=i;this.options.sorting=t;this.updateLayout();this.change.emit({type:"sorting"})};t.prototype.getCellIndexInCollection=function(e,t,i){var o=-1;if(e)for(var r=0;r<e.length;r++)if(void 0==e[r][this.options.cellFields.cid]){o=t;break}else if(e[r][this.options.cellFields.cid]==i){o=r;break}return o};t.prototype.isSortingAllowed=function(){return this.options.sorting==integralui_core_1.IntegralUISortOrder.Ascending||this.options.sorting==integralui_core_1.IntegralUISortOrder.Descending};t.prototype.isSortingColumn=function(e){return e&&e==this.sortColumn?!0:!1};t.prototype.applySorting=function(e){var t=this;if(e){if(t.sortColumn&&0==t.sortColumn[t.options.columnFields.visible])return;var i=t.getColumnCurrentIndex(t.sortColumn),o=i>=0?i:t.options.expandColIndex,r=t.getCurrentColumnList(t.sortColumn?t.sortColumn[t.options.columnFields.fixed]:void 0);if(o<r.length){var l=r[o][t.options.columnFields.id];if(t.sortColumn&&t.sortColumn[t.options.columnFields.comparer])e.sort(t.sortColumn[t.options.columnFields.comparer]);else if(t.sortComparer)e.sort(t.sortComparer);else if(t.isSortingAllowed())e.sort(function(e,i){var r=null,s=null;if(e[t.options.rowFields.cells]){var n=t.getCellIndexInCollection(e[t.options.rowFields.cells],o,l);if(n>=0){if(!(r=e[t.options.rowFields.cells][n][t.options.cellFields.value]))r=e[t.options.rowFields.cells][n][t.options.cellFields.text];if(t.commonService.isObject(r))r=r.value?r.value:r.text}}if(i[t.options.rowFields.cells]){var a=t.getCellIndexInCollection(i[t.options.rowFields.cells],o,l);if(a>=0){if(!(s=i[t.options.rowFields.cells][a][t.options.cellFields.value]))s=i[t.options.rowFields.cells][a][t.options.cellFields.text];if(t.commonService.isObject(s))s=s.value?s.value:s.text}}r=void 0!=r?r:null;s=void 0!=s?s:null;switch(t.options.sorting){case integralui_core_1.IntegralUISortOrder.Ascending:if(r<s)return-1;else if(r>s)return 1;break;case integralui_core_1.IntegralUISortOrder.Descending:if(r>s)return-1;else if(r<s)return 1;break;default:return 0}})}}};t.prototype.getColumnInlineStyle=function(e){var t={header:"",footer:""};if(e)t={header:this.commonService.isFieldAvailable(e.header,""),footer:this.commonService.isFieldAvailable(e.footer,"")};return t};t.prototype.getRowInlineStyle=function(e,t){var i=e||{};if(t)i.display="none";return i};t.prototype.columnTouchStart=function(e,t){if(this.isEnabled)this.processColumnSelection(e,t.data);e.stopPropagation()};t.prototype.rowTouchStart=function(e,t){if(this.isEnabled)this.processRowSelection(e,t.data)};t.prototype.ctrlTouchStart=function(e){e.preventDefault();if(this.isEnabled){var t=this.commonService.getTouchData(e);if(t&&t.length>0)this.touchStartPos={x:t[0].pageX,y:t[0].pageY}}};t.prototype.ctrlTouchEnd=function(e){var t=this;if(t.isEnabled){var i=t.commonService.getTouchData(e);if(i&&i.length>0)t.touchEndPos={x:i[0].pageX,y:i[0].pageY};var o={dx:t.touchEndPos.x-t.touchStartPos.x,dy:t.touchEndPos.y-t.touchStartPos.y},r=!1,l=!1,s=t.touchStartPos,n={x:t.currentScrollPos.x,y:t.currentScrollPos.y},a=setInterval(function(){var e=t.currentScrollPos;if(o.dx<-20){s.x-=30;if(s.x>t.touchEndPos.x)e.x+=30;else{e.x=n.x-o.dx;r=!0}}else if(o.dx>20){s.x+=30;if(s.x<t.touchEndPos.x)e.x-=30;else{e.x=n.x-o.dx;r=!0}}else r=!0;if(o.dy<-20){s.y-=25;if(s.y>t.touchEndPos.y)e.y+=25;else{e.y=n.y-o.dy;l=!0}}else if(o.dy>20){s.y+=25;if(s.y<t.touchEndPos.y)e.y-=25;else{e.y=n.y-o.dy;l=!0}}else l=!0;t.scrollPos(e);if(n.x!=e.x)t.updateRange();if(n.y!=e.y)t.updateView();if(r&&l){if(n.x!=t.currentScrollPos.x||n.y!=t.currentScrollPos.y)t.scrollPosChanged.emit({value:t.currentScrollPos});clearInterval(a)}},5);t.touchStartPos=t.touchEndPos}};t.Éµfac=function(e){return new(e||t)(i0.ÉµÉµdirectiveInject(i1.IntegralUIDataService),i0.ÉµÉµdirectiveInject(i2.IntegralUIDragDropService),i0.ÉµÉµdirectiveInject(i0.ElementRef),i0.ÉµÉµdirectiveInject(i0.Renderer2),i0.ÉµÉµdirectiveInject(i3.IntegralUICommonService),i0.ÉµÉµdirectiveInject(i4.IntegralUIFilterService),i0.ÉµÉµdirectiveInject(i0.ChangeDetectorRef),i0.ÉµÉµdirectiveInject(i0.ComponentFactoryResolver))};t.Éµcmp=i0.ÉµÉµdefineComponent({type:t,selectors:[["iui-basegrid"]],hostBindings:function(e,t){if(1&e)i0.ÉµÉµlistener("keydown",function(e){return t.onWindowKeyDown(e)},!1,i0.ÉµÉµresolveDocument)("keyup",function(e){return t.onWindowKeyUp(e)},!1,i0.ÉµÉµresolveDocument)},inputs:{appRef:"appRef",autoUpdate:"autoUpdate",allowColumnReorder:"allowColumnReorder",allowDrag:"allowDrag",allowDrop:"allowDrop",allowFilter:"allowFilter",allowFocus:"allowFocus",autoSizeColumns:"autoSizeColumns",columns:"columns",dataFields:"dataFields",focusedCell:"focusedCell",footerHeight:"footerHeight",gridLines:"gridLines",headerHeight:"headerHeight",mouseWheelSpeed:"mouseWheelSpeed",paging:"paging",rowContentVisibility:"rowContentVisibility",rowHeight:"rowHeight",rows:"rows",selectedColumn:"selectedColumn",selectedRow:"selectedRow",selectionMode:"selectionMode",showExpandBox:"showExpandBox",showHoverRow:"showHoverRow",showScroll:"showScroll",sorting:"sorting",dragMode:"dragMode"},outputs:{afterSelect:"afterSelect",beforeEdit:"beforeEdit",beforeSelect:"beforeSelect",beforeUpdate:"beforeUpdate",cellClick:"cellClick",cellDblClick:"cellDblClick",cellHover:"cellHover",cellRightClick:"cellRightClick",cellValueChanging:"cellValueChanging",cellValueChanged:"cellValueChanged",change:"change",columnAdding:"columnAdding",columnAdded:"columnAdded",columnClick:"columnClick",columnDblClick:"columnDblClick",columnHover:"columnHover",columnRightClick:"columnRightClick",columnOrderChanged:"columnOrderChanged",columnRemoving:"columnRemoving",columnRemoved:"columnRemoved",columnsCleared:"columnsCleared",columnSizeChanged:"columnSizeChanged",dragEnd:"dragEnd",dragEnter:"dragEnter",dragDrop:"dragDrop",dragDropComplete:"dragDropComplete",dragLeave:"dragLeave",dragOver:"dragOver",dragStart:"dragStart",keyDown:"keyDown",keyPress:"keyPress",keyUp:"keyUp",pageChanged:"pageChanged",rowAdding:"rowAdding",rowAdded:"rowAdded",rowClick:"rowClick",rowDblClick:"rowDblClick",rowHover:"rowHover",rowRemoving:"rowRemoving",rowRemoved:"rowRemoved",rowRightClick:"rowRightClick",rowsCleared:"rowsCleared",loadComplete:"loadComplete",scrollPosChanged:"scrollPosChanged",selectionChanged:"selectionChanged",updateComplete:"updateComplete"},features:[i0.ÉµÉµProvidersFeature([integralui_data_service_1.IntegralUIDataService]),i0.ÉµÉµInheritDefinitionFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2});return t}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIBaseGrid=IntegralUIBaseGrid;