/*
  filename: integralui.rating.js
  version : 20.3.0
  Copyright © 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(t.hasOwnProperty(i))e[i]=t[i]})(t,i)};return function(t,i){e(t,i);function n(){this.constructor=t}t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),forms_1=require("@angular/forms"),i0=require("@angular/core"),i1=require("../services/integralui.common.service"),i2=require("@angular/common"),_c0=function(e){return{width:e}},IntegralUIRating=function(e){__extends(t,e);function t(t,i){var n=e.call(this,t,i)||this;n.elemRef=t;n.commonService=i;n.ctrlMaxValue=5;n.currentDivision=1;n.currentStepSize=16;n.currentIncrement=integralui_core_1.IntegralUIIncrementMode.Free;n.isRatingChangeActive=!1;n.contentSize={width:0,height:0};n.ratingSize={width:0,height:0};n.ratingClass=[];return n}Object.defineProperty(t.prototype,"division",{get:function(){return this.currentDivision},set:function(e){if(void 0!=e&&e>=1){var t=Math.floor(e);if(this.currentDivision!=t)this.currentDivision=t}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"value",{get:function(){return this.currentValue},set:function(e){var t=Math.floor(e);switch(this.currentIncrement){case integralui_core_1.IntegralUIIncrementMode.Partial:if(this.currentDivision>1){var i=this.currentDivision/4,n=this.currentDivision/2;if(t>(s=Math.floor(t/this.currentDivision))*this.currentDivision+i)e=s*this.currentDivision+n;else if(t>s*this.currentDivision+3*i)e=(s+1)*this.currentDivision;else e=s*this.currentDivision}else if(e>t+.25)e=t+.5;else if(e>t+.75)e=t+1;else e=t;break;case integralui_core_1.IntegralUIIncrementMode.Full:if(this.currentDivision>1){var s=Math.floor(t/this.currentDivision)+1;e=Math.max(t,s*this.currentDivision)}else e=e>t+.5?t+1:t}if((e=Math.max(0,Math.min(this.ctrlMaxValue*this.currentDivision,e)))!==this.currentValue&&e<=this.ctrlMaxValue*this.currentDivision){this.currentValue=e;this.onChange(e);this.processValueChange();this.valueChanged.emit({value:this.currentValue})}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"increment",{get:function(){return this.currentIncrement},set:function(e){if(this.currentIncrement!=e)this.currentIncrement=e},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"max",{get:function(){return this.ctrlMaxValue},set:function(e){if(void 0!=e){e=Math.floor(e);if(this.ctrlMaxValue!=e){this.ctrlMaxValue=e;this.updateLayout()}}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"stepSize",{get:function(){return this.currentStepSize},set:function(e){if(void 0!=e){e=Math.floor(e);if(this.currentStepSize!=e&&e>=1){this.currentStepSize=e;this.updateLayout()}}},enumerable:!0,configurable:!0});t.prototype.ngOnInit=function(){this.generalClassName="iui-rating";this.contentClassName=this.generalClassName+"-content";this.ratingClassName=this.generalClassName+"-value";this.initStyle()};t.prototype.ngAfterViewInit=function(){this.updateLayout()};t.prototype.initStyle=function(){this.defaultStyle={general:{disabled:this.generalClassName+"-disabled",focused:this.generalClassName+"-focused",normal:this.generalClassName,hovered:this.generalClassName+"-hovered",selected:this.generalClassName+"-selected"},content:{disabled:this.contentClassName+"-disabled",focused:this.contentClassName+"-focused",normal:this.contentClassName,hovered:this.contentClassName+"-hovered",selected:this.contentClassName+"-selected"},rating:{disabled:this.ratingClassName+"-disabled",focused:this.ratingClassName+"-focused",normal:this.ratingClassName,hovered:this.ratingClassName+"-hovered",selected:this.ratingClassName+"-selected"}};this.updateStyle(this.controlStyle);this.updateControlClass();this.updateContentClass();this.updateRatingClass()};t.prototype.ngAfterContentChecked=function(){if(1==this.autoUpdate){this.clientRect={width:this.elemRef.nativeElement.firstElementChild.clientWidth,height:this.elemRef.nativeElement.firstElementChild.clientHeight};if(this.clientRect.width!=this.prevClientRect.width){this.updateLayout();this.prevClientRect.width=this.clientRect.width}else if(this.clientRect.height!=this.prevClientRect.height){this.updateLayout();this.prevClientRect.height=this.clientRect.height}}};t.prototype.getContentWidth=function(){return this.contentSize.width};t.prototype.getRatingWidth=function(){return this.ratingSize.width};t.prototype.processValueChange=function(){this.updateLayout()};t.prototype.updateLayout=function(){var e=this.commonService.getPadding(this.elemRef.nativeElement.firstElementChild);this.clientRect={width:this.elemRef.nativeElement.firstElementChild.clientWidth-(e.left+e.right),height:this.elemRef.nativeElement.firstElementChild.clientHeight-(e.top+e.bottom)};this.contentSize={width:this.ctrlMaxValue*this.currentStepSize,height:this.clientRect.height};this.ratingSize={width:this.currentValue<this.ctrlMaxValue*this.currentDivision?this.currentValue*this.currentStepSize/this.currentDivision:this.contentSize.width,height:this.clientRect.height}};t.prototype.ctrlMouseDown=function(e){if(this.isEnabled&&1==e.which){this.isRatingChangeActive=!0;this.value=e.offsetX*this.currentDivision/this.currentStepSize;this.updateLayout();e.stopPropagation()}};t.prototype.ctrlMouseMove=function(e){if(this.isEnabled&&1==e.which&&this.isRatingChangeActive){this.value=e.offsetX*this.currentDivision/this.currentStepSize;this.updateLayout();e.stopPropagation()}};t.prototype.ctrlMouseUp=function(e){this.isRatingChangeActive=!1};t.prototype.ctrlMouseWheel=function(e){if(this.isEnabled){e.preventDefault();var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));this.value;this.value+=-1*t;e.stopPropagation()}};t.prototype.ctrlTouchEnd=function(e){if(this.isEnabled){var t=this.commonService.getTouchData(e);if(t&&t.length>0){var i=this.commonService.getPageRect(this.elemRef.nativeElement),n=this.commonService.getShiftPos();this.value=(t[0].pageX-i.left-n.x)*this.currentDivision/this.currentStepSize;this.updateLayout();e.stopPropagation()}}};t.prototype.onWindowMouseUp=function(e){this.isRatingChangeActive=!1};t.prototype.getControlStyle=function(){var e={width:this.getContentWidth()+"px"};if(this.ctrlSize.width>0)e.width=this.ctrlSize.width+"px";if(this.ctrlSize.height>0)e.height=this.ctrlSize.height+"px";return e};t.prototype.getRatingValueClass=function(){return this.ratingClass};t.prototype.updateRatingClass=function(){this.ratingClass.length=0;this.ratingClass.push(this.ratingClassName);if(this.options.currentStyle){this.ratingClass.push(this.options.currentStyle.rating.normal);if(this.state&integralui_core_1.IntegralUIObjectState.disabled)this.ratingClass.push(this.options.currentStyle.rating.disabled);else if(this.state&integralui_core_1.IntegralUIObjectState.focused)this.ratingClass.push(this.options.currentStyle.rating.focused);else if(this.state&integralui_core_1.IntegralUIObjectState.selected)this.ratingClass.push(this.options.currentStyle.rating.selected);else if(this.state&integralui_core_1.IntegralUIObjectState.hovered)this.ratingClass.push(this.options.currentStyle.rating.hovered)}};t.prototype.getRatingStyle=function(e){if(this.commonService.isString(e))return e;else if(e)return{disabled:this.commonService.isFieldAvailable(e.disabled,this.ratingClassName+"-disabled"),focused:this.commonService.isFieldAvailable(e.focused,this.ratingClassName+"-focused"),hovered:this.commonService.isFieldAvailable(e.hovered,this.ratingClassName+"-hovered"),normal:this.commonService.isFieldAvailable(e.normal,this.ratingClassName),selected:this.commonService.isFieldAvailable(e.selected,this.ratingClassName+"-selected")};else return{disabled:this.defaultStyle.rating.disabled,focused:this.defaultStyle.rating.focused,hovered:this.defaultStyle.rating.hovered,normal:this.defaultStyle.rating.normal,selected:this.defaultStyle.rating.selected}};t.prototype.updateStyle=function(e){if(e)this.options.currentStyle={general:this.getGeneralStyle(e.general),content:this.getContentStyle(e.content),rating:this.getRatingStyle(e.rating)};else this.options.currentStyle={general:{disabled:this.defaultStyle.general.disabled,focused:this.defaultStyle.general.focused,hovered:this.defaultStyle.general.hovered,normal:this.defaultStyle.general.normal,selected:this.defaultStyle.general.selected},content:{disabled:this.defaultStyle.content.disabled,focused:this.defaultStyle.content.focused,hovered:this.defaultStyle.content.hovered,normal:this.defaultStyle.content.normal,selected:this.defaultStyle.content.selected},rating:{disabled:this.defaultStyle.rating.disabled,focused:this.defaultStyle.rating.focused,hovered:this.defaultStyle.rating.hovered,normal:this.defaultStyle.rating.normal,selected:this.defaultStyle.rating.selected}}};t.ɵfac=function(e){return new(e||t)(i0.ɵɵdirectiveInject(i0.ElementRef),i0.ɵɵdirectiveInject(i1.IntegralUICommonService))};t.ɵcmp=i0.ɵɵdefineComponent({type:t,selectors:[["iui-rating"]],hostBindings:function(e,t){if(1&e)i0.ɵɵlistener("mouseup",function(e){return t.onWindowMouseUp(e)},!1,i0.ɵɵresolveDocument)},inputs:{autoUpdate:"autoUpdate",controlStyle:"controlStyle",data:"data",enabled:"enabled",name:"name",size:"size",state:"state",value:"value",division:"division",increment:"increment",max:"max",stepSize:"stepSize"},outputs:{valueChanged:"valueChanged"},features:[i0.ɵɵProvidersFeature([{provide:forms_1.NG_VALUE_ACCESSOR,useExisting:core_1.forwardRef(function(){return t}),multi:!0}]),i0.ɵɵInheritDefinitionFeature],decls:3,vars:10,consts:[["draggable","true",3,"ngClass","ngStyle","dragstart","mousedown","mousemove","mouseup","DOMMouseScroll","mousewheel","touchend"],[2,"position","absolute",3,"ngClass","ngStyle"]],template:function(e,t){if(1&e){i0.ɵɵelementStart(0,"div",0);i0.ɵɵlistener("dragstart",function(e){return t.preventDragStart(e)})("mousedown",function(e){return t.ctrlMouseDown(e)})("mousemove",function(e){return t.ctrlMouseMove(e)})("mouseup",function(e){return t.ctrlMouseUp(e)})("DOMMouseScroll",function(e){return t.ctrlMouseWheel(e)})("mousewheel",function(e){return t.ctrlMouseWheel(e)})("touchend",function(e){return t.ctrlTouchEnd(e)});i0.ɵɵelement(1,"div",1);i0.ɵɵelement(2,"div",1);i0.ɵɵelementEnd()}if(2&e){i0.ɵɵproperty("ngClass",t.getControlClass())("ngStyle",t.getControlStyle());i0.ɵɵadvance(1);i0.ɵɵproperty("ngClass",t.getContentClass())("ngStyle",i0.ɵɵpureFunction1(6,_c0,t.getContentWidth()+"px"));i0.ɵɵadvance(1);i0.ɵɵproperty("ngClass",t.getRatingValueClass())("ngStyle",i0.ɵɵpureFunction1(8,_c0,t.getRatingWidth()+"px"))}},directives:[i2.NgClass,i2.NgStyle],encapsulation:2});return t}(integralui_core_1.IntegralUIBaseValueComponent);exports.IntegralUIRating=IntegralUIRating;