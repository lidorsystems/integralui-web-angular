/*
  filename: integralui.accordion.js
  version : 1.7.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var f=function(b,a){f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return f(b,a)};return function(b,a){function c(){this.constructor=b}f(b,a);b.prototype=null===a?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_groupbox_1=require("./integralui.groupbox"),i0=require("@angular/core"),i1=require("../services/integralui.data.service"),i2=require("../services/integralui.common.service"),i3=require("./integralui.core"),i4=require("@angular/common"),_c0=["content"],_c1=["*"],
IntegralUIAccordion=function(f){function b(a,c,b,g,e){var d=f.call(this,b)||this;d.dataService=a;d.elemRef=c;d.commonService=b;d.cmpResolver=g;d.baseService=e;d.numGroups=0;d.currentSelection=null;d.currentSelectedIndex=-1;d.selectedComponent=null;d.prevComponent=null;d.removeIndex=-1;d.toggleTimer=null;d.tRef=null;d.expandMode=integralui_core_1.IntegralUIExpandMode.Single;d.afterCollapse=new core_1.EventEmitter;d.afterExpand=new core_1.EventEmitter;d.afterSelect=new core_1.EventEmitter;d.beforeCollapse=
new core_1.EventEmitter;d.beforeExpand=new core_1.EventEmitter;d.beforeSelect=new core_1.EventEmitter;d.groupAdding=new core_1.EventEmitter;d.groupAdded=new core_1.EventEmitter;d.clear=new core_1.EventEmitter;d.groupRemoving=new core_1.EventEmitter;d.groupRemoved=new core_1.EventEmitter;d.selectionChanged=new core_1.EventEmitter;d.groupList=[];return d}__extends(b,f);Object.defineProperty(b.prototype,"selectedIndex",{get:function(){return this.currentSelectedIndex},set:function(a){this.currentSelectedIndex!=
a&&(this.currentSelectedIndex=a,this.selectComponentByIndex(a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"selectedGroup",{get:function(){return this.currentSelection},set:function(a){this.currentSelection!=a&&(this.currentSelection=a,this.selectGroup(a))},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.baseService.setComponent(this);this.dataService.init([{data:this.groups}]);this.generalClassName="iui-accordion";this.initStyle()};b.prototype.ngAfterViewInit=
function(){var a=this,c=setTimeout(function(){var d=a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);d&&a.contentRef&&(a.tRef=a.contentRef.createComponent(d));clearTimeout(c)},100)};b.prototype.ngAfterContentInit=function(){this.groupList=this.contentList.toArray();this.numGroups=this.groupList.length;0<this.numGroups&&(0<=this.selectedIndex?this.selectComponentByIndex(this.selectedIndex):this.selectedGroup&&this.groups?this.selectComponentByIndex(this.groups.indexOf(this.selectedGroup)):
this.selectComponentByIndex(0));this.updateLayout()};b.prototype.ngOnDestroy=function(){this.toggleTimer&&clearInterval(this.toggleTimer);this.tRef&&this.tRef.destroy()};b.prototype.ngAfterContentChecked=function(){this.contentList&&(this.groupList=this.contentList.toArray(),this.numGroups!=this.groupList.length&&(this.numGroups=this.groupList.length,this.selectComponentByIndex(this.selectedIndex)),0==this.numGroups&&(this.currentSelection=this.selectedComponent=null));this.clientRect={width:this.elemRef.nativeElement.firstElementChild.clientWidth,
height:this.elemRef.nativeElement.firstElementChild.clientHeight};this.clientRect.width!=this.prevClientRect.width?(this.updateLayout(),this.prevClientRect.width=this.clientRect.width):this.clientRect.height!=this.prevClientRect.height&&(this.updateLayout(),this.prevClientRect.height=this.clientRect.height)};b.prototype.addGroup=function(a){this.callEventAdd("add",a)};b.prototype.clearGroups=function(){this.dataService.clear();this.clear.emit(null)};b.prototype.insertGroupAt=function(a,c){this.callEventAdd("at",
a,c)};b.prototype.insertGroupBefore=function(a,c){this.callEventAdd("ref",a,-1,c)};b.prototype.insertGroupAfter=function(a,c){this.callEventAdd("ref",a,-1,c,!0)};b.prototype.removeGroup=function(a){this.callEventRemove(a)};b.prototype.removeGroupAt=function(a){this.groups&&0<=a&&a<this.groups.length&&this.callEventRemove(this.groups[a])};b.prototype.callEventAdd=function(a,c,d,b,e){var g={cancel:!1,group:c};this.groupAdding.emit(g);if(1!=g.cancel){switch(a){case "at":this.dataService.insert(c,d);
break;case "ref":this.dataService.insertByRef(c,b,e);break;default:this.dataService.insert(c)}this.groupAdded.emit({group:c});this.selectedComponent||this.selectComponentByIndex(0)}};b.prototype.callEventRemove=function(a){var c={cancel:!1,group:a};this.groupRemoving.emit(c);1!=c.cancel&&(this.removeIndex=this.groups?this.groups.indexOf(a):-1,this.dataService.removeAt(a),this.groupRemoved.emit({group:a}))};b.prototype.collapse=function(a){if(a=this.getComponentFromGroup(a))a.expanded=!1};b.prototype.expand=
function(a){if(a=this.getComponentFromGroup(a))a.expanded=!0};b.prototype.closeGroups=function(a){var c=this;c.groupList=c.contentList.toArray();c.groupList.forEach(function(d){d!=a&&(d.selected=!1,c.expandMode===integralui_core_1.IntegralUIExpandMode.Single&&d.collapse())})};b.prototype.collapseComponent=function(a){if(a)var c=this,d=setTimeout(function(){var b=0,e=a.getContentHeight();if(c.allowAnimation)var f=setInterval(function(){0<e?(b=0==b?1:b+2,e-=b,e=0<e?e:0,a.setContentHeight(e+"px")):(a.setContentHeight("0"),
a.expanded=!1,c.invokeEvent("AFTER_COLLAPSE",a),clearInterval(f))},25);else a.setContentHeight("0"),a.expanded=!1,c.invokeEvent("AFTER_COLLAPSE",a);clearInterval(d)},100)};b.prototype.toggleGroups=function(){var a=this;a.toggleTimer&&(a.endToggle(),clearInterval(a.toggleTimer));a.selectedComponent&&(a.toggleTimer=setTimeout(function(){var c=0,d=0,b=0,e=a.selectedComponent.getContentHeight(),f=0;if(a.selectedComponent.expanded)if(a.prevComponent&&(c=a.prevComponent.getContentHeight()),a.allowAnimation)var h=
setInterval(function(){d<e?(b=0==b?1:b+2,d+=b,c-=b,c=0<c?c:0,f=.75*d/e,a.selectedComponent.setOpacity(f),a.selectedComponent.setContentHeight(d+"px"),a.prevComponent&&a.expandMode===integralui_core_1.IntegralUIExpandMode.Single&&a.prevComponent.setContentHeight(c+"px")):(f=1,a.endToggle(),clearInterval(h))},25);else f=1,a.endToggle();else a.selectedComponent.setContentHeight("0"),a.prevComponent&&a.expandMode===integralui_core_1.IntegralUIExpandMode.Single&&a.prevComponent.setContentHeight("auto");
clearTimeout(a.toggleTimer);a.toggleTimer=null},100))};b.prototype.endToggle=function(){this.selectedComponent.setOpacity(1);this.selectedComponent.setContentHeight("auto");this.prevComponent&&this.expandMode===integralui_core_1.IntegralUIExpandMode.Single&&(this.prevComponent.setContentHeight("0"),this.prevComponent.expanded=!1,this.invokeEvent("AFTER_COLLAPSE",this.prevComponent));this.invokeEvent("AFTER_EXPAND",this.selectedComponent)};b.prototype.getGroupCurrentIndex=function(a){this.groupList=
this.contentList.toArray();return a&&this.groupList?this.groupList.indexOf(a):-1};b.prototype.getGroupDataIndex=function(a){return a&&(a=this.getGroupCurrentIndex(a),this.groups&&0<=a&&a<this.groups.length)?a:-1};b.prototype.getGroupData=function(a){return this.groups&&0<=a&&a<this.groups.length?this.groups[a]:null};b.prototype.getGroupIndex=function(a){return a&&this.groups?this.groups.indexOf(a):-1};b.prototype.getComponentData=function(a){if(a){if(a.data)return a.data;a=this.getGroupDataIndex(a);
if(this.groups&&0<=a&&a<this.groups.length)return this.groups[a]}return null};b.prototype.getComponentFromGroup=function(a){var c=null;if(a){this.groupList=this.contentList.toArray();for(var b=0;b<this.groupList.length;b++)if(this.groupList[b].data&&this.groupList[b].data==a){c=this.groupList[b];break}}return c};b.prototype.invokeEvent=function(a,b,d){d=!0;if(this.isEnabled){var c=this.getComponentData(b),e={cancel:!1,group:c};switch(a){case "AFTER_COLLAPSE":this.afterCollapse.emit({group:c});break;
case "AFTER_EXPAND":this.afterExpand.emit({group:c});this.closeGroups(b);break;case "AFTER_SELECT":this.afterSelect.emit({group:c});break;case "BEFORE_COLLAPSE":this.beforeCollapse.emit(e);d=!e.cancel;break;case "BEFORE_EXPAND":this.beforeExpand.emit(e);d=!e.cancel;break;case "BEFORE_SELECT":this.beforeSelect.emit(e),d=!e.cancel}}return d};b.prototype.invokeMethod=function(a,b){var c=!0;if(this.isEnabled){var f;switch(a){case "COLLAPSE_GROUP":this.collapseComponent(b);break;case "SELECT_GROUP":(f=
this.invokeEvent("BEFORE_SELECT",b))&&(c=this.selectComponent(b))&&this.invokeEvent("AFTER_SELECT",b);break;case "TOGGLE_GROUPS":this.selectComponent(b),this.toggleGroups(),c=!1}}return c};b.prototype.isIndexInRange=function(a){this.contentList&&(this.groupList=this.contentList.toArray());return this.groupList?0<=a&&a<this.groupList.length:!1};b.prototype.updateLayout=function(){};b.prototype.clearSelection=function(){this.clearCmpSelection()};b.prototype.clearCmpSelection=function(a){var b=this;
b.groupList=b.contentList.toArray();b.groupList.forEach(function(c){c!=a&&(c.selected=!1,b.expandMode===integralui_core_1.IntegralUIExpandMode.Single&&(c.expanded=!1))});a||(b.selectedComponent=null);b.prevComponent&&!b.prevComponent.expanded&&(b.prevComponent=null)};b.prototype.selectComponent=function(a){if(a&&a!=this.selectedComponent){var b=this.getGroupCurrentIndex(a);this.currentSelectedIndex=b;this.groups&&0<=b&&b<this.groups.length&&(this.currentSelection=this.groups[b]);this.prevComponent=
this.selectedComponent;this.selectedComponent=a;this.clearCmpSelection(a);a.selected=!0;a.expanded=this.expandMode!==integralui_core_1.IntegralUIExpandMode.Single?!a.expanded:!0;this.selectionChanged.emit({index:b,group:this.getGroupData(this.getGroupDataIndex(a))});return!0}return!1};b.prototype.selectComponentByIndex=function(a){var b=this,d=setTimeout(function(){b.isIndexInRange(a)&&b.selectComponent(b.groupList[a]);clearTimeout(d)},100)};b.prototype.selectGroup=function(a){this.groups&&(this.currentSelectedIndex=
this.groups.indexOf(a),this.selectComponentByIndex(this.currentSelectedIndex))};b.prototype.getControlStyle=function(){var a={};0<this.ctrlSize.width&&(a.width=this.ctrlSize.width+"px");0<this.ctrlSize.height&&(a.height=this.ctrlSize.height+"px");return a};b.prototype.refresh=function(){this.updateStyle(this.controlStyle);this.updateControlClass()};b.\u0275fac=function(a){return new (a||b)(i0.\u0275\u0275directiveInject(i1.IntegralUIDataService),i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i2.IntegralUICommonService),
i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver),i0.\u0275\u0275directiveInject(i3.IntegralUIBaseService))};b.\u0275cmp=i0.\u0275\u0275defineComponent({type:b,selectors:[["iui-accordion"]],contentQueries:function(a,b,d){a&1&&i0.\u0275\u0275contentQuery(d,integralui_groupbox_1.IntegralUIGroupBox,!0);if(a&2){var c;i0.\u0275\u0275queryRefresh(c=i0.\u0275\u0275loadQuery())&&(b.contentList=c)}},viewQuery:function(a,b){a&1&&i0.\u0275\u0275viewQuery(_c0,!0,core_1.ViewContainerRef);if(a&2){var c;
i0.\u0275\u0275queryRefresh(c=i0.\u0275\u0275loadQuery())&&(b.contentRef=c.first)}},inputs:{controlStyle:"controlStyle",data:"data",enabled:"enabled",name:"name",size:"size",state:"state",expandMode:"expandMode",groups:"groups",selectedIndex:"selectedIndex",selectedGroup:"selectedGroup"},outputs:{afterCollapse:"afterCollapse",afterExpand:"afterExpand",afterSelect:"afterSelect",beforeCollapse:"beforeCollapse",beforeExpand:"beforeExpand",beforeSelect:"beforeSelect",groupAdding:"groupAdding",groupAdded:"groupAdded",
clear:"clear",groupRemoving:"groupRemoving",groupRemoved:"groupRemoved",selectionChanged:"selectionChanged"},features:[i0.\u0275\u0275ProvidersFeature([integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService]),i0.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:_c1,decls:4,vars:2,consts:[[3,"ngClass","ngStyle"],["content",""]],template:function(a,b){a&1&&(i0.\u0275\u0275projectionDef(),i0.\u0275\u0275elementStart(0,"div",0),i0.\u0275\u0275elementStart(1,"div",
null,1),i0.\u0275\u0275projection(3),i0.\u0275\u0275elementEnd(),i0.\u0275\u0275elementEnd());a&2&&i0.\u0275\u0275property("ngClass",b.getControlClass())("ngStyle",b.getControlStyle())},directives:[i4.NgClass,i4.NgStyle],encapsulation:2});return b}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIAccordion=IntegralUIAccordion;
(function(){i0.\u0275setClassMetadata(IntegralUIAccordion,[{type:core_1.Component,args:[{selector:"iui-accordion",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="getControlStyle()">\n\t\t\t<div #content>\n\t\t\t\t<ng-content></ng-content>\n\t\t\t</div>\n\t\t</div>\n\t',inputs:"controlStyle data enabled name size state".split(" "),providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}]}],function(){return[{type:i1.IntegralUIDataService},
{type:i0.ElementRef},{type:i2.IntegralUICommonService},{type:i0.ComponentFactoryResolver},{type:i3.IntegralUIBaseService}]},{contentList:[{type:core_1.ContentChildren,args:[integralui_groupbox_1.IntegralUIGroupBox,{descendants:!0}]}],contentRef:[{type:core_1.ViewChild,args:["content",{read:core_1.ViewContainerRef,"static":!1}]}],expandMode:[{type:core_1.Input}],groups:[{type:core_1.Input}],selectedIndex:[{type:core_1.Input}],selectedGroup:[{type:core_1.Input}],afterCollapse:[{type:core_1.Output}],
afterExpand:[{type:core_1.Output}],afterSelect:[{type:core_1.Output}],beforeCollapse:[{type:core_1.Output}],beforeExpand:[{type:core_1.Output}],beforeSelect:[{type:core_1.Output}],groupAdding:[{type:core_1.Output}],groupAdded:[{type:core_1.Output}],clear:[{type:core_1.Output}],groupRemoving:[{type:core_1.Output}],groupRemoved:[{type:core_1.Output}],selectionChanged:[{type:core_1.Output}]})})();