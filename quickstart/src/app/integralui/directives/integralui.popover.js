/*
  filename: integralui.popover.js
  version : 1.1.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var e=function(b,a){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};return e(b,a)};return function(b,a){function d(){this.constructor=b}e(b,a);b.prototype=null===a?Object.create(a):(d.prototype=a.prototype,new d)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_tooltip_1=require("./integralui.tooltip"),i0=require("@angular/core"),i1=require("../services/integralui.common.service"),i2=require("@angular/common");
function IntegralUIPopOverComponent_div_1_div_1_Template(e,b){if(e&1){var a=i0.\u0275\u0275getCurrentView();i0.\u0275\u0275elementStart(0,"div",7);i0.\u0275\u0275listener("click",function(){i0.\u0275\u0275restoreView(a);return i0.\u0275\u0275nextContext(2).close()});i0.\u0275\u0275element(1,"span");i0.\u0275\u0275elementEnd()}}
function IntegralUIPopOverComponent_div_1_span_2_Template(e,b){e&1&&(i0.\u0275\u0275elementStart(0,"span",8),i0.\u0275\u0275text(1),i0.\u0275\u0275elementEnd());if(e&2){var a=i0.\u0275\u0275nextContext(2);i0.\u0275\u0275advance(1);i0.\u0275\u0275textInterpolate(a.popoverOptions.title)}}
function IntegralUIPopOverComponent_div_1_Template(e,b){e&1&&(i0.\u0275\u0275elementStart(0,"div",4),i0.\u0275\u0275template(1,IntegralUIPopOverComponent_div_1_div_1_Template,2,0,"div",5),i0.\u0275\u0275template(2,IntegralUIPopOverComponent_div_1_span_2_Template,2,1,"span",6),i0.\u0275\u0275elementEnd());if(e&2){var a=i0.\u0275\u0275nextContext();i0.\u0275\u0275advance(1);i0.\u0275\u0275property("ngIf",a.popoverOptions.closeButton);i0.\u0275\u0275advance(1);i0.\u0275\u0275property("ngIf",a.popoverOptions.title)}}
function IntegralUIPopOverComponent_ng_template_3_Template(e,b){}
var _c0=function(e,b,a){return{display:e,top:b,left:a}},_c1=function(e){return[e]},IntegralUIPopOverComponent=function(e){function b(a,d){var c=e.call(this,a,d)||this;c.elemRef=a;c.commonService=d;c.templateObj={};c.popoverDisplay="none";c.popoverPos={top:0,left:0};c.popoverSize={width:0,height:0};c.closed=new core_1.EventEmitter;c.updateOptions();return c}__extends(b,e);Object.defineProperty(b.prototype,"options",{get:function(){return this.popoverOptions},set:function(a){this.updateOptions(a)},
enumerable:!0,configurable:!0});b.prototype.updateOptions=function(a){this.popoverOptions=a?{activation:this.commonService.isFieldAvailable(a.activation,"auto"),autoPopDelay:this.commonService.isFieldAvailable(a.autoPopDelay,5E3),closeButton:this.commonService.isFieldAvailable(a.closeButton,!0),enabled:this.commonService.isFieldAvailable(a.enabled,!0),header:this.commonService.isFieldAvailable(a.header,!0),initialDelay:this.commonService.isFieldAvailable(a.initialDelay,500),position:this.commonService.isFieldAvailable(a.position,
"mouse"),showMarker:this.commonService.isFieldAvailable(a.showMarker,!0),title:this.commonService.isFieldAvailable(a.title,"")}:{activation:"auto",autoPopDelay:5E3,closeButton:!0,enabled:!0,header:!0,initialDelay:500,position:"mouse",showMarker:!0,title:""}};b.prototype.preventBubbleUp=function(a){a.stopPropagation()};b.prototype.close=function(){this.closed.emit(null)};b.prototype.open=function(a,d){var c=this;c.popoverPos.top=-9999999;c.popoverDisplay="block";var b=setTimeout(function(){c.popoverSize=
c.getSize();c.popoverDisplay="none";c.removeTimers();c.popoverOptions.enabled&&(c.showTimer=setTimeout(function(){c.show(a,d);"auto"==c.popoverOptions.activation&&(c.popupTimer=setTimeout(function(){c.closed.emit(null);clearTimeout(c.popupTimer)},c.popoverOptions.autoPopDelay));clearTimeout(c.showTimer)},c.popoverOptions.initialDelay));clearTimeout(b)},1)};b.prototype.show=function(a,d){this.popoverPos={top:this.mousePos.y+24,left:this.mousePos.x};switch(this.popoverOptions.position){case "above":this.popoverPos=
{top:a.top-4-this.popoverSize.height,left:a.left+Math.floor((d.width-this.popoverSize.width)/2)};break;case "below":this.popoverPos={top:a.bottom+4,left:a.left+Math.floor((d.width-this.popoverSize.width)/2)};break;case "left":this.popoverPos={top:a.top+Math.floor((d.height-this.popoverSize.height)/2),left:a.left-4-this.popoverSize.width};break;case "right":this.popoverPos={top:a.top+Math.floor((d.height-this.popoverSize.height)/2),left:a.right+4}}this.popoverDisplay="block"};b.prototype.getSize=function(){return{width:this.elemRef.nativeElement.firstElementChild.offsetWidth,
height:this.elemRef.nativeElement.firstElementChild.offsetHeight}};b.prototype.updateMousePos=function(a){this.mousePos!=a&&(this.mousePos=a)};b.prototype.updateControlClass=function(){this.ctrlClass.length=0;this.ctrlClass.push("iui-popover");if(this.popoverOptions.showMarker)switch(this.popoverOptions.position){case "above":this.ctrlClass.push("iui-popover-marker-bottom");break;case "right":this.ctrlClass.push("iui-popover-marker-left");break;case "below":this.ctrlClass.push("iui-popover-marker-top");
break;case "left":this.ctrlClass.push("iui-popover-marker-right")}};b.\u0275fac=function(a){return new (a||b)(i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i1.IntegralUICommonService))};b.\u0275cmp=i0.\u0275\u0275defineComponent({type:b,selectors:[["iui-popover"]],inputs:{controlStyle:"controlStyle",data:"data",state:"state",options:"options"},outputs:{closed:"closed"},features:[i0.\u0275\u0275InheritDefinitionFeature],decls:4,vars:11,consts:[[1,"iui-popover",2,"opacity",
"1 !important",3,"ngClass","ngStyle","click","mousedown","mouseup"],["class","iui-popover-header",4,"ngIf"],[1,"iui-popover-content"],["ngFor","",3,"ngForOf","ngForTemplate"],[1,"iui-popover-header"],["class","iui-popover-close-button",3,"click",4,"ngIf"],["class","iui-popover-title",4,"ngIf"],[1,"iui-popover-close-button",3,"click"],[1,"iui-popover-title"]],template:function(a,d){a&1&&(i0.\u0275\u0275elementStart(0,"div",0),i0.\u0275\u0275listener("click",function(a){return d.preventBubbleUp(a)})("mousedown",
function(a){return d.preventBubbleUp(a)})("mouseup",function(a){return d.preventBubbleUp(a)}),i0.\u0275\u0275template(1,IntegralUIPopOverComponent_div_1_Template,3,2,"div",1),i0.\u0275\u0275elementStart(2,"div",2),i0.\u0275\u0275template(3,IntegralUIPopOverComponent_ng_template_3_Template,0,0,"ng-template",3),i0.\u0275\u0275elementEnd(),i0.\u0275\u0275elementEnd());a&2&&(i0.\u0275\u0275property("ngClass",d.getControlClass())("ngStyle",i0.\u0275\u0275pureFunction3(5,_c0,d.popoverDisplay,d.popoverPos.top+
"px",d.popoverPos.left+"px")),i0.\u0275\u0275advance(1),i0.\u0275\u0275property("ngIf",d.popoverOptions.header),i0.\u0275\u0275advance(2),i0.\u0275\u0275property("ngForOf",i0.\u0275\u0275pureFunction1(9,_c1,d.templateObj.data))("ngForTemplate",d.templateObj.template))},directives:[i2.NgClass,i2.NgStyle,i2.NgIf,i2.NgForOf],encapsulation:2});return b}(integralui_tooltip_1.IntegralUITooltipComponent);exports.IntegralUIPopOverComponent=IntegralUIPopOverComponent;
(function(){i0.\u0275setClassMetadata(IntegralUIPopOverComponent,[{type:core_1.Component,args:[{selector:"iui-popover",template:'\n\t\t<div class="iui-popover" [ngClass]="getControlClass()" [ngStyle]="{ \'display\': popoverDisplay, \'top\': popoverPos.top + \'px\', \'left\': popoverPos.left + \'px\' }" style="opacity:1 !important" (click)="preventBubbleUp($event)" (mousedown)="preventBubbleUp($event)" (mouseup)="preventBubbleUp($event)">\n\t\t\t<div *ngIf="popoverOptions.header" class="iui-popover-header">\n                <div *ngIf="popoverOptions.closeButton" class="iui-popover-close-button" (click)="close()"><span></span></div>\n\t\t\t\t<span *ngIf="popoverOptions.title" class="iui-popover-title">{{popoverOptions.title}}</span>\n\t\t\t</div>\n\t\t\t<div class="iui-popover-content"><ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template></div>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],encapsulation:core_1.ViewEncapsulation.None}]}],function(){return[{type:i0.ElementRef},{type:i1.IntegralUICommonService}]},{options:[{type:core_1.Input}],closed:[{type:core_1.Output}]})})();
var IntegralUIPopOver=function(e){function b(a,d,c){var b=e.call(this,a,d,c)||this;b.elemRef=a;b.cmpResolver=d;b.commonService=c;b.currentSettings=!1;b.templateData=[];b.currentMousePos={x:0,y:0};b.templateList=[];b.popOverClosed=new core_1.EventEmitter;return b}__extends(b,e);Object.defineProperty(b.prototype,"settings",{get:function(){return this.currentSettings},set:function(a){this.currentSettings!=a&&(this.currentSettings=a,this.updateTemplate())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"popOverShow",{get:function(){return this.isVisible},set:function(a){this.isVisible!=a&&(this.isVisible=a,this.toggle())},enumerable:!0,configurable:!0});b.prototype.ngAfterContentInit=function(){this.updateTemplate()};b.prototype.updateTemplate=function(){this.templateData.length=0;if(this.templates){this.templateList=this.templates.toArray();for(var a=0;a<this.templateList.length;a++)if(this.templateList[a].settings)switch(this.templateList[a].settings.type){case "popover":this.templateData.push(this.templateList[a].getTemplate())}}};
b.prototype.closePopOver=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null};b.prototype.openPopOver=function(a){var b=this,c=b.popoverRef?b.popoverRef:b.settings.appRef;if(c){b.closePopOver();var e=b.cmpResolver.resolveComponentFactory(IntegralUIPopOverComponent);e&&(b.cmpRef=c.createComponent(e),b.cmpRef&&(c=null,b.cmpRef.instance&&(c=b.cmpRef.instance),c&&(c.options=b.settings,b.templateData[0]&&(c.templateObj=
{data:b.settings.data||{},template:b.templateData[0]}),a&&c.updateMousePos(a),a=this.elemRef.nativeElement.getBoundingClientRect(),c.open(a,b.getSize()),b.eventList.push(c.closed.subscribe(function(a){b.closePopOver();b.popOverClosed.emit(null)})))))}};b.prototype.toggle=function(){1==this.popOverShow?this.openPopOver(0!=this.currentMousePos.x&&0!=this.currentMousePos.y?this.currentMousePos:void 0):this.closePopOver()};b.prototype.onMouseEnter=function(a){void 0==this.popOverShow&&(a=this.commonService.getMousePos(a),
this.openPopOver(a))};b.prototype.onMouseLeave=function(a){void 0==this.popOverShow&&this.closePopOver()};b.prototype.onMouseMove=function(a){this.cmpRef&&void 0==this.popOverShow?this.cmpRef.instance&&this.cmpRef.instance.updateMousePos(this.commonService.getMousePos(a)):this.currentMousePos=this.commonService.getMousePos(a)};b.\u0275fac=function(a){return new (a||b)(i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver),i0.\u0275\u0275directiveInject(i1.IntegralUICommonService))};
b.\u0275dir=i0.\u0275\u0275defineDirective({type:b,selectors:[["","iuiPopOver",""]],contentQueries:function(a,b,c){a&1&&i0.\u0275\u0275contentQuery(c,integralui_core_1.IntegralUITemplate,!0);if(a&2){var d;i0.\u0275\u0275queryRefresh(d=i0.\u0275\u0275loadQuery())&&(b.templates=d)}},hostBindings:function(a,b){a&1&&i0.\u0275\u0275listener("mouseenter",function(a){return b.onMouseEnter(a)})("mouseleave",function(a){return b.onMouseLeave(a)})("mousemove",function(a){return b.onMouseMove(a)})},inputs:{settings:["iuiPopOver",
"settings"],popoverRef:"popoverRef",popOverShow:"popOverShow"},outputs:{popOverClosed:"popOverClosed"},features:[i0.\u0275\u0275InheritDefinitionFeature]});return b}(integralui_tooltip_1.IntegralUITooltip);exports.IntegralUIPopOver=IntegralUIPopOver;
(function(){i0.\u0275setClassMetadata(IntegralUIPopOver,[{type:core_1.Directive,args:[{selector:"[iuiPopOver]"}]}],function(){return[{type:i0.ElementRef},{type:i0.ComponentFactoryResolver},{type:i1.IntegralUICommonService}]},{templates:[{type:core_1.ContentChildren,args:[integralui_core_1.IntegralUITemplate,{descendants:!0}]}],settings:[{type:core_1.Input,args:["iuiPopOver"]}],popoverRef:[{type:core_1.Input}],popOverShow:[{type:core_1.Input}],popOverClosed:[{type:core_1.Output}],onMouseEnter:[{type:core_1.HostListener,
args:["mouseenter",["$event"]]}],onMouseLeave:[{type:core_1.HostListener,args:["mouseleave",["$event"]]}],onMouseMove:[{type:core_1.HostListener,args:["mousemove",["$event"]]}]})})();