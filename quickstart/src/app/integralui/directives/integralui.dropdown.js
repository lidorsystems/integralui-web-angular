/*
  filename: integralui.dropdown.js
  version : 1.6.0
  Copyright Â© 2016-2019 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var c=function(a,d){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,a){d.__proto__=a}||function(d,a){for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b])};return c(a,d)};return function(a,d){function b(){this.constructor=a}c(a,d);a.prototype=null===d?Object.create(d):(b.prototype=d.prototype,new b)}}(),__decorate=this&&this.__decorate||function(c,a,d,b){var g=arguments.length,e=3>g?a:null===b?b=Object.getOwnPropertyDescriptor(a,d):b,f;
if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(c,a,d,b);else for(var h=c.length-1;0<=h;h--)if(f=c[h])e=(3>g?f(e):3<g?f(a,d,e):f(a,d))||e;return 3<g&&e&&Object.defineProperty(a,d,e),e},__metadata=this&&this.__metadata||function(c,a){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(c,a)};Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),IntegralUIDropDownComponent=function(c){function a(d,a){var b=c.call(this,a)||this;b.elemRef=d;b.commonService=a;b.showTimer=null;b.popupTimer=null;b.mousePos={x:0,y:0};b.dropdownDisplay="none";b.dropdownPos={top:0,left:0};b.dropdownSize={width:0,height:0};b.closed=new core_1.EventEmitter;b.updateOptions();return b}__extends(a,
c);Object.defineProperty(a.prototype,"options",{get:function(){return this.dropdownOptions},set:function(a){this.updateOptions(a)},enumerable:!0,configurable:!0});a.prototype.ngAfterContentInit=function(){var a=this,b=setTimeout(function(){a.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},500)};a.prototype.ngOnDestroy=function(){};a.prototype.updateAdjustment=function(a){return a?{top:this.commonService.isFieldAvailable(a.top,0),right:this.commonService.isFieldAvailable(a.right,0),
bottom:this.commonService.isFieldAvailable(a.bottom,0),left:this.commonService.isFieldAvailable(a.left,0)}:{top:0,right:0,bottom:0,left:0}};a.prototype.updateOptions=function(a){a?(this.dropdownOptions={adjustment:this.updateAdjustment(a.adjustment),autoClose:this.commonService.isFieldAvailable(a.autoClose,!0),autoPopDelay:this.commonService.isFieldAvailable(a.autoPopDelay,5E3),enabled:this.commonService.isFieldAvailable(a.enabled,!0),initialDelay:this.commonService.isFieldAvailable(a.initialDelay,
500),position:this.commonService.isFieldAvailable(a.position,"auto"),showMarker:this.commonService.isFieldAvailable(a.showMarker,!0),title:this.commonService.isFieldAvailable(a.title,"")},this.updateDropDownSize(a.dropDownSize)):this.dropdownOptions={adjustment:this.updateAdjustment(),autoClose:!0,autoPopDelay:5E3,enabled:!0,initialDelay:500,position:"auto",showMarker:!0,title:""}};a.prototype.updateDropDownSize=function(a){a&&(this.dropdownOptions.dropDownSize={width:this.commonService.isFieldAvailable(a.width,
0),height:this.commonService.isFieldAvailable(a.height,0)})};a.prototype.onBlur=function(a){0!=this.options.autoClose&&this.closed.emit(null)};a.prototype.onMouseDown=function(a){1==a.buttons&&this.closed.emit(null)};a.prototype.removeTimers=function(){this.showTimer&&(clearTimeout(this.showTimer),this.showTimer=null);this.popupTimer&&(clearTimeout(this.popupTimer),this.popupTimer=null)};a.prototype.open=function(a,b,c){var d=this;d.removeTimers();d.dropdownPos.top=-9999999;d.dropdownDisplay="none";
var g=setTimeout(function(){d.dropdownSize=d.getSize();d.dropdownOptions.enabled&&d.show(a,b,c);clearTimeout(g)},10)};a.prototype.show=function(a,b,c){this.dropdownPos={top:this.mousePos.y+24,left:this.mousePos.x};b=this.commonService.getShiftPos();switch(this.dropdownOptions.position){case "above":this.dropdownPos={top:a.top+b.y-4-this.dropdownSize.height,left:a.left+b.x+this.dropdownOptions.adjustment.left};break;case "left":this.dropdownPos={top:a.top+b.y-4,left:a.left+b.x-4-this.dropdownSize.width};
break;case "right":this.dropdownPos={top:a.top+b.y-4,left:a.right+b.x+4};break;case "below":this.dropdownPos={top:a.bottom+b.y+4+this.dropdownOptions.adjustment.top,left:a.left+b.x+this.dropdownOptions.adjustment.left};break;default:this.dropdownPos={top:a.bottom+b.y+4+this.dropdownOptions.adjustment.top,left:a.left+b.x+this.dropdownOptions.adjustment.left},c&&this.dropdownPos.top+this.dropdownSize.height>c.height&&(this.dropdownPos.top-=this.dropdownPos.top+this.dropdownSize.height-c.height)}this.dropdownDisplay=
"block"};a.prototype.getSize=function(){var a={width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight};this.options.dropDownSize&&(a.width=this.commonService.isFieldAvailable(this.options.dropDownSize.width,a.width),a.height=this.commonService.isFieldAvailable(this.options.dropDownSize.height,a.height));return a};a.prototype.updateMousePos=function(a){this.mousePos!=a&&(this.mousePos=a)};a.prototype.updateControlClass=function(){this.ctrlClass.length=
0;this.ctrlClass.push("iui-dropdown");if(this.dropdownOptions.showMarker)switch(this.dropdownOptions.position){case "above":this.ctrlClass.push("iui-dropdown-marker-bottom");break;case "right":this.ctrlClass.push("iui-dropdown-marker-left");break;case "below":this.ctrlClass.push("iui-dropdown-marker-top");break;case "left":this.ctrlClass.push("iui-dropdown-marker-right")}};__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],a.prototype,"options",null);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],a.prototype,"closed",void 0);return a=__decorate([core_1.Component({selector:"iui-dropdown",template:'\n\t\t<div class="iui-dropdown" [ngClass]="getControlClass()" [ngStyle]="{ \'top\': dropdownPos.top + \'px\', \'left\': dropdownPos.left + \'px\' }" (blur)="onBlur($event)" (mousedown)="onMouseDown($event)" tabindex="999">\n\t\t\t<ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[core_1.ElementRef,integralui_common_service_1.IntegralUICommonService])],a)}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIDropDownComponent=IntegralUIDropDownComponent;
var IntegralUIDropDown=function(){function c(a,c,b){this.elemRef=a;this.cmpResolver=c;this.commonService=b;this.currentSettings=!1;this.eventList=[];this.templateData=[];this.isTouchProcessed=this.isDropDownOpen=!1;this.winScrollPos={top:0,left:0};this.cmpRef=null;this.templateList=[];this.dropDownOpen=new core_1.EventEmitter;this.dropDownOpening=new core_1.EventEmitter;this.dropDownClose=new core_1.EventEmitter}Object.defineProperty(c.prototype,"settings",{get:function(){return this.currentSettings},
set:function(a){this.currentSettings!=a&&(this.currentSettings=a,this.updateTemplate())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"showDropDown",{get:function(){return this.isDropDownOpen},set:function(a){this.isDropDownOpen!=a&&((this.isDropDownOpen=a)?this.open():this.close())},enumerable:!0,configurable:!0});c.prototype.ngAfterContentInit=function(){this.updateTemplate()};c.prototype.updateTemplate=function(){this.templateData.length=0;if(this.templates){this.templateList=
this.templates.toArray();for(var a=0;a<this.templateList.length;a++)if(this.templateList[a].settings)switch(this.templateList[a].settings.type){case "dropdown":this.templateData.push(this.templateList[a].getTemplate())}}};c.prototype.closeDropDown=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null;this.isDropDownOpen=!1;this.dropDownClose.emit(null)};c.prototype.close=function(){this.closeDropDown()};c.prototype.open=
function(a,c){var b=this;b.winScrollPos={top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=b.dropDownRef?b.dropDownRef:b.settings?b.settings.appRef:null;if(d){var e={cancel:!1,event:a};b.dropDownOpening.emit(e);if(1!=e.cancel&&(e=b.cmpResolver.resolveComponentFactory(IntegralUIDropDownComponent))&&(b.cmpRef=d.createComponent(e),b.cmpRef&&(d=null,b.cmpRef._component?d=b.cmpRef._component:b.cmpRef._hostElement&&(d=b.cmpRef._hostElement.component),d))){d.options=
b.settings;d.templateObj={data:b.settings.data,template:b.templateData[0]};if(a){e=a;if(c){var f=this.commonService.getTouchData(a);f&&0<f.length&&(e={pageX:f[0].pageX,pageY:f[0].pageY})}d.updateMousePos(b.commonService.getMousePos(e))}this.dropDownOpen.emit(null);e=b.settings.appSize?b.settings.appSize:{width:window.innerWidth,height:window.innerHeight};f=this.elemRef.nativeElement.getBoundingClientRect();d.open(f,b.getSize(),e);setTimeout(function(){window.scrollTo(b.winScrollPos.left,b.winScrollPos.top)},
5);b.eventList.push(d.closed.subscribe(function(a){b.closeDropDown()}));a&&a.stopPropagation()}}};c.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};c.prototype.onMouseDown=function(a){this.isTouchProcessed||this.processOpen(a)};c.prototype.onTouchStart=function(a){this.isTouchProcessed=!0;this.processOpen(a,!0)};c.prototype.onTouchEnd=function(a){a.stopPropagation()};c.prototype.processOpen=function(a,c){var b=this,
d=b.settings?1==b.settings.manual:!1;!c&&1!=a.which||d||(b.closeDropDown(),b.open(a,c));setTimeout(function(){b.isTouchProcessed=!1},500)};__decorate([core_1.ContentChildren(integralui_core_1.IntegralUITemplate),__metadata("design:type",core_1.QueryList)],c.prototype,"templates",void 0);__decorate([core_1.Input("iuiDropDown"),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],c.prototype,"settings",null);__decorate([core_1.Input(),__metadata("design:type",Object)],c.prototype,
"dropDownRef",void 0);__decorate([core_1.Input(),__metadata("design:type",Boolean),__metadata("design:paramtypes",[Boolean])],c.prototype,"showDropDown",null);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],c.prototype,"dropDownOpen",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],c.prototype,"dropDownOpening",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],c.prototype,"dropDownClose",void 0);__decorate([core_1.HostListener("mousedown",
["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],c.prototype,"onMouseDown",null);__decorate([core_1.HostListener("touchstart",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],c.prototype,"onTouchStart",null);__decorate([core_1.HostListener("touchend",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",
void 0)],c.prototype,"onTouchEnd",null);return c=__decorate([core_1.Directive({selector:"[iuiDropDown]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ComponentFactoryResolver,integralui_common_service_1.IntegralUICommonService])],c)}();exports.IntegralUIDropDown=IntegralUIDropDown;