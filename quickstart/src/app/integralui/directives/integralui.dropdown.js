/*
  filename: integralui.dropdown.js
  version : 1.6.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var d=function(a,c){d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,a){c.__proto__=a}||function(c,a){for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b])};return d(a,c)};return function(a,c){function b(){this.constructor=a}d(a,c);a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),i0=require("@angular/core"),i1=require("../services/integralui.common.service"),i2=require("@angular/common");function IntegralUIDropDownComponent_ng_template_1_Template(d,a){}
var _c0=function(d,a){return{top:d,left:a}},_c1=function(d){return[d]},IntegralUIDropDownComponent=function(d){function a(c,a){var b=d.call(this,a)||this;b.elemRef=c;b.commonService=a;b.templateObj={};b.showTimer=null;b.popupTimer=null;b.mousePos={x:0,y:0};b.dropdownDisplay="none";b.dropdownPos={top:0,left:0};b.dropdownSize={width:0,height:0};b.closed=new core_1.EventEmitter;b.updateOptions();return b}__extends(a,d);Object.defineProperty(a.prototype,"options",{get:function(){return this.dropdownOptions},
set:function(c){this.updateOptions(c)},enumerable:!0,configurable:!0});a.prototype.ngAfterContentInit=function(){var c=this,b=setTimeout(function(){c.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},500)};a.prototype.ngOnDestroy=function(){};a.prototype.updateAdjustment=function(c){return c?{top:this.commonService.isFieldAvailable(c.top,0),right:this.commonService.isFieldAvailable(c.right,0),bottom:this.commonService.isFieldAvailable(c.bottom,0),left:this.commonService.isFieldAvailable(c.left,
0)}:{top:0,right:0,bottom:0,left:0}};a.prototype.updateOptions=function(c){c?(this.dropdownOptions={adjustment:this.updateAdjustment(c.adjustment),autoClose:this.commonService.isFieldAvailable(c.autoClose,!0),autoPopDelay:this.commonService.isFieldAvailable(c.autoPopDelay,5E3),enabled:this.commonService.isFieldAvailable(c.enabled,!0),initialDelay:this.commonService.isFieldAvailable(c.initialDelay,500),position:this.commonService.isFieldAvailable(c.position,"auto"),showMarker:this.commonService.isFieldAvailable(c.showMarker,
!0),title:this.commonService.isFieldAvailable(c.title,"")},this.updateDropDownSize(c.dropDownSize)):this.dropdownOptions={adjustment:this.updateAdjustment(),autoClose:!0,autoPopDelay:5E3,enabled:!0,initialDelay:500,position:"auto",showMarker:!0,title:""}};a.prototype.updateDropDownSize=function(c){c&&(this.dropdownOptions.dropDownSize={width:this.commonService.isFieldAvailable(c.width,0),height:this.commonService.isFieldAvailable(c.height,0)})};a.prototype.onBlur=function(c){0!=this.options.autoClose&&
this.closed.emit(null)};a.prototype.onMouseDown=function(c){1==c.buttons&&this.closed.emit(null)};a.prototype.removeTimers=function(){this.showTimer&&(clearTimeout(this.showTimer),this.showTimer=null);this.popupTimer&&(clearTimeout(this.popupTimer),this.popupTimer=null)};a.prototype.open=function(c,b,a){var d=this;d.removeTimers();d.dropdownPos.top=-9999999;d.dropdownDisplay="none";var g=setTimeout(function(){d.dropdownSize=d.getSize();d.dropdownOptions.enabled&&d.show(c,b,a);clearTimeout(g)},10)};
a.prototype.show=function(c,b,a){this.dropdownPos={top:this.mousePos.y+24,left:this.mousePos.x};b=this.commonService.getShiftPos();switch(this.dropdownOptions.position){case "above":this.dropdownPos={top:c.top+b.y-4-this.dropdownSize.height,left:c.left+b.x+this.dropdownOptions.adjustment.left};break;case "left":this.dropdownPos={top:c.top+b.y-4,left:c.left+b.x-4-this.dropdownSize.width};break;case "right":this.dropdownPos={top:c.top+b.y-4,left:c.right+b.x+4};break;case "below":this.dropdownPos={top:c.bottom+
b.y+4+this.dropdownOptions.adjustment.top,left:c.left+b.x+this.dropdownOptions.adjustment.left};break;default:this.dropdownPos={top:c.bottom+b.y+4+this.dropdownOptions.adjustment.top,left:c.left+b.x+this.dropdownOptions.adjustment.left},a&&this.dropdownPos.top+this.dropdownSize.height>a.height&&(this.dropdownPos.top-=this.dropdownPos.top+this.dropdownSize.height-a.height)}this.dropdownDisplay="block"};a.prototype.getSize=function(){var a={width:this.elemRef.nativeElement.firstElementChild.offsetWidth,
height:this.elemRef.nativeElement.firstElementChild.offsetHeight};this.options.dropDownSize&&(a.width=this.commonService.isFieldAvailable(this.options.dropDownSize.width,a.width),a.height=this.commonService.isFieldAvailable(this.options.dropDownSize.height,a.height));return a};a.prototype.updateMousePos=function(a){this.mousePos!=a&&(this.mousePos=a)};a.prototype.updateControlClass=function(){this.ctrlClass.length=0;this.ctrlClass.push("iui-dropdown");if(this.dropdownOptions.showMarker)switch(this.dropdownOptions.position){case "above":this.ctrlClass.push("iui-dropdown-marker-bottom");
break;case "right":this.ctrlClass.push("iui-dropdown-marker-left");break;case "below":this.ctrlClass.push("iui-dropdown-marker-top");break;case "left":this.ctrlClass.push("iui-dropdown-marker-right")}};a.\u0275fac=function(c){return new (c||a)(i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i1.IntegralUICommonService))};a.\u0275cmp=i0.\u0275\u0275defineComponent({type:a,selectors:[["iui-dropdown"]],inputs:{controlStyle:"controlStyle",data:"data",state:"state",options:"options"},
outputs:{closed:"closed"},features:[i0.\u0275\u0275InheritDefinitionFeature],decls:2,vars:9,consts:[["tabindex","999",1,"iui-dropdown",3,"ngClass","ngStyle","blur","mousedown"],["ngFor","",3,"ngForOf","ngForTemplate"]],template:function(a,b){a&1&&(i0.\u0275\u0275elementStart(0,"div",0),i0.\u0275\u0275listener("blur",function(a){return b.onBlur(a)})("mousedown",function(a){return b.onMouseDown(a)}),i0.\u0275\u0275template(1,IntegralUIDropDownComponent_ng_template_1_Template,0,0,"ng-template",1),i0.\u0275\u0275elementEnd());
a&2&&(i0.\u0275\u0275property("ngClass",b.getControlClass())("ngStyle",i0.\u0275\u0275pureFunction2(4,_c0,b.dropdownPos.top+"px",b.dropdownPos.left+"px")),i0.\u0275\u0275advance(1),i0.\u0275\u0275property("ngForOf",i0.\u0275\u0275pureFunction1(7,_c1,b.templateObj.data))("ngForTemplate",b.templateObj.template))},directives:[i2.NgClass,i2.NgStyle,i2.NgForOf],encapsulation:2});return a}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIDropDownComponent=IntegralUIDropDownComponent;
(function(){i0.\u0275setClassMetadata(IntegralUIDropDownComponent,[{type:core_1.Component,args:[{selector:"iui-dropdown",template:'\n\t\t<div class="iui-dropdown" [ngClass]="getControlClass()" [ngStyle]="{ \'top\': dropdownPos.top + \'px\', \'left\': dropdownPos.left + \'px\' }" (blur)="onBlur($event)" (mousedown)="onMouseDown($event)" tabindex="999">\n\t\t\t<ng-template ngFor [ngForOf]="[templateObj.data]" [ngForTemplate]="templateObj.template"></ng-template>\n\t\t</div>\n\t',inputs:["controlStyle",
"data","state"],encapsulation:core_1.ViewEncapsulation.None}]}],function(){return[{type:i0.ElementRef},{type:i1.IntegralUICommonService}]},{options:[{type:core_1.Input}],closed:[{type:core_1.Output}]})})();
var IntegralUIDropDown=function(){function d(a,c,b){this.elemRef=a;this.cmpResolver=c;this.commonService=b;this.currentSettings=!1;this.eventList=[];this.templateData=[];this.isTouchProcessed=this.isDropDownOpen=!1;this.winScrollPos={top:0,left:0};this.cmpRef=null;this.templateList=[];this.dropDownOpen=new core_1.EventEmitter;this.dropDownOpening=new core_1.EventEmitter;this.dropDownClose=new core_1.EventEmitter}Object.defineProperty(d.prototype,"settings",{get:function(){return this.currentSettings},
set:function(a){this.currentSettings!=a&&(this.currentSettings=a,this.updateTemplate())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"showDropDown",{get:function(){return this.isDropDownOpen},set:function(a){this.isDropDownOpen!=a&&((this.isDropDownOpen=a)?this.open():this.close())},enumerable:!0,configurable:!0});d.prototype.ngAfterContentInit=function(){this.updateTemplate()};d.prototype.updateTemplate=function(){this.templateData.length=0;if(this.templates){this.templateList=
this.templates.toArray();for(var a=0;a<this.templateList.length;a++)if(this.templateList[a].settings)switch(this.templateList[a].settings.type){case "dropdown":this.templateData.push(this.templateList[a].getTemplate())}}};d.prototype.closeDropDown=function(){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());this.cmpRef=null;this.isDropDownOpen=!1;this.dropDownClose.emit(null)};d.prototype.close=function(){this.closeDropDown()};d.prototype.open=
function(a,c){var b=this;b.winScrollPos={top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=b.dropDownRef?b.dropDownRef:b.settings?b.settings.appRef:null;if(d){var e={cancel:!1,event:a};b.dropDownOpening.emit(e);if(1!=e.cancel&&(e=b.cmpResolver.resolveComponentFactory(IntegralUIDropDownComponent))&&(b.cmpRef=d.createComponent(e),b.cmpRef&&(d=null,b.cmpRef.instance&&(d=b.cmpRef.instance),d))){d.options=b.settings;d.templateObj={data:b.settings.data,template:b.templateData[0]};
if(a){e=a;if(c){var f=this.commonService.getTouchData(a);f&&0<f.length&&(e={pageX:f[0].pageX,pageY:f[0].pageY})}d.updateMousePos(b.commonService.getMousePos(e))}this.dropDownOpen.emit(null);e=b.settings.appSize?b.settings.appSize:{width:window.innerWidth,height:window.innerHeight};f=this.elemRef.nativeElement.getBoundingClientRect();d.open(f,b.getSize(),e);setTimeout(function(){window.scrollTo(b.winScrollPos.left,b.winScrollPos.top)},5);b.eventList.push(d.closed.subscribe(function(a){b.closeDropDown()}));
a&&a.stopPropagation()}}};d.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};d.prototype.onMouseDown=function(a){this.isTouchProcessed||this.processOpen(a)};d.prototype.onTouchStart=function(a){this.isTouchProcessed=!0;this.processOpen(a,!0)};d.prototype.onTouchEnd=function(a){a.stopPropagation()};d.prototype.processOpen=function(a,c){var b=this,d=b.settings?1==b.settings.manual:!1;!c&&1!=a.which||d||(b.closeDropDown(),
b.open(a,c));setTimeout(function(){b.isTouchProcessed=!1},500)};d.\u0275fac=function(a){return new (a||d)(i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver),i0.\u0275\u0275directiveInject(i1.IntegralUICommonService))};d.\u0275dir=i0.\u0275\u0275defineDirective({type:d,selectors:[["","iuiDropDown",""]],contentQueries:function(a,c,b){a&1&&i0.\u0275\u0275contentQuery(b,integralui_core_1.IntegralUITemplate,!0);if(a&2){var d;i0.\u0275\u0275queryRefresh(d=
i0.\u0275\u0275loadQuery())&&(c.templates=d)}},hostBindings:function(a,c){a&1&&i0.\u0275\u0275listener("mousedown",function(a){return c.onMouseDown(a)})("touchstart",function(a){return c.onTouchStart(a)})("touchend",function(a){return c.onTouchEnd(a)})},inputs:{settings:["iuiDropDown","settings"],dropDownRef:"dropDownRef",showDropDown:"showDropDown"},outputs:{dropDownOpen:"dropDownOpen",dropDownOpening:"dropDownOpening",dropDownClose:"dropDownClose"}});return d}();exports.IntegralUIDropDown=IntegralUIDropDown;
(function(){i0.\u0275setClassMetadata(IntegralUIDropDown,[{type:core_1.Directive,args:[{selector:"[iuiDropDown]"}]}],function(){return[{type:i0.ElementRef},{type:i0.ComponentFactoryResolver},{type:i1.IntegralUICommonService}]},{templates:[{type:core_1.ContentChildren,args:[integralui_core_1.IntegralUITemplate,{descendants:!0}]}],settings:[{type:core_1.Input,args:["iuiDropDown"]}],dropDownRef:[{type:core_1.Input}],showDropDown:[{type:core_1.Input}],dropDownOpen:[{type:core_1.Output}],dropDownOpening:[{type:core_1.Output}],
dropDownClose:[{type:core_1.Output}],onMouseDown:[{type:core_1.HostListener,args:["mousedown",["$event"]]}],onTouchStart:[{type:core_1.HostListener,args:["touchstart",["$event"]]}],onTouchEnd:[{type:core_1.HostListener,args:["touchend",["$event"]]}]})})();