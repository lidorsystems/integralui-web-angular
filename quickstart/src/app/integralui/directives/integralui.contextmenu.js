/*
  filename: integralui.contextmenu.js
  version : 2.3.0
  Copyright Â© 2016-2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(){var e=function(a,c){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,c){b.__proto__=c}||function(b,c){for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a])};return e(a,c)};return function(a,c){function b(){this.constructor=a}e(a,c);a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_core_2=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_menuitem_1=require("../components/integralui.menuitem"),i0=require("@angular/core"),i1=require("../services/integralui.data.service"),i2=require("../services/integralui.common.service"),
i3=require("../components/integralui.core"),i4=require("@angular/common"),i5=require("../components/integralui.menuitem"),_c0=["content"];
function IntegralUIContextMenuComponent_iui_menuitem_3_Template(e,a){e&1&&i0.\u0275\u0275element(0,"iui-menuitem",3);if(e&2){var c=a.$implicit,b=i0.\u0275\u0275nextContext();i0.\u0275\u0275property("data",c)("items",c.items)("enabled",c.enabled)("icon",c.icon)("iconUrl",c.iconUrl)("text",c.text)("orientation","vertical")("level",0)("templateRef",b.itemTemplate)("showAnimation",!1)}}
var _c1=function(e,a,c){return{top:e,left:a,height:"auto",opacity:c}},IntegralUIContextMenuComponent=function(e){function a(c,b,a,g,f){var d=e.call(this,a)||this;d.dataService=c;d.elemRef=b;d.commonService=a;d.cmpResolver=g;d.baseService=f;d.blockDisplay="none";d.blockElemWidth="0";d.blockElemHeight="0";d.blockOverflow="hidden";d.blockOpacity=0;d.tRef=null;d.adjustment={top:0,left:0};d.autoClose=!0;d.direction=integralui_core_2.IntegralUIDirection.None;d.inverse=!1;d.items=[];d.mode="normal";d.position=
{x:0,y:-9999999};d.itemClick=new core_1.EventEmitter;d.menuOpened=new core_1.EventEmitter;d.menuClosed=new core_1.EventEmitter;d.itemList=[];return d}__extends(a,e);a.prototype.ngOnInit=function(){this.baseService.setComponent(this);this.dataService.init(this.items);this.generalClassName="iui-contextmenu";this.initStyle()};a.prototype.ngAfterViewInit=function(){var c=this,b=setTimeout(function(){var a=c.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);a&&c.contentRef&&(c.tRef=
c.contentRef.createComponent(a));clearTimeout(b)},100)};a.prototype.ngAfterContentInit=function(){var c=this,b=setTimeout(function(){c.elemRef.nativeElement.firstElementChild.focus();clearTimeout(b)},1)};a.prototype.ngOnDestroy=function(){this.tRef&&this.tRef.destroy()};a.prototype.onBlur=function(c){0!=this.autoClose&&this.menuClosed.emit({event:c})};a.prototype.onRightClick=function(c){c.preventDefault()};a.prototype.getItemFromComponent=function(c){return c&&c.data?c.data:this.items&&(this.itemList=
this.contentList.toArray(),c=this.itemList.indexOf(c),0<=c&&c<this.items.length)?this.items[c]:null};a.prototype.invokeMethod=function(c,b){switch(c){case "ITEM_CLICK":this.itemClick.emit({event:b.event,item:this.getItemFromComponent(b.cmp)})}};a.prototype.getSize=function(){return{width:this.elemRef.nativeElement.firstElementChild.offsetWidth,height:this.elemRef.nativeElement.firstElementChild.offsetHeight}};a.prototype.adjustPosition=function(c,b,a,e,f){var d=this,g=d.commonService.getShiftPos();
setTimeout(function(){var h=d.getSize();"manual"==b&&f&&(a.x=f.left+f.width+g.x+d.adjustment.left,a.y=f.bottom+g.y+4+d.adjustment.top,d.direction&integralui_core_2.IntegralUIDirection.Above&&(a.y-=h.height),d.inverse||d.direction&integralui_core_2.IntegralUIDirection.Left)&&(a.x-=h.width);e&&a.y+h.height>e.height&&(a.y-=a.y+h.height-e.height);d.position=a;d.menuOpened.emit({event:c})},10)};a.prototype.open=function(a,b,d,e,f){this.items&&(this.blockDisplay="block",this.blockOpacity=1,this.adjustPosition(a,
b,d,e,f))};a.\u0275fac=function(c){return new (c||a)(i0.\u0275\u0275directiveInject(i1.IntegralUIDataService),i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i2.IntegralUICommonService),i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver),i0.\u0275\u0275directiveInject(i3.IntegralUIBaseService))};a.\u0275cmp=i0.\u0275\u0275defineComponent({type:a,selectors:[["iui-contextmenu"]],contentQueries:function(a,b,d){a&1&&i0.\u0275\u0275contentQuery(d,integralui_menuitem_1.IntegralUIMenuItem,
!1);if(a&2){var c;i0.\u0275\u0275queryRefresh(c=i0.\u0275\u0275loadQuery())&&(b.contentList=c)}},viewQuery:function(a,b){a&1&&i0.\u0275\u0275viewQuery(_c0,!0,core_1.ViewContainerRef);if(a&2){var c;i0.\u0275\u0275queryRefresh(c=i0.\u0275\u0275loadQuery())&&(b.contentRef=c.first)}},inputs:{controlStyle:"controlStyle",data:"data",state:"state",adjustment:"adjustment",autoClose:"autoClose",direction:"direction",inverse:"inverse",items:"items",itemTemplate:"itemTemplate",mode:"mode",position:"position"},
outputs:{itemClick:"itemClick",menuOpened:"menuOpened",menuClosed:"menuClosed"},features:[i0.\u0275\u0275ProvidersFeature([integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService]),i0.\u0275\u0275InheritDefinitionFeature],decls:4,vars:7,consts:[["tabindex","999",3,"ngClass","ngStyle","blur","contextmenu"],["content",""],[3,"data","items","enabled","icon","iconUrl","text","orientation","level","templateRef","showAnimation",4,"ngFor","ngForOf"],[3,"data","items","enabled",
"icon","iconUrl","text","orientation","level","templateRef","showAnimation"]],template:function(a,b){a&1&&(i0.\u0275\u0275elementStart(0,"div",0),i0.\u0275\u0275listener("blur",function(a){return b.onBlur(a)})("contextmenu",function(a){return b.onRightClick(a)}),i0.\u0275\u0275elementStart(1,"ul",null,1),i0.\u0275\u0275template(3,IntegralUIContextMenuComponent_iui_menuitem_3_Template,1,10,"iui-menuitem",2),i0.\u0275\u0275elementEnd(),i0.\u0275\u0275elementEnd());a&2&&(i0.\u0275\u0275property("ngClass",
b.getControlClass())("ngStyle",i0.\u0275\u0275pureFunction3(3,_c1,b.position.y+"px",b.position.x+"px",b.blockOpacity)),i0.\u0275\u0275advance(3),i0.\u0275\u0275property("ngForOf",b.items))},directives:[i4.NgClass,i4.NgStyle,i4.NgForOf,i5.IntegralUIMenuItem],encapsulation:2});return a}(integralui_core_1.IntegralUIBaseComponent);exports.IntegralUIContextMenuComponent=IntegralUIContextMenuComponent;
(function(){i0.\u0275setClassMetadata(IntegralUIContextMenuComponent,[{type:core_1.Component,args:[{selector:"iui-contextmenu",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="{ \'top\': position.y + \'px\', \'left\': position.x + \'px\', \'height\': \'auto\', \'opacity\': blockOpacity }" (blur)="onBlur($event)" (contextmenu)="onRightClick($event)" tabindex="999">\n\t\t\t<ul #content>\n\t\t\t\t<iui-menuitem *ngFor="let item of items" [data]="item" [items]="item.items" [enabled]="item.enabled" [icon]="item.icon" [iconUrl]="item.iconUrl"  [text]="item.text" [orientation]="\'vertical\'" [level]="0" [templateRef]="itemTemplate" [showAnimation]="false"></iui-menuitem>\n\t\t\t</ul>\n\t\t</div>\n\t',
inputs:["controlStyle","data","state"],providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}]}],function(){return[{type:i1.IntegralUIDataService},{type:i0.ElementRef},{type:i2.IntegralUICommonService},{type:i0.ComponentFactoryResolver},{type:i3.IntegralUIBaseService}]},{contentRef:[{type:core_1.ViewChild,args:["content",{read:core_1.ViewContainerRef,"static":!1}]}],contentList:[{type:core_1.ContentChildren,
args:[integralui_menuitem_1.IntegralUIMenuItem]}],adjustment:[{type:core_1.Input}],autoClose:[{type:core_1.Input}],direction:[{type:core_1.Input}],inverse:[{type:core_1.Input}],items:[{type:core_1.Input}],itemTemplate:[{type:core_1.Input}],mode:[{type:core_1.Input}],position:[{type:core_1.Input}],itemClick:[{type:core_1.Output}],menuOpened:[{type:core_1.Output}],menuClosed:[{type:core_1.Output}]})})();
var IntegralUIContextMenu=function(){function e(a,c,b){this.elemRef=a;this.viewContainer=c;this.cmpResolver=b;this.currentSettings=!1;this.eventList=[];this.isMenuActive=!1;this.winScrollPos={top:0,left:0};this.cmpRef=null;this.templateList=[];this.itemClick=new core_1.EventEmitter;this.menuClick=new core_1.EventEmitter;this.menuOpening=new core_1.EventEmitter;this.menuOpened=new core_1.EventEmitter;this.menuClosed=new core_1.EventEmitter}Object.defineProperty(e.prototype,"settings",{get:function(){return this.currentSettings},
set:function(a){this.currentSettings!=a&&(this.currentSettings=a,this.updateTemplate())},enumerable:!0,configurable:!0});e.prototype.ngAfterContentInit=function(){this.updateTemplate()};e.prototype.updateTemplate=function(){this.itemTemplate=void 0;if(this.templates){this.templateList=this.templates.toArray();for(var a=0;a<this.templateList.length;a++)if(this.templateList[a].settings)switch(this.templateList[a].settings.type){case "menu-item":this.itemTemplate=this.templateList[a].getTemplate()}}};
e.prototype.ngOnDestroy=function(){this.closeMenu()};e.prototype.getSize=function(){return{width:this.elemRef.nativeElement.offsetWidth,height:this.elemRef.nativeElement.offsetHeight}};e.prototype.closeMenu=function(a){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(a){return a.unsubscribe()}),this.cmpRef.destroy());a&&this.menuClosed.emit({event:a})};e.prototype.onContextMenu=function(a){"manual"!=this.settings.position&&this.processMenuOpen(a)};e.prototype.onMouseDown=function(a){"manual"==
this.settings.position&&(0>this.settings.buttonType||a.which==this.settings.buttonType)&&this.processMenuOpen(a,"manual")};e.prototype.processMenuOpen=function(a,c){a.preventDefault();var b=this;b.winScrollPos={top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft};var d=b.contextMenuRef?b.contextMenuRef:b.settings?b.settings.appRef:null;if(d){b.closeMenu();var e={cancel:!1,event:a};b.menuOpening.emit(e);1!=e.cancel&&(e=b.cmpResolver.resolveComponentFactory(IntegralUIContextMenuComponent))&&
(b.cmpRef=d.createComponent(e),b.cmpRef&&(d=null,b.cmpRef.instance&&(d=b.cmpRef.instance),d&&(b.isMenuActive=!0,d.mode=c,d.items=b.createMenuList(b.settings.items),d.adjustment=b.settings.adjustment?b.settings.adjustment:{top:0,left:0},d.autoClose=void 0!=b.settings.autoClose?b.settings.autoClose:!0,d.direction=b.settings.direction?b.settings.direction:integralui_core_2.IntegralUIDirection.None,d.inverse=void 0!=b.settings.inverse?b.settings.inverse:!1,d.itemTemplate=b.itemTemplate,d.controlStyle=
b.settings.style,e=b.settings.appSize?b.settings.appSize:{width:window.innerWidth,height:window.innerHeight},"manual"==c?d.open(a,c,{x:0,y:0},e,b.elemRef.nativeElement.getBoundingClientRect()):d.open(a,c,{x:a.pageX,y:a.pageY},e),setTimeout(function(){window.scrollTo(b.winScrollPos.left,b.winScrollPos.top)},5),b.eventList.push(d.itemClick.subscribe(function(a){b.itemClick.emit(a);b.menuClick.emit(a);b.closeMenu(a)})),b.eventList.push(d.menuOpened.subscribe(function(a){b.menuOpened.emit(a)})),b.eventList.push(d.menuClosed.subscribe(function(a){b.closeMenu(a)})),
"manual"==c&&a.stopPropagation())))}};e.prototype.createMenuList=function(a){var c=[];if(a)for(var b=0;b<a.length;b++)0!=a[b].visible&&c.push(a[b]);return c};e.\u0275fac=function(a){return new (a||e)(i0.\u0275\u0275directiveInject(i0.ElementRef),i0.\u0275\u0275directiveInject(i0.ViewContainerRef),i0.\u0275\u0275directiveInject(i0.ComponentFactoryResolver))};e.\u0275dir=i0.\u0275\u0275defineDirective({type:e,selectors:[["","iuiContextMenu",""]],contentQueries:function(a,c,b){a&1&&i0.\u0275\u0275contentQuery(b,
integralui_core_1.IntegralUITemplate,!0);if(a&2){var d;i0.\u0275\u0275queryRefresh(d=i0.\u0275\u0275loadQuery())&&(c.templates=d)}},hostBindings:function(a,c){a&1&&i0.\u0275\u0275listener("contextmenu",function(a){return c.onContextMenu(a)})("mousedown",function(a){return c.onMouseDown(a)})},inputs:{settings:["iuiContextMenu","settings"],contextMenuRef:"contextMenuRef"},outputs:{itemClick:"itemClick",menuClick:"menuClick",menuOpening:"menuOpening",menuOpened:"menuOpened",menuClosed:"menuClosed"}});
return e}();exports.IntegralUIContextMenu=IntegralUIContextMenu;
(function(){i0.\u0275setClassMetadata(IntegralUIContextMenu,[{type:core_1.Directive,args:[{selector:"[iuiContextMenu]"}]}],function(){return[{type:i0.ElementRef},{type:i0.ViewContainerRef},{type:i0.ComponentFactoryResolver}]},{templates:[{type:core_1.ContentChildren,args:[integralui_core_1.IntegralUITemplate,{descendants:!0}]}],settings:[{type:core_1.Input,args:["iuiContextMenu"]}],contextMenuRef:[{type:core_1.Input}],itemClick:[{type:core_1.Output}],menuClick:[{type:core_1.Output}],menuOpening:[{type:core_1.Output}],
menuOpened:[{type:core_1.Output}],menuClosed:[{type:core_1.Output}],onContextMenu:[{type:core_1.HostListener,args:["contextmenu",["$event"]]}],onMouseDown:[{type:core_1.HostListener,args:["mousedown",["$event"]]}]})})();